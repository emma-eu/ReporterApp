"use strict";(self.webpackChunkfeedback_map=self.webpackChunkfeedback_map||[]).push([[5492],{4815:(e,n,a)=>{var i,t;function r(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}function l(e){return null!=e&&!isNaN(e)&&isFinite(e)}function s(e){return e.valueExpression?i.Expression:e.field&&"string"==typeof e.field?i.Field:i.Unknown}function o(e,n){const a=n||s(e),r=e.valueUnit||"unknown";return a===i.Unknown?t.Constant:e.stops?t.Stops:null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?t.ClampedLinear:"unknown"===r?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?t.Proportional:t.Additive:t.Identity:t.RealWorldSize}a.d(n,{KZ:()=>o,Yf:()=>i,_w:()=>t,eh:()=>s,gf:()=>l,of:()=>r}),function(e){e.Unknown="unknown",e.Expression="expression",e.Field="field"}(i||(i={})),function(e){e.Unknown="unknown",e.Stops="stops",e.ClampedLinear="clamped-linear",e.Proportional="proportional",e.Additive="additive",e.Constant="constant",e.Identity="identity",e.RealWorldSize="real-world-size"}(t||(t={}))},15492:(e,n,a)=>{a.r(n),a.d(n,{getAllSizes:()=>F,getColor:()=>b,getOpacity:()=>m,getRotationAngle:()=>h,getSize:()=>V,getSizeForValue:()=>g,getSizeFromNumberOrVariable:()=>w,getSizeRangeAtScale:()=>S,getVisualVariableValues:()=>z,viewScaleRE:()=>v});var i=a(69539),t=a(39356),r=a(4212),l=a(76460),s=a(3454),o=a(4815);const c=()=>l.A.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),u=e=>c().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),f=()=>c().error("Use of arcade expressions requires an arcade context"),d=new t.default,p=Math.PI,v=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function b(e,n,a){const t="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!t)return;if("esri.renderers.visualVariables.ColorVariable"!==t.declaredClass)return void u("ColorVariable");const r="number"==typeof n,l=r?null:n,s=l?.attributes;let o=r?n:null;const c=t.field,{ipData:d,hasExpression:p}=t.cache;let v=t.cache.compiledFunc;if(!c&&!p){const e=t.stops;return e&&e[0]&&e[0].color}if("number"!=typeof o)if(p){if(null==a?.arcade)return void f();const e={viewingMode:a.viewingMode,scale:a.scale,spatialReference:a.spatialReference},n=a.arcade.arcadeUtils,i=n.getViewInfo(e),r=n.createExecContext(l,i,a.timeZone);if(!v){const e=n.createSyntaxTree(t.valueExpression);v=n.createFunction(e),t.cache.compiledFunc=v}o=n.executeFunction(v,r)}else s&&(o=s[c]);const b=t.normalizationField,m=null!=s&&null!=b?parseFloat(s[b]):void 0;if(null!=o&&(!b||r||!isNaN(m)&&0!==m)){isNaN(m)||r||(o/=m);const e=y(o,d);if(e){const n=e[0],r=e[1],l=n===r?t.stops[n].color:i.A.blendColors(t.stops[n].color,t.stops[r].color,e[2],null!=a?a.color:void 0);return new i.A(l)}}}function m(e,n,a){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void u("OpacityVariable");const t="number"==typeof n,r=t?null:n,l=r?.attributes;let s=t?n:null;const o=i.field,{ipData:c,hasExpression:d}=i.cache;let p=i.cache.compiledFunc;if(!o&&!d){const e=i.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof s)if(d){if(null==a?.arcade)return void f();const e={viewingMode:a.viewingMode,scale:a.scale,spatialReference:a.spatialReference},n=a.arcade.arcadeUtils,t=n.getViewInfo(e),l=n.createExecContext(r,t,a.timeZone);if(!p){const e=n.createSyntaxTree(i.valueExpression);p=n.createFunction(e),i.cache.compiledFunc=p}s=n.executeFunction(p,l)}else l&&(s=l[o]);const v=i.normalizationField,b=null!=l&&null!=v?parseFloat(l[v]):void 0;if(null!=s&&(!v||t||!isNaN(b)&&0!==b)){isNaN(b)||t||(s/=b);const e=y(s,c);if(e){const n=e[0],a=e[1];if(n===a)return i.stops[n].opacity;{const t=i.stops[n].opacity;return t+(i.stops[a].opacity-t)*e[2]}}}}function h(e,n,a){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void u("RotationVariable");const t=i.axis||"heading",r="heading"===t&&"arithmetic"===i.rotationType?90:0,l="heading"===t&&"arithmetic"===i.rotationType?-1:1,s="number"==typeof n?null:n,o=s?.attributes,c=i.field,{hasExpression:d}=i.cache;let p=i.cache.compiledFunc,v=0;if(!c&&!d)return v;if(d){if(null==a?.arcade)return void f();const e={viewingMode:a.viewingMode,scale:a.scale,spatialReference:a.spatialReference},n=a.arcade.arcadeUtils,t=n.getViewInfo(e),r=n.createExecContext(s,t,a.timeZone);if(!p){const e=n.createSyntaxTree(i.valueExpression);p=n.createFunction(e),i.cache.compiledFunc=p}v=n.executeFunction(p,r)}else o&&(v=o[c]||0);return v="number"!=typeof v||isNaN(v)?null:r+l*v,v}function V(e,n,a){const i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!i)return;if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void u("SizeVariable");const t=g(function(e,n,a){const i="number"==typeof n,t=i?null:n,r=t?.attributes;let l=i?n:null;const{isScaleDriven:s}=e.cache;let c=e.cache.compiledFunc;if(s){const n=null!=a?a.scale:void 0,i=null!=a?a.view:void 0;l=null==n||"3d"===i?function(e){let n=null,a=null;const i=e.stops;return i?(n=i[0].value,a=i[i.length-1].value):(n=e.minDataValue||0,a=e.maxDataValue||0),(n+a)/2}(e):n}else if(!i)switch(e.inputValueType){case o.Yf.Expression:{if(null==a?.arcade)return void f();const n={viewingMode:a.viewingMode,scale:a.scale,spatialReference:a.spatialReference},i=a.arcade.arcadeUtils,r=i.getViewInfo(n),s=i.createExecContext(t,r,a.timeZone);if(!c){const n=i.createSyntaxTree(e.valueExpression);c=i.createFunction(n),e.cache.compiledFunc=c}l=i.executeFunction(c,s);break}case o.Yf.Field:r&&(l=r[e.field]);break;case o.Yf.Unknown:l=null}if(!(0,o.gf)(l))return null;if(i||!e.normalizationField)return l;const u=r?parseFloat(r[e.normalizationField]):null;return(0,o.gf)(u)&&0!==u?l/u:null}(i,n,a),i,n,a,i.cache.ipData);return null==t||isNaN(t)?0:t}function w(e,n,a){return null==e?null:(0,o.of)(e)?V(e,n,a):(0,o.gf)(e)?e:null}function x(e,n,a){return(0,o.gf)(a)&&e>a?a:(0,o.gf)(n)&&e<n?n:e}function g(e,n,a,i,t){switch(n.transformationType){case o._w.Additive:return function(e,n,a,i){return e+((w(n.minSize,a,i)||n.minDataValue)??0)}(e,n,a,i);case o._w.Constant:return function(e,n,a){const i=e.stops;let t=i?.length&&i[0].size;return null==t&&(t=e.minSize),w(t,n,a)}(n,a,i);case o._w.ClampedLinear:return function(e,n,a,i){const t=(e-n.minDataValue)/(n.maxDataValue-n.minDataValue),r=w(n.minSize,a,i),l=w(n.maxSize,a,i),s=null!=i?i.shape:void 0;if(e<=n.minDataValue)return r;if(e>=n.maxDataValue)return l;if(null==r||null==l)return null;if("area"===n.scaleBy&&s){const e="circle"===s,n=e?p*(r/2)**2:r*r,a=n+t*((e?p*(l/2)**2:l*l)-n);return e?2*Math.sqrt(a/p):Math.sqrt(a)}return r+t*(l-r)}(e,n,a,i);case o._w.Proportional:return function(e,n,a,i){const t=null!=i?i.shape:void 0,r=e/n.minDataValue,l=w(n.minSize,a,i),s=w(n.maxSize,a,i);let o=null;return o="circle"===t?2*Math.sqrt(r*(l/2)**2):"square"===t||"diamond"===t||"image"===t?Math.sqrt(r*l**2):r*l,x(o,l,s)}(e,n,a,i);case o._w.Stops:return function(e,n,a,i,t){const[r,l,s]=y(e,t);if(r===l)return w(n.stops?.[r].size,a,i);{const e=w(n.stops?.[r].size,a,i);return e+(w(n.stops?.[l].size,a,i)-e)*s}}(e,n,a,i,t);case o._w.RealWorldSize:return function(e,n,a,i){const t=(i?.resolution??1)*s.j[n.valueUnit],r=w(n.minSize,a,i),l=w(n.maxSize,a,i),{valueRepresentation:o}=n;let c=null;return c="area"===o?2*Math.sqrt(e/p)/t:"radius"===o||"distance"===o?2*e/t:e/t,x(c,r,l)}(e,n,a,i);case o._w.Identity:return e;case o._w.Unknown:return null}}function S(e,n,a){const{isScaleDriven:i}=e.cache;if(!(i&&"3d"===a||n))return null;const t={scale:n,view:a};let r=w(e.minSize,d,t),l=w(e.maxSize,d,t);if(null!=r||null!=l){if(r>l){const e=l;l=r,r=e}return{minSize:r,maxSize:l}}}function z(e,n,a){if(!e.visualVariables)return;const i=[],t=[],r=[],l=[],s=[];for(const o of e.visualVariables)switch(o.type){case"color":t.push(o);break;case"opacity":r.push(o);break;case"rotation":s.push(o);break;case"size":l.push(o)}return t.forEach((e=>{const t=b(e,n,a);i.push({variable:e,value:t})})),r.forEach((e=>{const t=m(e,n,a);i.push({variable:e,value:t})})),s.forEach((e=>{const t=h(e,n,a);i.push({variable:e,value:t})})),l.forEach((e=>{const t=V(e,n,a);i.push({variable:e,value:t})})),i.filter((e=>null!=e.value))}function y(e,n){if(!n)return;let a=0,i=n.length-1;return n.some(((n,t)=>e<n?(i=t,!0):(a=t,!1))),[a,i,(e-n[a])/(n[i]-n[a])]}function F(e,n,a){const i=["proportional","proportional","proportional"];for(const t of e){const e=t.useSymbolValue?"symbol-value":V(t,n,a);switch(t.axis){case"width":i[0]=e;break;case"depth":i[1]=e;break;case"height":i[2]=e;break;case"width-and-depth":i[0]=e,i[1]=e;break;case"all":case void 0:case null:i[0]=e,i[1]=e,i[2]=e;break;default:(0,r.Xb)(t.axis)}}return i}}}]);
//# sourceMappingURL=5492.33686f7a.chunk.js.map