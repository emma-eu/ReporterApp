"use strict";(self.webpackChunkfeedback_map=self.webpackChunkfeedback_map||[]).push([[6840,48988,52629],{6840:(e,t,r)=>{r.r(t),r.d(t,{CIMSymbolRasterizer:()=>h});var i=r(30050),n=r(94110),s=r(401),o=r(48988),a=r(83367),c=r(97763);const l=96/72;class h{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new i.A}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,t,r,i,n,l,h,f,p,m){if(!e)return null;const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:y}=d;l||(l=(0,c.n5)(y));const g=await o.OverrideHelper.resolveSymbolOverrides(d,t,this._spatialReference,n,l,h,f),M=this._cimResourceManager,b=[];s.wp.fetchResources(g,M,b),s.wp.fetchFonts(g,M,b),b.length>0&&await Promise.all(b);const{width:v,height:w}=r;let x=u(l,v,w,i,m);const C=s.wp.getEnvelope(g,x,M);if(!C)return null;C.x===1/0&&(C.x=v+2),C.y===1/0&&(C.y=-w/2),C.width===-1/0&&(C.width=v),C.height===-1/0&&(C.height=w);let I=1,k=0,S=0;switch(y.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;C.width>v&&(e=v/C.width);let t=1;C.height>w&&(t=w/C.height),"preview"===i&&(C.width<v&&(e=v/C.width),C.height<w&&(t=w/C.height)),I=Math.min(e,t),k=C.x+C.width/2,S=C.y+C.height/2}break;case"CIMLineSymbol":if(m){S=C.y+C.height/2,k=C.x+C.width/2;const e=C.width-v,t=C.height-w;x={paths:(0,a.hs)(x.paths,{xmin:-1*C.width/2+e,xmax:C.width/2-e,ymin:-1*C.height/2+t,ymax:C.height/2-t,width:C.width-2*e,height:C.height-2*t})}}else{(p||C.height>w)&&(I=w/C.height),S=C.y+C.height/2;const e=C.x*I+v/2,t=(C.x+C.width)*I+v/2,{paths:r}=x;r[0][0][0]-=e/I,r[0][2][0]-=(t-v)/I}break;case"CIMPolygonSymbol":if(m){S=C.y+C.height/2,k=C.x+C.width/2;const e=C.width-v,t=C.height-w;x={paths:(0,a.hs)(x.rings,{xmin:-1*C.width/2+e,xmax:C.width/2-e,ymin:-1*C.height/2+t,ymax:C.height/2-t,width:C.width-2*e,height:C.height-2*t})}}else{k=C.x+C.width/2,S=C.y+C.height/2;const e=C.x*I+v/2,t=(C.x+C.width)*I+v/2,r=C.y*I+w/2,i=(C.y+C.height)*I+w/2,{rings:n}=x;e<0&&(n[0][0][0]-=e,n[0][3][0]-=e,n[0][4][0]-=e),r<0&&(n[0][0][1]+=r,n[0][1][1]+=r,n[0][4][1]+=r),t>v&&(n[0][1][0]-=t-v,n[0][2][0]-=t-v),i>w&&(n[0][2][1]+=i-w,n[0][3][1]+=i-w)}}const R={type:"cim",data:{type:"CIMSymbolReference",symbol:g}};return this.rasterize(R,v,w,k,S,I,l,1,x)}rasterize(e,t,r,i,s,o,a){let h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,p=arguments.length>9&&void 0!==arguments[9]?arguments[9]:window.devicePixelRatio||1;const{data:m}=e;if(!m||"CIMSymbolReference"!==m.type||!m.symbol)return null;const{symbol:d}=m,y=this._canvas,g=p*l;y.width=t*g,y.height=r*g,a||(a=(0,c.n5)(d)),f||(f=u(a,t,r,"legend")),y.width+=2*h,y.height+=2*h;const M=y.getContext("2d",{willReadFrequently:!0}),b=n.IT.createIdentity();return b.translate(-i,-s),b.scale(o*g,-o*g),b.translate(t*g/2+h,r*g/2+h),M.clearRect(0,0,y.width,y.height),new n.Rj(M,this._cimResourceManager,b,!0).drawSymbol(d,f),M.getImageData(0,0,y.width,y.height)}}function u(e,t,r,i,n){const s=-t/2+1,o=t/2-1,c=r/2-1,l=-r/2+1;if(n&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const i=function(e,t,r,i){return"esriGeometryPolygon"===t?{rings:(0,a.Tl)((0,a.hs)(e.rings,{xmin:0,ymin:0,xmax:r,ymax:i,width:r,height:i}),-1*r/2,-1*i/2)}:"esriGeometryPolyline"===t?{paths:(0,a.Tl)((0,a.hs)(e.paths,{xmin:0,ymin:0,xmax:r,ymax:i,width:r,height:i}),-1*r/2,-1*i/2)}:null}(n,e,t,r);if(i)return i}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[s,0],[0,0],[o,0]]]};default:return"legend"===i?{rings:[[[s,c],[o,0],[o,l],[s,l],[s,c]]]}:{rings:[[[s,c],[o,c],[o,l],[s,l],[s,c]]]}}}},30050:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(85504),n=r(16770);class s{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null,this.geometryEnginePromise=null}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,t){const r=this._resourceMap.get(e);if(r)return{width:r.width,height:r.height};let i=this._inFlightResourceMap.get(e);return i?i.then((e=>({width:e.width,height:e.height}))):(i=(0,n.M5)(e,t),this._inFlightResourceMap.set(e,i),i.then((t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height})),(()=>({width:0,height:0}))))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(e){return(0,i.Al)(e)}}},48988:(e,t,r)=>{r.d(t,{OverrideHelper:()=>h});var i=r(69539),n=r(59784),s=r(53084),o=r(98976),a=r(97763),c=r(52629);const l=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:i,a:n}=e;return[t,r,i,255*n]};class h{static findApplicableOverrides(e,t,r){if(e&&t){if(e.primitiveName){let i=!1;for(const t of r)if(t.primitiveName===e.primitiveName){i=!0;break}if(!i)for(const n of t)n.primitiveName===e.primitiveName&&r.push(n)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const i of e.effects)h.findApplicableOverrides(i,t,r);if(e.symbolLayers)for(const i of e.symbolLayers)h.findApplicableOverrides(i,t,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const i of e.effects)h.findApplicableOverrides(i,t,r);if(e.markerPlacement&&h.findApplicableOverrides(e.markerPlacement,t,r),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const i of e.markerGraphics)h.findApplicableOverrides(i,t,r),h.findApplicableOverrides(i.symbol,t,r)}else"CIMCharacterMarker"===e.type?h.findApplicableOverrides(e.symbol,t,r):"CIMHatchFill"===e.type?h.findApplicableOverrides(e.lineSymbol,t,r):"CIMPictureMarker"===e.type&&h.findApplicableOverrides(e.animatedSymbolProperties,t,r)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&(0,a.FH)(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const r=(0,a.rB)(e),i=e.primitiveName,n=[];for(const s of t)s.primitiveName===i&&n.push((0,a.rB)(s));return{type:"cim-effect-param",effect:r,overrides:(0,a.pk)(n)}}static async resolveSymbolOverrides(e,t,r,i,n,o,c){if(!e?.symbol)return null;let{symbol:l,primitiveOverrides:u}=e;const f=!!u;if(!f&&!i)return l;l=(0,s.o8)(l),u=(0,s.o8)(u);let p=!0;if(t||(t={attributes:{}},p=!1),f){if(p||(u=u.filter((e=>!e.valueExpressionInfo?.expression.includes("$feature")))),c||(u=u.filter((e=>!e.valueExpressionInfo?.expression.includes("$view")))),u.length>0){const e={spatialReference:r,fields:(0,a.O2)(t.attributes),geometryType:n};await h.createRenderExpressions(u,e),h.evaluateOverrides(u,t,n??"esriGeometryPoint",o,c)}h.applyOverrides(l,u)}return i&&h.applyDictionaryTextOverrides(l,t,i,null),l}static async createRenderExpressions(e,t){const r=[];for(const i of e){const e=i.valueExpressionInfo;if(!e||h._expressionToRenderExpression.has(e.expression))continue;const n=(0,o.Ad)(e.expression,t.spatialReference,t.fields);r.push(n),n.then((t=>h._expressionToRenderExpression.set(e.expression,t)))}r.length>0&&await Promise.all(r)}static evaluateOverrides(e,t,r,i,s){const o={$view:{scale:s?.scale}};for(const a of e){a.value&&"object"==typeof a.value&&(0,n.IB)(a.value)&&("Color"===a.propertyName||"StrokeColor"===a.propertyName)&&(a.value=l(a.value));const e=a.valueExpressionInfo;if(!e)continue;const s=h._expressionToRenderExpression.get(e.expression);s&&(a.value=(0,c.default)(s,t,o,r,i))}}static applyDictionaryTextOverrides(e,t,r,i){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"Normal";if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const s=e.symbolLayers;if(!s)return;for(const o of s)o&&"CIMVectorMarker"===o.type&&h.applyDictionaryTextOverrides(o,t,r,i,"CIMTextSymbol"===e.type?e.textCase:n)}break;case"CIMVectorMarker":{const n=e.markerGraphics;if(!n)return;for(const e of n)e&&h.applyDictionaryTextOverrides(e,t,r,i)}break;case"CIMMarkerGraphic":{const s=e.textString;if(s&&s.includes("[")){const o=(0,a.gQ)(s,r);e.textString=(0,a.FM)(t,o,i,n)}}}}static applyOverrides(e,t,r,i){if(e.primitiveName)for(const n of t)if(n.primitiveName===e.primitiveName){const t=(0,a.YF)(n.propertyName);if(i&&i.push({cim:e,nocapPropertyName:t,value:e[t]}),r){let t=!1;for(const i of r)i.primitiveName===e.primitiveName&&(t=!0);t||r.push(n)}null!=n.value&&(e[t]=n.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)h.applyOverrides(n,t,r,i);if(e.symbolLayers)for(const n of e.symbolLayers)h.applyOverrides(n,t,r,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const n of e.effects)h.applyOverrides(n,t,r,i);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const n of e.markerGraphics)h.applyOverrides(n,t,r,i),h.applyOverrides(n.symbol,t,r,i)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const r of e)void 0!==r.value&&(t+=`${r.primitiveName}${r.propertyName}${JSON.stringify(r.value)}`);return t}static toValue(e,t){if("DashTemplate"===e)return t.split(" ").map((e=>Number(e)));if("Color"===e){const e=new i.A(t).toRgba();return e[3]*=255,e}return t}}h._expressionToRenderExpression=new Map},52629:(e,t,r)=>{r.d(t,{default:()=>o});var i=r(50076),n=r(76460),s=r(76279);function o(e,t,r,i,s){if(null==e)return null;const o=e.references("geometry")&&s?c(t,i,s):t,a=e.repurposeFeature(o);try{return e.evaluate({...r,$feature:a},e.services)}catch(l){return n.A.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",l),null}}const a=new Map;function c(e,t,r){const{transform:o,hasZ:c,hasM:l}=r;a.has(t)||a.set(t,function(e){const t={};switch(e){case"esriGeometryPoint":return(e,r,i,n)=>(0,s.Tr)(r,t,e,i,n);case"esriGeometryPolygon":return(e,r,i,n)=>(0,s.$X)(r,t,e,i,n);case"esriGeometryPolyline":return(e,r,i,n)=>(0,s.P5)(r,t,e,i,n);case"esriGeometryMultipoint":return(e,r,i,n)=>(0,s.SW)(r,t,e,i,n);default:return n.A.getLogger("esri.views.2d.support.arcadeOnDemand").error(new i.A("mapview-arcade",`Unable to handle geometryType: ${e}`)),e=>e}}(t));const h=a.get(t)(e.geometry,o,c,l);return{...e,geometry:h}}},59784:(e,t,r)=>{r.d(t,{$:()=>v,IB:()=>a,Iy:()=>T,N2:()=>w,QP:()=>N,RH:()=>C,Vl:()=>_,Ws:()=>k,ZD:()=>x,_L:()=>A,bJ:()=>O,e$:()=>P,f6:()=>F,pW:()=>S,pf:()=>G});var i=r(69539),n=r(18690),s=r(53084),o=(r(15941),r(43047),r(55855));function a(e){return"r"in e&&"g"in e&&"b"in e}function c(e){return"h"in e&&"s"in e&&"v"in e}function l(e){return"l"in e&&"a"in e&&"b"in e}function h(e){return"l"in e&&"c"in e&&"h"in e}const u=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],f=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function p(e,t){const r=[];let i,n;if(e[0].length!==t.length)throw new Error("dimensions do not match");const s=e.length,o=e[0].length;let a=0;for(i=0;i<s;i++){for(a=0,n=0;n<o;n++)a+=e[i][n]*t[n];r.push(a)}return r}function m(e){const t=[e.r/255,e.g/255,e.b/255].map((e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4)),r=p(u,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function d(e){const t=p(f,[e.x/100,e.y/100,e.z/100]).map((e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function y(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map((e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function g(e){const t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((e=>e>6/29?e**3:3*(6/29)**2*(e-4/29)));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function M(e){return function(e){const t=e.l,r=e.a,i=e.b,n=Math.sqrt(r*r+i*i);let s=Math.atan2(i,r);return s=s>0?s:s+2*Math.PI,{l:t,c:n,h:s}}(y(m(e)))}function b(e){return d(g(function(e){const t=e.l,r=e.c,i=e.h;return{l:t,a:r*Math.cos(i),b:r*Math.sin(i)}}(e)))}function v(e){return a(e)?e:h(e)?b(e):l(e)?function(e){return d(g(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?d(e):c(e)?function(e){const t=(e.h+360)%360/60,r=e.s/100,i=e.v/100*255,n=i*r,s=n*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:n,g:s,b:0};break;case 1:o={r:s,g:n,b:0};break;case 2:o={r:0,g:n,b:s};break;case 3:o={r:0,g:s,b:n};break;case 4:o={r:s,g:0,b:n};break;case 5:case 6:o={r:n,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-n),o.g=Math.round(o.g+i-n),o.b=Math.round(o.b+i-n),o}(e):e}function w(e){return c(e)?e:function(e){const t=e.r,r=e.g,i=e.b,n=Math.max(t,r,i),s=n-Math.min(t,r,i);let o=n,a=0===s?0:n===t?(r-i)/s%6:n===r?(i-t)/s+2:(t-r)/s+4,c=0===s?0:s/o;return a<0&&(a+=6),a*=60,c*=100,o*=100/255,{h:a,s:c,v:o}}(v(e))}function x(e){return l(e)?e:function(e){return y(m(e))}(v(e))}function C(e){return h(e)?e:M(v(e))}function I(e){let{r:t,g:r,b:n,a:s}=e;return s<1&&(t=Math.round(s*t+255*(1-s)),r=Math.round(s*r+255*(1-s)),n=Math.round(s*n+255*(1-s))),new i.A({r:t,g:r,b:n})}function k(e,t){const{r:r,g:i,b:n}=t?.ignoreAlpha?e:I(e);return.2126*r+.7152*i+.0722*n}var S,R;function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S.High;return k(e,{ignoreAlpha:!0})>t?new i.A([0,0,0,e.a]):new i.A([255,255,255,e.a])}function P(e,t){const r=x(e);r.l*=1-t;const i=v(r),n=e.clone();return n.setColor(i),n.a=e.a,n}function A(e,t){const r=e.clone();return r.a*=t,r}function _(e,t){const r=w(e);r.s*=t;const i=v(r),n=e.clone();return n.setColor(i),n.a=e.a,n}function N(e){return i.A.toUnitRGBA(e)}function G(e){return(0,o.fA)(e[0],e[1],e[2],e.length>3?e[3]:1)}function F(e,t){const r=i.A.toUnitRGBA(e);return r[3]*=t,r}function T(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(0===e.length||t<=0)return[];if(1===(e=e.map((e=>"string"==typeof e?new i.A(e):e))).length||1===t){const r=[],i=e[0];for(let e=0;e<t;e++)r.push(i.clone());return r}if(r.shuffle&&(e=(0,n.k4)((0,s.o8)(e),r.seed)),e.length>=t){const r=[],i=(e.length-1)/(t-1);for(let n=0;n<t;n++){const t=Math.round(n*i);r.push(e[t].clone())}return r}return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=[],s=e.length-1,o=Math.ceil((t-e.length)/s);e:for(let n=0;n<s;n++){const s=e[n],a=e[n+1];for(let n=1;n<=o;n++){const c=n/(o+1);if(i.push(D(s,a,c,r)),i.length+e.length===t)break e}}return[...e.map((e=>e.clone())),...(0,n.k4)(i,r.seed??1)]}(e,t,r)}(R=S||(S={}))[R.Low=160]="Low",R[R.High=225]="High";const E=(e,t)=>{const r=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+r))};function D(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const o=e.r,a=e.g,c=e.b,l=t.r,h=t.g,u=t.b,f=Math.round(o+(l-o)*r),p=Math.round(a+(h-a)*r),m=Math.round(c+(u-c)*r);if(!s.offset)return new i.A([f,p,m]);const d=(0,n.Mo)(s.seed);return new i.A([E(f,d),E(p,d),E(m,d)])}}}]);
//# sourceMappingURL=6840.0302deb3.chunk.js.map