"use strict";(self.webpackChunkfeedback_map=self.webpackChunkfeedback_map||[]).push([[1088],{1900:(e,t,r)=>{r.d(t,{A:()=>y});var o=r(50076),i=r(42553),s=r(76460),n=r(87663),a=r(64920),l=r(53430),u=r(36693),d=r(67478),p=r(24241);const c=new Map;class y{static fromJSON(e){return new y(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new y(e.fields??[],w(e))}static fromLayerJSON(e){return new y(e.fields??[],w(e))}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const o of this.fields){const e=o?.name,t=m(e);if(e&&t){const i=h(e);this._fieldsMap.set(e,o),this._fieldsMap.set(i,o),this._normalizedFieldsMap.set(t,o),r.push(`${i}:${o.type}:${this._timeZoneByFieldName?.get(e)}`),(0,l.vE)(o)?(this.dateFields.push(o),this._dateFieldsSet.add(o)):(0,l.WA)(o)&&(this._numericFieldsSet.add(o),this.numericFields.push(o)),(0,l.te)(o)||(0,l.Xz)(o)||(o.editable=null==o.editable||!!o.editable,o.nullable=null==o.nullable||!!o.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)(0,l.te)(e)||(0,l.Xz)(e)||e.nullable||void 0!==(0,l.lD)(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(h(e))??this._normalizedFieldsMap.get(m(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(e){const t=this.get(e&&"string"!=typeof e?e.name:e);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):"date"===t.type||"esriFieldTypeDate"===t.type?(s.A.getLogger("esri.layers.support.FieldsIndex").errorOnce(new o.A("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),u.n$):g.has(t.type)?u.L5:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===u.L5?a.GB.instance:t===u.n$?p.mQ.utcInstance:(0,n.tE)(c,t,(()=>p.oh.create(t))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return(0,l.OH)(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>i.A.isSerializable(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function h(e){return e.trim().toLowerCase()}function m(e){return(0,l.rS)(e)?.toLowerCase()??""}const g=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function w(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:o,editFieldsInfo:i}=e,s=(o?"startField"in o?o.startField:o.startTimeField:"")??"",n=(o?"endField"in o?o.endField:o.endTimeField:"")??"",a=function(e){return"dateFieldsTimeZone"in e}(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?(0,d.ZS)(e.dateFieldsTimeReference):null,l=i?function(e){return"timeZone"in e}(i)?i.timeZone??a:i.dateFieldsTimeReference?(0,d.ZS)(i.dateFieldsTimeReference):a??u.n$:null,p=o?function(e){return"timeZone"in e}(o)?o.timeZone??a:o.timeReference?(0,d.ZS)(o.timeReference):a:null,c=new Map([[h(i?.creationDateField??""),l],[h(i?.editDateField??""),l],[h(s),p],[h(n),p]]);for(const{name:d,type:y}of e.fields)if(g.has(y))t.set(d,u.L5);else if("date"!==y&&"esriFieldTypeDate"!==y)t.set(d,null);else if(r)t.set(d,u.L5);else{const e=c.get(h(d??""))??a;t.set(d,e)}return t}},11187:(e,t,r)=>{r.d(t,{A:()=>l});var o=r(35143),i=r(42553),s=r(46053),n=(r(81806),r(76460),r(47249),r(85842));let a=class extends i.A{constructor(e){super(e),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.exceededTransferLimit=null,this.serviceEdits=null,this.discoveredSubnetworks=null}};(0,o._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.moment=e?e.getTime():null}}}})],a.prototype,"moment",void 0),(0,o._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"fullUpdate",void 0),(0,o._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"validateErrorsCreated",void 0),(0,o._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"exceededTransferLimit",void 0),(0,o._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"serviceEdits",void 0),(0,o._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"discoveredSubnetworks",void 0),a=(0,o._)([(0,n.$)("esri.rest.networks.support.ValidateNetworkTopologyResult")],a);const l=a},11957:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Pt});var o=r(35143),i=r(55171),s=r(32809),n=r(16036),a=r(18690),l=r(94643),u=r(50076),d=r(49304),p=r(27741),c=r(76460),y=r(30726),h=r(77717),m=r(91291),g=r(50346),w=r(68134),f=r(90534),v=r(46053),b=(r(81806),r(28379)),_=r(85842),S=r(17707),A=r(6527),T=r(13312),I=r(70652),M=r(72945),F=r(42553);r(47249);let j=class extends F.A{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],j.prototype,"facilityIdField",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],j.prototype,"layerId",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],j.prototype,"nameField",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:!0}})],j.prototype,"siteIdField",void 0),(0,o._)([(0,v.MZ)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],j.prototype,"sublayerId",void 0),j=(0,o._)([(0,_.$)("esri.layers.support.FacilityLayerInfo")],j);const N=j;let Z=class extends F.A{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"facilityIdField",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"layerId",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"levelIdField",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"levelNumberField",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"longNameField",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"shortNameField",void 0),(0,o._)([(0,v.MZ)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Z.prototype,"sublayerId",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"verticalOrderField",void 0),Z=(0,o._)([(0,_.$)("esri.layers.support.LevelLayerInfo")],Z);const C=Z;let R=class extends F.A{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],R.prototype,"layerId",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],R.prototype,"nameField",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],R.prototype,"siteIdField",void 0),(0,o._)([(0,v.MZ)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],R.prototype,"sublayerId",void 0),R=(0,o._)([(0,_.$)("esri.layers.support.SiteLayerInfo")],R);const k=R;let E=class extends F.A{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};(0,o._)([(0,v.MZ)({type:C,json:{write:{isRequired:!0}}})],E.prototype,"levelLayer",void 0),(0,o._)([(0,v.MZ)({type:N,json:{write:{isRequired:!0}}})],E.prototype,"facilityLayer",void 0),(0,o._)([(0,v.MZ)({type:k,json:{write:!0}})],E.prototype,"siteLayer",void 0),E=(0,o._)([(0,_.$)("esri.support.MapFloorInfo")],E);const x=E;var L,O=r(59187),U=r(61701),G=r(53084);let V=L=class extends F.A{constructor(e){super(e),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new L((0,G.o8)({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};(0,o._)([(0,v.MZ)({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],V.prototype,"activeRange",void 0),(0,o._)([(0,v.MZ)({type:[Number],json:{write:!0}})],V.prototype,"currentRangeExtent",void 0),(0,o._)([(0,v.MZ)({type:[Number],json:{write:!0}})],V.prototype,"fullRangeExtent",void 0),V=L=(0,o._)([(0,_.$)("esri.webdoc.RangeInfo")],V);const P=V;var $;let J=$=class extends F.A{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new $((0,G.o8)({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};(0,o._)([(0,v.MZ)({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],J.prototype,"enabled",void 0),(0,o._)([(0,v.MZ)({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],J.prototype,"longNames",void 0),(0,o._)([(0,v.MZ)({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],J.prototype,"minimized",void 0),(0,o._)([(0,v.MZ)({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],J.prototype,"pinnedLevels",void 0),(0,o._)([(0,v.MZ)({type:String,json:{read:{source:"site"},write:{target:"site"}}})],J.prototype,"site",void 0),(0,o._)([(0,v.MZ)({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],J.prototype,"facility",void 0),(0,o._)([(0,v.MZ)({type:String,json:{read:{source:"level"},write:{target:"level"}}})],J.prototype,"level",void 0),J=$=(0,o._)([(0,_.$)("esri.webdoc.widgets.FloorFilter")],J);const B=J;var D,q=r(45802),z=r(40565);const W=new q.J({slider:"slider",picker:"picker"});let K=D=class extends F.A{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new D({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};(0,o._)([(0,v.MZ)({type:W.apiValues,nonNullable:!0,json:{type:W.jsonValues,default:null,read:{reader:W.read},write:{isRequired:!0,writer:W.write}}})],K.prototype,"interactionMode",void 0),(0,o._)([(0,v.MZ)({type:z.jz,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=null!=this.stopInterval;return{enabled:!e,isRequired:!e}}}}})],K.prototype,"numStops",void 0),(0,o._)([(0,v.MZ)({type:Number,json:{write:{overridePolicy(){return{isRequired:null==this.numStops}}}}})],K.prototype,"stopInterval",void 0),K=D=(0,o._)([(0,_.$)("esri.webdoc.widgets.Range")],K);const H=K;var X,Y=r(48611),Q=r(90115),ee=r(93030);let te=X=class extends F.A{constructor(e){super(e),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(e){return e?O.A.fromArray(e):void 0}writeCurrentTimeExtent(e,t,r){e&&(0,Y.sM)(r,e.toArray(),t)}readFullTimeExtent(e,t){const r=t.properties;if(!r)return;const o=null!=r.endTime?new Date(r.endTime):null,i=null!=r.startTime?new Date(r.startTime):null;return new O.A({start:i,end:o})}writeFullTimeExtent(e,t){if(!e)return;const r=t.properties=t.properties||{},o=e.end,i=e.start;o&&(r.endTime=null!=o?o.getTime():null),i&&(r.startTime=null!=i?i.getTime():null)}readStopInterval(e,t,r){return e?ee.A.fromJSON({value:e.interval,unit:e.units},r):null}writeStopInterval(e,t,r,o){if(!e)return;const i=e.toJSON(o);(0,Y.sM)("properties.timeStopInterval",{interval:i.value,units:i.unit},t)}readStops(e){return e?.length?e.map((e=>new Date(e))):null}writeStops(e,t,r){e?.length&&(0,Y.sM)(r,e.map((e=>e.getTime())),t)}clone(){return new X((0,G.o8)({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};(0,o._)([(0,v.MZ)({type:O.A,json:{type:[[z.jz,z.Uv]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],te.prototype,"currentTimeExtent",void 0),(0,o._)([(0,b.w)("currentTimeExtent")],te.prototype,"readCurrentTimeExtent",null),(0,o._)([(0,S.K)("currentTimeExtent")],te.prototype,"writeCurrentTimeExtent",null),(0,o._)([(0,v.MZ)({type:O.A,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],te.prototype,"fullTimeExtent",void 0),(0,o._)([(0,b.w)("fullTimeExtent")],te.prototype,"readFullTimeExtent",null),(0,o._)([(0,S.K)("fullTimeExtent")],te.prototype,"writeFullTimeExtent",null),(0,o._)([(0,v.MZ)({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],te.prototype,"loop",void 0),(0,o._)([(0,v.MZ)({type:z.jz,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){const e=!!this.stopInterval,t=!!this.stops?.length,r=!(e||t);return{enabled:r,isRequired:r}}}}})],te.prototype,"numStops",void 0),(0,o._)([(0,v.MZ)({type:[1,2],nonNullable:!0,json:{type:z.jz,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],te.prototype,"numThumbs",void 0),(0,o._)([(0,v.MZ)({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],te.prototype,"stopDelay",void 0),(0,o._)([(0,v.MZ)({type:ee.A,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:Q.j.jsonValues.filter((e=>"esriTimeUnitsUnknown"!==e))}},overridePolicy(){const e=null!=this.numStops,t=!!this.stops?.length;return{enabled:!t,isRequired:!(e||t)}}}}})],te.prototype,"stopInterval",void 0),(0,o._)([(0,b.w)("stopInterval")],te.prototype,"readStopInterval",null),(0,o._)([(0,S.K)("stopInterval")],te.prototype,"writeStopInterval",null),(0,o._)([(0,v.MZ)({type:[Date],json:{type:[z.jz],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:null==this.numStops&&!this.stopInterval}}}}})],te.prototype,"stops",void 0),(0,o._)([(0,b.w)("stops")],te.prototype,"readStops",null),(0,o._)([(0,S.K)("stops")],te.prototype,"writeStops",null),te=X=(0,o._)([(0,_.$)("esri.webdoc.widgets.TimeSlider")],te);const re=te;var oe;let ie=oe=class extends F.A{constructor(e){super(e),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new oe((0,G.o8)({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};(0,o._)([(0,v.MZ)({type:H,json:{write:!0}})],ie.prototype,"range",void 0),(0,o._)([(0,v.MZ)({type:re,json:{write:!0}})],ie.prototype,"timeSlider",void 0),(0,o._)([(0,v.MZ)({type:B,json:{write:!0}})],ie.prototype,"floorFilter",void 0),ie=oe=(0,o._)([(0,_.$)("esri.webdoc.Widgets")],ie);const se=ie,ne={width:600,height:400},ae=1.5;var le=r(45417),ue=r(65308),de=r(79942),pe=r(71334),ce=r(70414);function ye(e,t){return t.resourceInfo?he(t,t.resourceInfo,{origin:e.origin}):t.portalItem?.id?async function(e,t,o){if(await o.load().catch((t=>{throw new u.A(`${e.name}:load-portal-item`,"Failed to load portal item",{error:t})})),o.type!==e.itemType)throw new u.A(`${e.name}:invalid-portal-item`,`Invalid portal item type '${o.type}', expected '${e.itemType}'`,{type:o.type});const i=await o.fetchData();t.resourceInfo=i;const s=(0,de.v)(o,e.origin);await function(e,t,r,o){const i=function(e,t){const r=e.parseVersion(t.version||"",e.name);return e.currentVersion.validate(r),t.version=`${r.major}.${r.minor}`,t}(e,r);return t.read(i,o),he(t,i,o)}(e,t,i,s),t.resourceReferences={portalItem:o,paths:s.readResourcePaths};const a=await async function(e,t,o){const i=e?.viewpoint?.targetGeometry;if(i)return null;const s=await async function(e,t,o){const i=e?.spatialReference,s=t?.extent;if(!i||!s)return null;if(i.isWGS84)return s.clone();if(i.isWebMercator)return(0,le.Gh)(s);const{getGeometryServiceURL:n}=await r.e(9483).then(r.bind(r,39483));try{const e=await n(t),r=new ce.A({geometries:[s],outSpatialReference:i});return(await(0,pe.C)(e,r))[0]}catch(x){o.error("Error projecting item's extent:",x)}return null}(e,t,o);return s?new n.A({targetGeometry:s}):null}(t.initialViewProperties,o,c.A.getLogger(t));if(a){const r=t.initialViewProperties?.clone()??e.createInitialViewProperties();r.viewpoint=a,t.initialViewProperties=r}}(e,t,t.portalItem):Promise.resolve()}function he(e,t,o){const i={context:{...o,layerContainerType:"operational-layers"}};return e.portalItem&&(i.context.portal=e.portalItem.portal||ue.A.getDefault()),r.e(5477).then(r.bind(r,60239)).then((r=>{let{populateOperationalLayers:o}=r;const s=[],n=t.operationalLayers;n?.length&&s.push(o(e.layers,n,i));const a={...i,context:{...i.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},l=t.tables;return l?.length&&s.push(o(e.tables,l,a)),Promise.allSettled(s).then((()=>{}))}))}var me=r(8837);function ge(e){return{enabled:!!e?.length}}var we,fe=r(6409),ve=r(6127);let be=we=class extends F.A{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new we({exactMatch:this.exactMatch,type:this.type,name:this.name})}};(0,o._)([(0,v.MZ)({type:Boolean,json:{write:!0}})],be.prototype,"exactMatch",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:!0}})],be.prototype,"name",void 0),(0,o._)([(0,fe.e)(ve.m)],be.prototype,"type",void 0),be=we=(0,o._)([(0,_.$)("esri.webdoc.applicationProperties.SearchLayerField")],be);const _e=be;var Se;let Ae=Se=class extends F.A{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new Se((0,G.o8)({field:this.field,id:this.id,subLayer:this.subLayer}))}};(0,o._)([(0,v.MZ)({type:_e,json:{write:{isRequired:!0}}})],Ae.prototype,"field",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Ae.prototype,"id",void 0),(0,o._)([(0,v.MZ)({type:z.jz,json:{write:!0}})],Ae.prototype,"subLayer",void 0),Ae=Se=(0,o._)([(0,_.$)("esri.webdoc.applicationProperties.SearchLayer")],Ae);const Te=Ae;var Ie;let Me=Ie=class extends F.A{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new Ie({exactMatch:this.exactMatch,type:this.type,name:this.name})}};(0,o._)([(0,v.MZ)({type:Boolean,json:{write:!0}})],Me.prototype,"exactMatch",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:!0}})],Me.prototype,"name",void 0),(0,o._)([(0,fe.e)(ve.m)],Me.prototype,"type",void 0),Me=Ie=(0,o._)([(0,_.$)("esri.webdoc.applicationProperties.SearchTableField")],Me);const Fe=Me;var je;let Ne=je=class extends F.A{constructor(e){super(e),this.field=null,this.id=null}clone(){return new je((0,G.o8)({field:this.field,id:this.id}))}};(0,o._)([(0,v.MZ)({type:Fe,json:{write:{isRequired:!0}}})],Ne.prototype,"field",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Ne.prototype,"id",void 0),Ne=je=(0,o._)([(0,_.$)("esri.webdoc.applicationProperties.SearchTable")],Ne);const Ze=Ne;var Ce;const Re=l.A.ofType(Te),ke=l.A.ofType(Ze);let Ee=Ce=class extends F.A{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new Re,this.tables=new ke}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,r){t[r]=!e}clone(){return new Ce((0,G.o8)({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};(0,o._)([(0,v.MZ)({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Ee.prototype,"addressSearchEnabled",void 0),(0,o._)([(0,b.w)("addressSearchEnabled")],Ee.prototype,"readAddressSearchEnabled",null),(0,o._)([(0,S.K)("addressSearchEnabled")],Ee.prototype,"writeAddressSearchEnabled",null),(0,o._)([(0,v.MZ)({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Ee.prototype,"enabled",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:!0}})],Ee.prototype,"hintText",void 0),(0,o._)([(0,v.MZ)({type:Re,json:{write:{overridePolicy:ge},origins:{"web-scene":{write:{isRequired:!0}}}}})],Ee.prototype,"layers",void 0),(0,o._)([(0,v.MZ)({type:ke,json:{read:!0,write:{overridePolicy:ge}}})],Ee.prototype,"tables",void 0),Ee=Ce=(0,o._)([(0,_.$)("esri.webdoc.applicationProperties.Search")],Ee);const xe=Ee;var Le;let Oe=Le=class extends F.A{constructor(e){super(e),this.search=null}clone(){return new Le((0,G.o8)({search:this.search}))}};(0,o._)([(0,v.MZ)({type:xe,json:{write:!0}})],Oe.prototype,"search",void 0),Oe=Le=(0,o._)([(0,_.$)("esri.webdoc.applicationProperties.Viewing")],Oe);const Ue=Oe;var Ge;let Ve=Ge=class extends F.A{constructor(e){super(e),this.editing=null,this.offline=null,this.viewing=null}clone(){return new Ge((0,G.o8)({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};(0,o._)([(0,v.MZ)({json:{write:!0}})],Ve.prototype,"editing",void 0),(0,o._)([(0,v.MZ)({json:{write:!0}})],Ve.prototype,"offline",void 0),(0,o._)([(0,v.MZ)({type:Ue,json:{write:!0}})],Ve.prototype,"viewing",void 0),Ve=Ge=(0,o._)([(0,_.$)("esri.webmap.ApplicationProperties")],Ve);const Pe=Ve;var $e,Je=r(5632),Be=r(21403);let De=$e=class extends F.A{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return(0,f.m3)(this.url)}get isDataURI(){return(0,f.DB)(this.url)}clone(){return new $e({url:this.url})}};(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],De.prototype,"url",void 0),(0,o._)([(0,v.MZ)()],De.prototype,"isSecureUrl",null),(0,o._)([(0,v.MZ)()],De.prototype,"isDataURI",null),De=$e=(0,o._)([(0,_.$)("esri.webdoc.support.SlideThumbnail")],De);const qe={type:O.A,json:{read:{source:"timeExtent",reader:e=>e?Array.isArray(e)?O.A.fromArray(e):O.A.fromJSON(e):null},write:{writer:(e,t,r,o)=>{e&&(e.isEmpty?o?.messages&&o.messages.push(new u.A("invalid-timeExtent","TimeExtent cannot be empty")):t[r]=e.toArray())},target:{timeExtent:{type:[[z.jz,z.Uv]]}}}}};var ze;let We=ze=class extends(Je.A.IdentifiableMixin(F.A)){constructor(e){super(e),this.name=null,this.thumbnail=new De,this.timeExtent=null}castThumbnail(e){return"string"==typeof e?new De({url:e}):(0,z.dp)(De,e)}set viewpoint(e){const{targetGeometry:t,scale:r}=e;null!=t&&"point"===t.type&&null==r&&c.A.getLogger(this).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",e),this._set("viewpoint",e)}readViewpoint(e,t){const{extent:r,viewpoint:o}=t;return n.A.fromJSON(o||{targetGeometry:r})}writeViewpoint(e,t,r,o){if(!e)return;const{targetGeometry:i}=e;if(null==i||"extent"===i.type)null!=i&&(t.extent=i.toJSON()),t[r]=e.toJSON();else{const e="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";o?.messages?o.messages.push(new u.A("property:unsupported",e)):c.A.getLogger(this).error(e)}}clone(){return new ze((0,G.o8)({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};(0,o._)([(0,v.MZ)({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],We.prototype,"name",void 0),(0,o._)([(0,v.MZ)({type:De,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.url)})}}})],We.prototype,"thumbnail",void 0),(0,o._)([(0,Be.w)("thumbnail")],We.prototype,"castThumbnail",null),(0,o._)([(0,v.MZ)(qe)],We.prototype,"timeExtent",void 0),(0,o._)([(0,v.MZ)({type:n.A,nonNullable:!0,json:{write:!0}})],We.prototype,"viewpoint",null),(0,o._)([(0,b.w)("viewpoint",["extent","viewpoint"])],We.prototype,"readViewpoint",null),(0,o._)([(0,S.K)("viewpoint")],We.prototype,"writeViewpoint",null),We=ze=(0,o._)([(0,_.$)("esri.webmap.Bookmark")],We);const Ke=We;var He=r(91967),Xe=r(69098),Ye=r(36693),Qe=r(9409);let et=class extends(Xe.A.ClonableMixin(He.A)){constructor(e){super(e),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.timeExtent=null,this.timeZone=Ye.qU,this.viewpoint=null}};(0,o._)([(0,v.MZ)({type:Qe.A})],et.prototype,"background",void 0),(0,o._)([(0,v.MZ)({type:P})],et.prototype,"rangeInfo",void 0),(0,o._)([(0,v.MZ)({type:T.A})],et.prototype,"spatialReference",void 0),(0,o._)([(0,v.MZ)({type:O.A})],et.prototype,"timeExtent",void 0),(0,o._)([(0,v.MZ)({nonNullable:!0})],et.prototype,"timeZone",void 0),(0,o._)([(0,v.MZ)({type:n.A})],et.prototype,"viewpoint",void 0),et=(0,o._)([(0,_.$)("esri.webmap.InitialViewProperties")],et);const tt=et;var rt=r(90761);const ot=l.A.ofType(Ke),it=new Map([["image/jpeg","jpeg"],["image/jpg","jpg"],["image/png","png"],["image/gif","gif"]]),st=M.mm.JSAPI;let nt=class extends((0,h.P)(d.A.LoadableMixin(m.A.EsriPromiseMixin(s.A)))){constructor(e){super(e),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this.resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new ot,this.floorInfo=null,this.initialViewProperties=new tt,this.portalItem=null,this.sourceVersion=null,this.widgets=null,this._debouncedSaveOperations=(0,g.sg)((async(e,t,o)=>{const{save:i,saveAs:s}=await r.e(339).then(r.bind(r,20339));switch(e){case U.X.SAVE:return i(this.context,this,t);case U.X.SAVE_AS:return s(this.context,this,o,t)}})),this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){this.portalItem=(0,y.pR)(this.portalItem)}initialize(){if(this.when().catch((e=>{c.A.getLogger(this).error("#load()","Failed to load web map",e)})),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(ge){return void this.addResolvingPromise(Promise.reject(ge))}this.read(e)}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp=st}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=i.rE}readInitialViewProperties(e,t){const r=new tt;t.background&&(r.background=Qe.A.fromJSON(t.background));const o=t.initialState?.timeExtent;o&&(r.timeExtent=O.A.fromArray(o));const i=t.initialState?.viewpoint;return i&&(i.rotation&&rt.R.parse(t.version||"","webmap").lessThan(2,20)&&"ArcGIS Pro"===t.authoringApp&&(i.rotation*=-1),r.viewpoint=n.A.fromJSON(i)),t.mapRangeInfo&&(r.rangeInfo=P.fromJSON(t.mapRangeInfo)),t.spatialReference&&(r.spatialReference=T.A.fromJSON(t.spatialReference)),t.timeZone&&(r.timeZone=t.timeZone),r}writeInitialViewProperties(e,t,r,o){if(!e)return;e.background?.color&&(t.background=e.background.write({},o));const{timeExtent:i,viewpoint:s}=e;if(s||i){const e={};s&&(e.viewpoint=s.write({},o)),i&&(e.timeExtent=i.toArray()),t.initialState=e}e.rangeInfo&&(t.mapRangeInfo=e.rangeInfo.toJSON(o)),e.spatialReference&&(t.spatialReference=e.spatialReference.write({},o)),t.timeZone=e.timeZone}writeLayers(e,t,r,o){t[r]=this._writeLayers(e,o,"operational-layers")}readSourceVersion(e,t){const[r,o]=t.version.split(".");return new rt.R(parseInt(r,10),parseInt(o,10))}writeSourceVersion(e,t,r){t[r]=`${this.context.currentVersion.major}.${this.context.currentVersion.minor}`}writeTables(e,t,r,o){const i=this._writeLayers(e,o,"tables");i.length&&(t[r]=i)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}get updatingFromView(){return!!this._updateFromPromise}load(e){return this.addResolvingPromise(ye(this.context,this)),Promise.resolve(this)}loadAll(){return(0,p.g)(this,(e=>{e(this.ground,this.basemap,this.layers,this.tables)}))}read(e,t){t={...t,origin:this.context.origin};const r=this._getAuthoringPropsState();(0,A.t)(this,e,(t=>super.read(e,t)),t),this._restoreAuthoringPropsFromState(r)}write(e,t){if("loaded"!==this.loadStatus){const e=new u.A("webmap:not-loaded","Web map must be loaded before it can be serialized");throw c.A.getLogger(this).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),e}return this._removeDanglingLayerRefs(),t={...t,origin:this.context.origin,restrictedWebMapWriting:!0,webmap:this},super.write(e,t)}async save(e){return this._debouncedSaveOperations(U.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(U.X.SAVE_AS,t,e)}async updateFrom(e,t){const r=this._updateFromInternal(e,t);this._updateFromPromise=r,await r,r===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(e){const t=this.resourceInfo;return this._collectAllLayersJSON([...t?.baseMap?.baseMapLayers||[],...t?.operationalLayers||[],...this.basemap?.resourceInfo?.data?.baseMapLayers||[]]).find((t=>t.id===e.id))}async updateItemThumbnail(){this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await(this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})),this._clearThumbnailOverride())}getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:(0,f.rs)(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}_collectAllLayersJSON(e){return e.reduce(((e,t)=>(e.push(t),"GroupLayer"===t.layerType&&(e=e.concat(this._collectAllLayersJSON(t.layers||[]))),e)),[])}_writeLayers(e,t,r){return t={...t,layerContainerType:r},e.map((e=>(0,me.CJ)(e,"tables"===r?null:this.getLayerJSONFromResourceInfo(e),t))).filter(a.Ru).toArray()}_validateJSON(e){const t=rt.R.parse(e.version||"","webmap");return this.context.currentVersion.validate(t),e.version=`${t.major}.${t.minor}`,e}_removeDanglingLayerRefs(){const e=this.applicationProperties,t=e?.viewing?.search,r=e=>this.allLayers.some((t=>t.id===e));if(t?.layers&&(t.layers=t.layers.filter((e=>r(e.id)))),t?.tables&&(t.tables=t.tables.filter((e=>this.tables.some((t=>t.id===e.id))))),e){const t=e.editing?.locationTracking;t?.info&&!r(t.info.layerId)&&(e.editing=null)}const o="presentation"in this?this.presentation:null,i=o?.slides;i&&i.forEach((e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((e=>r(e.id))))}))}async _updateFromInternal(e,t){if(t??={},await(0,w.C_)((()=>e.ready)),this._updateInitialViewProperties(e,t),e.map===this)for(const r of e.allLayerViews)"visible"in r&&"visible"in r.layer&&r._isOverridden("visible")&&(r.layer.visible=r.visible),"featureEffect"in r&&"featureEffect"in r.layer&&r._isOverridden("featureEffect")&&(r.layer.featureEffect=r.featureEffect);await this._updateThumbnailUrl(e,t)}_updateInitialViewProperties(e,t){if(t.backgroundExcluded||(this.initialViewProperties.background=e.background?.clone()),this.initialViewProperties.spatialReference=e.spatialReference?.clone(),this.initialViewProperties.timeZone=e.timeZone,t.viewpointExcluded||(this.initialViewProperties.viewpoint=new n.A({rotation:e.rotation,scale:t.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!t.widgetsExcluded)for(const r of e.persistableViewModels)r.updateWebDocument(this)}_getViewExtent(e){const t=e.center.clone().normalize(),r=e.extent.clone(),o=r.width/2;return r.xmin=t.x-o,r.xmax=t.x+o,r}async _updateThumbnailUrl(e,t){if(t.thumbnailExcluded)return;const r=function(e,t){t=t||ne;let{width:r,height:o}=t;const i=r/o;return i<ae?o=r/ae:i>ae&&(r=o*ae),r>e.width&&(o*=e.width/r,r=e.width),o>e.height&&(r*=e.height/o,o=e.height),{width:Math.round(r),height:Math.round(o)}}(e,t.thumbnailSize),o=await e.takeScreenshot({format:"png",width:r.width,height:r.height});this._setAutoGeneratedThumbnail(o.dataUrl)}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(e){if((0,f.DB)(e)){const t=(0,f.r$)(e),r=t?.mediaType,o=r&&it.get(r.toLowerCase())||null,i=`thumbnail${Date.now()}`;return o?`${i}.${o}`:i}return null}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}};(0,o._)([(0,v.MZ)()],nt.prototype,"_updateFromPromise",void 0),(0,o._)([(0,v.MZ)({type:Pe,json:{write:!0}})],nt.prototype,"applicationProperties",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],nt.prototype,"authoringApp",null),(0,o._)([(0,S.K)("authoringApp")],nt.prototype,"writeAuthoringApp",null),(0,o._)([(0,v.MZ)({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],nt.prototype,"authoringAppVersion",null),(0,o._)([(0,S.K)("authoringAppVersion")],nt.prototype,"writeAuthoringAppVersion",null),(0,o._)([(0,v.MZ)({type:ot,json:{write:{overridePolicy:e=>({enabled:!!(e&&e.length>0),ignoreOrigin:!0})}}})],nt.prototype,"bookmarks",void 0),(0,o._)([(0,v.MZ)({type:x,json:{name:"mapFloorInfo",write:!0}})],nt.prototype,"floorInfo",void 0),(0,o._)([(0,v.MZ)({type:tt,nonNullable:!0,json:{read:{source:["background","initialState.timeExtent","initialState.viewpoint","mapRangeInfo","spatialReference","timeZone"]},write:{ignoreOrigin:!0,target:{background:{type:Qe.A},"initialState.timeExtent":{type:O.A},"initialState.viewpoint":{type:n.A},mapRangeInfo:{type:P},spatialReference:{type:T.A},"timeZone:":{type:String}}}}})],nt.prototype,"initialViewProperties",void 0),(0,o._)([(0,b.w)("initialViewProperties")],nt.prototype,"readInitialViewProperties",null),(0,o._)([(0,S.K)("initialViewProperties")],nt.prototype,"writeInitialViewProperties",null),(0,o._)([(0,v.MZ)({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],nt.prototype,"layers",void 0),(0,o._)([(0,S.K)("layers")],nt.prototype,"writeLayers",null),(0,o._)([(0,v.MZ)({type:I.default})],nt.prototype,"portalItem",void 0),(0,o._)([(0,v.MZ)()],nt.prototype,"resourceInfo",void 0),(0,o._)([(0,v.MZ)({readOnly:!0,type:rt.R,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],nt.prototype,"sourceVersion",void 0),(0,o._)([(0,b.w)("sourceVersion")],nt.prototype,"readSourceVersion",null),(0,o._)([(0,S.K)("sourceVersion")],nt.prototype,"writeSourceVersion",null),(0,o._)([(0,v.MZ)({json:{read:!1,write:{ignoreOrigin:!0}}})],nt.prototype,"tables",void 0),(0,o._)([(0,S.K)("tables")],nt.prototype,"writeTables",null),(0,o._)([(0,v.MZ)()],nt.prototype,"thumbnailUrl",null),(0,o._)([(0,v.MZ)()],nt.prototype,"updatingFromView",null),(0,o._)([(0,v.MZ)({type:se,json:{write:!0}})],nt.prototype,"widgets",void 0),nt=(0,o._)([(0,_.$)("esri.WebDocument2D")],nt);const at=nt;var lt=r(83475);let ut=class extends(Xe.A.ClonableMixin(F.A)){constructor(e){super(e),this.expression=null,this.returnType="string",this.title=null}};(0,o._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],ut.prototype,"expression",void 0),(0,o._)([(0,v.MZ)({type:["number","string"],json:{write:!0}})],ut.prototype,"returnType",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:!0}})],ut.prototype,"title",void 0),ut=(0,o._)([(0,_.$)("esri.webdoc.geotriggersInfo.ExpressionInfo")],ut);const dt=ut,pt=new q.J({deviceLocation:"device-location"});let ct=class extends(Xe.A.ClonableMixin(F.A)){constructor(e){super(e),this.filterExpression=null,this.type="device-location"}};(0,o._)([(0,v.MZ)({type:dt,json:{write:!0}})],ct.prototype,"filterExpression",void 0),(0,o._)([(0,v.MZ)({type:pt.apiValues,readOnly:!0,json:{type:pt.jsonValues,read:pt.read,write:pt.write}})],ct.prototype,"type",void 0),ct=(0,o._)([(0,_.$)("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],ct);const yt=ct;var ht=r(19902),mt=r(31608);let gt=class extends(Xe.A.ClonableMixin(F.A)){constructor(e){super(e),this.geometry=null,this.where=null}};(0,o._)([(0,v.MZ)({types:mt.yR,json:{read:ht.rS,write:!0}})],gt.prototype,"geometry",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:!0}})],gt.prototype,"where",void 0),gt=(0,o._)([(0,_.$)("esri.webdoc.geotriggersInfo.FeatureFilter")],gt);const wt=gt;let ft=class extends(Xe.A.ClonableMixin(F.A)){constructor(e){super(e),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};(0,o._)([(0,v.MZ)({type:String,json:{write:{overridePolicy(){return{isRequired:null===this.layerUrl}}}}})],ft.prototype,"layerId",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:{overridePolicy(){return{isRequired:null===this.layerId}}}}})],ft.prototype,"layerUrl",void 0),(0,o._)([(0,fe.e)({featureLayer:"feature-layer"},{readOnly:!0})],ft.prototype,"type",void 0),ft=(0,o._)([(0,_.$)("esri.webdoc.geotriggersInfo.FeatureLayerSource")],ft);const vt=ft;let bt=class extends(Xe.A.ClonableMixin(F.A)){constructor(e){super(e),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};(0,o._)([(0,v.MZ)({type:vt,json:{write:{isRequired:!0}}})],bt.prototype,"fenceSource",void 0),(0,o._)([(0,v.MZ)({type:wt,json:{write:!0}})],bt.prototype,"filter",void 0),(0,o._)([(0,v.MZ)({type:Number,json:{write:!0}})],bt.prototype,"bufferDistance",void 0),(0,o._)([(0,fe.e)({features:"features"},{readOnly:!0})],bt.prototype,"type",void 0),bt=(0,o._)([(0,_.$)("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],bt);const _t=bt;let St=class extends(Xe.A.ClonableMixin(F.A)){constructor(e){super(e),this.type="fence"}};(0,o._)([(0,fe.e)({fence:"fence"},{readOnly:!0})],St.prototype,"type",void 0),St=(0,o._)([(0,_.$)("esri.webdoc.geotriggersInfo.Geotrigger")],St);const At=St;let Tt=class extends(Xe.A.ClonableMixin(F.A)){constructor(e){super(e),this.expressionInfo=null,this.requestedActions=null}};(0,o._)([(0,v.MZ)({type:dt,json:{write:!0}})],Tt.prototype,"expressionInfo",void 0),(0,o._)([(0,v.MZ)({type:[String],json:{write:!0}})],Tt.prototype,"requestedActions",void 0),Tt=(0,o._)([(0,_.$)("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],Tt);const It=Tt,Mt=new q.J({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),Ft=new q.J({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),jt=new q.J({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let Nt=class extends At{constructor(e){super(e),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};(0,o._)([(0,fe.e)(Mt)],Nt.prototype,"enterExitRule",void 0),(0,o._)([(0,v.MZ)({type:yt,json:{write:{isRequired:!0}}})],Nt.prototype,"feed",void 0),(0,o._)([(0,fe.e)(Ft)],Nt.prototype,"feedAccuracyMode",void 0),(0,o._)([(0,v.MZ)({type:jt.apiValues,json:{type:jt.jsonValues,read:jt.read,write:{writer:jt.write,isRequired:!0}}})],Nt.prototype,"fenceNotificationRule",void 0),(0,o._)([(0,v.MZ)({type:_t,json:{write:{isRequired:!0}}})],Nt.prototype,"fenceParameters",void 0),(0,o._)([(0,v.MZ)({type:String,json:{write:!0}})],Nt.prototype,"name",void 0),(0,o._)([(0,v.MZ)({type:It,json:{write:!0}})],Nt.prototype,"notificationOptions",void 0),(0,o._)([(0,fe.e)({fence:"fence"},{readOnly:!0})],Nt.prototype,"type",void 0),Nt=(0,o._)([(0,_.$)("esri.webdoc.geotriggersInfo.FenceGeotrigger")],Nt);const Zt={base:At,key:"type",typeMap:{fence:Nt}};let Ct=class extends(Xe.A.ClonableMixin(F.A)){constructor(e){super(e),this.geotriggers=null}};(0,o._)([(0,v.MZ)({types:[Zt],json:{write:{isRequired:!0}}})],Ct.prototype,"geotriggers",void 0),Ct=(0,o._)([(0,_.$)("esri.webdoc.GeotriggersInfo")],Ct);const Rt=Ct;let kt=class extends(Xe.A.ClonableMixin(F.A)){constructor(e){super(e),this.portalItem=null}readPortalItem(e,t,r){const{itemId:o}=t;if(o)return new I.default({id:o,portal:r?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}};(0,o._)([(0,v.MZ)({type:I.default,json:{write:{isRequired:!0}}})],kt.prototype,"portalItem",void 0),(0,o._)([(0,b.w)("portalItem",["itemId"])],kt.prototype,"readPortalItem",null),(0,o._)([(0,S.K)("portalItem",{itemId:{type:String}})],kt.prototype,"writePortalItem",null),kt=(0,o._)([(0,_.$)("esri.webdoc.ips.PositioningService")],kt);const Et=kt;let xt=class extends(Xe.A.ClonableMixin(F.A)){constructor(e){super(e),this.positioningService=null}};(0,o._)([(0,v.MZ)({type:Et,json:{write:{isRequired:!0}}})],xt.prototype,"positioningService",void 0),xt=(0,o._)([(0,_.$)("esri.webdoc.IPSInfo")],xt);const Lt=xt;var Ot=r(42052);const Ut={currentVersion:Ot.Y,createInitialViewProperties:()=>new tt,parseVersion:rt.R.parse,itemType:"Web Map",name:"webmap",origin:"web-map"},Gt=l.A.ofType(lt.default);let Vt=class extends at{constructor(e){super(e),this.geotriggersInfo=null,this.ipsInfo=null,this.presentation=null,this.utilityNetworks=null}destroy(){if(this.utilityNetworks){const e=this.utilityNetworks.removeAll();for(const t of e)t.destroy();this.utilityNetworks.destroy()}}get context(){return Ut}loadAll(){return(0,p.g)(this,(e=>{e(this.ground,this.basemap,this.layers,this.tables,this.ipsInfo?.positioningService?.portalItem)}))}static fromJSON(e){if(e)return new this({resourceInfo:e});throw new u.A("webmap:empty-resource","Expected a JSON resource but got nothing")}};Vt.VERSION=Ot.Y,(0,o._)([(0,v.MZ)({type:Rt,json:{write:!0}})],Vt.prototype,"geotriggersInfo",void 0),(0,o._)([(0,v.MZ)({type:Lt,json:{write:!0,name:"mapIPSInfo"}})],Vt.prototype,"ipsInfo",void 0),(0,o._)([(0,v.MZ)({json:{write:!0}})],Vt.prototype,"presentation",void 0),(0,o._)([(0,v.MZ)({type:Gt,json:{read:!0,write:!0}})],Vt.prototype,"utilityNetworks",void 0),Vt=(0,o._)([(0,_.$)("esri.WebMap")],Vt);const Pt=Vt},12899:(e,t,r)=>{r.d(t,{BD:()=>u,D2:()=>o,XZ:()=>a,fO:()=>n,v9:()=>l});var o,i,s=r(45802);(i=o||(o={}))[i.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",i[i.RTContainment=2]="RTContainment",i[i.RTAttachment=3]="RTAttachment",i[i.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",i[i.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity";const n=new s.J({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"}),a=new s.J({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionEdgeMidspanConnectivity:"junction-edge-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"}),l={connectivity:1,"junction-junction-connectivity":1,containment:2,attachment:3,"junction-edge-from-connectivity":4,"junction-edge-midspan-connectivity":5,"junction-edge-to-connectivity":6},u=new s.J({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"})},28009:(e,t,r)=>{function o(e){const t=e?.fieldsIndex,r="fromnetworksourceid",o="fromglobalid",i="fromterminalid",s="tonetworksourceid",n="toglobalid",a="toterminalid",l="status",u="associationtype",d="iscontentvisible",p="percentalong",c="globalid";return{fromNetworkSourceId:t?.get(r)?.name??r,fromGlobalId:t?.get(o)?.name??o,fromTerminalId:t?.get(i)?.name??i,toNetworkSourceId:t?.get(s)?.name??s,toGlobalId:t?.get(n)?.name??n,toTerminalId:t?.get(a)?.name??a,status:t?.get(l)?.name??l,associationType:t?.get(u)?.name??u,isContentVisible:t?.get(d)?.name??d,percentAlong:t?.get(p)?.name??p,globalId:t?.get(e?.globalIdField??c)?.name??c}}function i(e,t){if("feature"!==t.type&&"subtype-group"!==t.type)return[];if(!t.url)return[];const r="utilityNetworks"in e.map?e.map.utilityNetworks??[]:[];for(const o of r)if(o.isUtilityLayer(t)){const e=t.fieldsIndex.get("assetgroup"),r=t.fieldsIndex.get("assettype");return[e?.name,r?.name].filter((e=>null!=e))}return[]}r.d(t,{E:()=>o,_:()=>i})},57778:(e,t,r)=>{r.d(t,{A:()=>g});var o=r(35143),i=r(42553),s=r(46053),n=(r(81806),r(76460),r(47249),r(85842)),a=r(66388),l=r(65215),u=r(23701);let d=class extends i.A{constructor(e){super(e),this.line=null,this.multipoint=null,this.polygon=null}};(0,o._)([(0,s.MZ)({type:u.A,json:{write:!0},readOnly:!0})],d.prototype,"line",void 0),(0,o._)([(0,s.MZ)({type:a.A,json:{read:{source:"point"},write:{target:"point"}},readOnly:!0})],d.prototype,"multipoint",void 0),(0,o._)([(0,s.MZ)({type:l.A,json:{write:!0},readOnly:!0})],d.prototype,"polygon",void 0),d=(0,o._)([(0,n.$)("esri.rest.networks.support.AggregatedGeometry")],d);const p=d;let c=class extends i.A{constructor(e){super(e),this.functionType=null,this.networkAttributeName=null,this.result=null}};(0,o._)([(0,s.MZ)({type:["add","subtract","average","count","min","max"],json:{write:!0},readOnly:!0})],c.prototype,"functionType",void 0),(0,o._)([(0,s.MZ)({type:String,json:{write:!0},readOnly:!0})],c.prototype,"networkAttributeName",void 0),(0,o._)([(0,s.MZ)({type:Number,json:{write:!0},readOnly:!0})],c.prototype,"result",void 0),c=(0,o._)([(0,n.$)("esri.rest.networks.support.FunctionResult")],c);const y=c;var h=r(64533);let m=class extends i.A{constructor(e){super(e),this.aggregatedGeometry=null,this.elements=null,this.globalFunctionResults=null,this.kFeaturesForKNNFound=!1,this.startingPointsIgnored=!1,this.warnings=null}};(0,o._)([(0,s.MZ)({type:p,json:{write:!0},readOnly:!0})],m.prototype,"aggregatedGeometry",void 0),(0,o._)([(0,s.MZ)({type:[h.A],json:{write:!0},readOnly:!0})],m.prototype,"elements",void 0),(0,o._)([(0,s.MZ)({type:[y],json:{write:!0},readOnly:!0})],m.prototype,"globalFunctionResults",void 0),(0,o._)([(0,s.MZ)({type:Boolean,json:{write:!0},readOnly:!0})],m.prototype,"kFeaturesForKNNFound",void 0),(0,o._)([(0,s.MZ)({type:Boolean,json:{write:!0},readOnly:!0})],m.prototype,"startingPointsIgnored",void 0),(0,o._)([(0,s.MZ)({type:[String],json:{write:!0},readOnly:!0})],m.prototype,"warnings",void 0),m=(0,o._)([(0,n.$)("esri.rest.networks.support.TraceResult")],m);const g=m},64154:(e,t,r)=>{r.d(t,{A:()=>l});var o=r(35143),i=r(46053),s=(r(81806),r(76460),r(47249),r(85842)),n=r(79685);let a=class extends n.A{constructor(e){super(e),this.filterBarriers=[],this.arcadeExpressionBarrier=null,this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.allowIndeterminateFlow=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.diagramTemplateName=null,this.tierName=null,this.validateLocatability=null}};(0,o._)([(0,i.MZ)({type:[Object],json:{write:!0}})],a.prototype,"filterBarriers",void 0),(0,o._)([(0,i.MZ)({type:String,json:{write:!0}})],a.prototype,"arcadeExpressionBarrier",void 0),(0,o._)([(0,i.MZ)({type:String,json:{write:!0}})],a.prototype,"domainNetworkName",void 0),(0,o._)([(0,i.MZ)({type:String,json:{write:!0}})],a.prototype,"filterBitsetNetworkAttributeName",void 0),(0,o._)([(0,i.MZ)({type:[Object],json:{write:!0}})],a.prototype,"filterFunctionBarriers",void 0),(0,o._)([(0,i.MZ)({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],a.prototype,"filterScope",void 0),(0,o._)([(0,i.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeContainers",void 0),(0,o._)([(0,i.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeContent",void 0),(0,o._)([(0,i.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeIsolated",void 0),(0,o._)([(0,i.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeStructures",void 0),(0,o._)([(0,i.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"allowIndeterminateFlow",void 0),(0,o._)([(0,i.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeUpToFirstSpatialContainer",void 0),(0,o._)([(0,i.MZ)({type:Object,json:{write:!0}})],a.prototype,"nearestNeighbor",void 0),(0,o._)([(0,i.MZ)({type:[Object],json:{write:!0}})],a.prototype,"outputFilterCategories",void 0),(0,o._)([(0,i.MZ)({type:[Object],json:{write:!0}})],a.prototype,"outputFilters",void 0),(0,o._)([(0,i.MZ)({type:[Object],json:{write:!0}})],a.prototype,"propagators",void 0),(0,o._)([(0,i.MZ)({type:String,json:{write:!0}})],a.prototype,"subnetworkName",void 0),(0,o._)([(0,i.MZ)({type:String,json:{write:!0}})],a.prototype,"targetTierName",void 0),(0,o._)([(0,i.MZ)({type:String,json:{write:!0}})],a.prototype,"diagramTemplateName",void 0),(0,o._)([(0,i.MZ)({type:String,json:{write:!0}})],a.prototype,"tierName",void 0),(0,o._)([(0,i.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"validateLocatability",void 0),a=(0,o._)([(0,s.$)("esri.networks.support.UNTraceConfiguration")],a);const l=a},70414:(e,t,r)=>{r.d(t,{A:()=>p});var o=r(35143),i=r(42553),s=r(46053),n=(r(81806),r(76460),r(47249),r(85842)),a=r(13312),l=r(19902),u=r(80963);let d=class extends i.A{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((e=>e.toJSON())),t=this.geometries[0],r={};return r.outSR=(0,u.YX)(this.outSpatialReference),r.inSR=(0,u.YX)(t.spatialReference),r.geometries=JSON.stringify({geometryType:(0,l.$B)(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}};(0,o._)([(0,s.MZ)()],d.prototype,"geometries",void 0),(0,o._)([(0,s.MZ)({type:a.A,json:{read:{source:"outSR"}}})],d.prototype,"outSpatialReference",void 0),(0,o._)([(0,s.MZ)()],d.prototype,"transformation",void 0),(0,o._)([(0,s.MZ)()],d.prototype,"transformForward",void 0),d=(0,o._)([(0,n.$)("esri.rest.support.ProjectParameters")],d);const p=d},71334:(e,t,r)=>{r.d(t,{C:()=>d});var o=r(3825),i=r(40565),s=r(19902),n=r(54994),a=r(71838),l=r(70414);const u=(0,i.dp)(l.A);async function d(e,t,r){t=u(t);const i=(0,n.Dl)(e),l={...i.query,f:"json",...t.toJSON()},d=t.outSpatialReference,p=(0,s.$B)(t.geometries[0]),c=(0,n.jV)(l,r);return(0,o.A)(i.path+"/project",c).then((e=>{let{data:{geometries:t}}=e;return(0,a.V)(t,p,d)}))}},79685:(e,t,r)=>{r.d(t,{A:()=>l});var o=r(35143),i=r(42553),s=r(46053),n=(r(81806),r(76460),r(47249),r(85842));let a=class extends i.A{constructor(e){super(e),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};(0,o._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"conditionBarriers",void 0),(0,o._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"outputConditions",void 0),(0,o._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"functions",void 0),(0,o._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"functionBarriers",void 0),(0,o._)([(0,s.MZ)({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],a.prototype,"traversabilityScope",void 0),(0,o._)([(0,s.MZ)({type:String,json:{write:!0}})],a.prototype,"shortestPathNetworkAttributeName",void 0),(0,o._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeBarriers",void 0),(0,o._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"validateConsistency",void 0),(0,o._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"ignoreBarriersAtStartingPoints",void 0),a=(0,o._)([(0,n.$)("esri.networks.support.TraceConfiguration")],a);const l=a},79942:(e,t,r)=>{r.d(t,{m:()=>n,v:()=>s});var o=r(90534),i=r(65308);function s(e,t){return{...a(e,t),readResourcePaths:[]}}function n(e,t,r){const i=(0,o.An)(e.itemUrl);return{...a(e,t),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:i?{rootPath:i.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function a(e,t){return{origin:t,url:(0,o.An)(e.itemUrl),portal:e.portal||i.A.getDefault(),portalItem:e}}},83475:(e,t,r)=>{r.d(t,{default:()=>ee});var o=r(35143),i=r(39356),s=r(46053),n=(r(81806),r(76460)),a=(r(47249),r(85842)),l=r(38451),u=r(74438),d=r(3825),p=r(50076),c=r(49304),y=r(77717),h=r(50346),m=r(90534),g=r(76797),w=r(13312),f=r(19902),v=r(61979),b=r(13096),_=r(45802),S=r(6409),A=r(11187);const T=(0,_.O)()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let I=class extends A.A{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const t={...e,query:{f:"json"}},{data:r}=await(0,d.A)(this.statusUrl,t);return this.read(r),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this}async waitForJobCompletion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{interval:t=1e3,statusCallback:r}=e;return new Promise(((e,o)=>{this._clearTimer();const i=setInterval((()=>{this._timer||o((0,h.NK)()),this.checkJobStatus().then((t=>{const{status:o}=t;switch(this.status=o,o){case"job-succeeded":this._clearTimer(),e(this);break;case"job-waiting":case"job-executing":r&&r(this)}}),(e=>{this._clearTimer(),o(e)}))}),t);this._timer=i}))}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};(0,o._)([(0,s.MZ)()],I.prototype,"editsResolver",void 0),(0,o._)([(0,s.MZ)({type:String,json:{write:!0}})],I.prototype,"statusUrl",void 0),(0,o._)([(0,S.e)(T)],I.prototype,"status",void 0),(0,o._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],I.prototype,"submissionTime",void 0),(0,o._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],I.prototype,"lastUpdatedTime",void 0),I=(0,o._)([(0,a.$)("esri.networks.support.TopologyValidationJobInfo")],I);const M=I;var F=r(70652);r(77725);async function j(e,t){if("Utility Network Layer"===e){const{default:e}=await Promise.resolve().then(r.bind(r,83475));return new e({layerUrl:t})}return null}var N=r(35298);let Z=class extends((0,y.P)(c.A)){static fromPortalItem(e){return async function(e){let t="portalItem"in e?e:{portalItem:e};!t.portalItem||t.portalItem instanceof F.default||(t={...t,portalItem:new F.default(t.portalItem)});const r=t.portalItem;if(await r.load(),"Feature Service"!==r.type)throw new p.A("portal:unknown-item-type","Unknown item type '${type}'",{type:r.type});const o=r.url,i=await(0,d.A)(o,{responseType:"json",query:{f:"json"}}),s="Network Layer";if(i.data.type?.includes(s))return j(i.data.type,o);if(i.data.layers){const e=i.data.layers.find((e=>e.type.includes(s)));if(e){const t=`${o}/${e.id}`;return j(e.type,t)}}return null}(e)}constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this.gdbVersion=null,this.historicMoment=null,this._sourceIdByLayerId=new Map,this._layerIdBySourceId=new Map,this._applyEditsHandler=e=>{const{serviceUrl:t,gdbVersion:r,result:o}=e,i=t===this.featureServiceUrl,s=(0,v.gz)(t,r,this.gdbVersion);i&&s&&o.then((e=>{(0,N.w5)(t,r)&&(this.historicMoment=e.historicMoment)}))},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:r,moment:o}=e,i=t===this.featureServiceUrl,s=(0,v.gz)(t,r,this.gdbVersion);i&&s&&(this.historicMoment=o)},this.when().then((()=>{this.addHandles([(0,v.Jz)(this._applyEditsHandler),(0,v.dP)(this._updateMomentHandler)])}),(()=>{}))}initialize(){this.when().catch((e=>{(0,h.zf)(e)||n.A.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})}))}get datasetName(){return this.dataElement?.name??null}get owner(){return this.dataElement?.userIdentity??null}get schemaGeneration(){return this.dataElement?.schemaGeneration??null}get parsedUrl(){return(0,m.An)(this.layerUrl)}get featureServiceUrl(){return(0,b.qg)(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return(0,b.qg)(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(!this.dataElement)return null;const t=this._layerIdBySourceId.get(e);if(null!=t)return t;const r=this.dataElement.domainNetworks,o=this._traverseNetworkSources(r,this._layerIdBySourceId,"sourceId","layerId",e);return o>=0?o:null}getSourceIdByLayerId(e){if(!this.dataElement)return null;const t=this._sourceIdByLayerId.get(e);if(null!=t)return t;const r=this.dataElement.domainNetworks,o=this._traverseNetworkSources(r,this._sourceIdByLayerId,"layerId","sourceId",e);return o>=0?o:null}getObjectIdsFromElements(e){const t=[],r=new Map;for(const i of e){const e=this.getLayerIdBySourceId(i.networkSourceId);if(null==e)continue;let t=r.get(e);void 0===t&&(t=[]),t.push(i.objectId),r.set(e,t)}const o=this.featureServiceUrl;return r.forEach(((e,r)=>t.push({layerUrl:`${o}/${r}`,objectIds:e}))),t}async queryNamedTraceConfigurations(e,t){const[{queryNamedTraceConfigurations:o},{default:i}]=await Promise.all([r.e(8341).then(r.bind(r,8341)),r.e(7194).then(r.bind(r,77194))]),s=this.networkServiceUrl,n=i.from(e);return(await o(s,n,{...t}))?.namedTraceConfigurations}async validateTopology(e,t){if(!e.validateArea)throw new p.A("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const[{validateNetworkTopology:o},{default:i}]=await Promise.all([r.e(7814).then(r.bind(r,77814)),r.e(8266).then(r.bind(r,28266))]),s=i.from(e);(0,N.w5)(this.featureServiceUrl,this.gdbVersion||null)?(s.sessionID=N.TA,await(0,N.ZJ)(this.featureServiceUrl,this.gdbVersion,!0)):s.sessionID=null,s.gdbVersion=this.gdbVersion;const n=this.networkServiceUrl,a=this.featureServiceUrl,l=(0,v.Zk)(a,null,this.gdbVersion,!0),u=await o(n,s,{...t});if(u?.serviceEdits){const e=[];for(const t of u.serviceEdits){const{editedFeatures:r}=t,o=r?.spatialReference?new w.A(r.spatialReference):null;e.push({layerId:t.layerId,editedFeatures:{adds:r?.adds?.map((e=>C(e,o)))||[],updates:r?.updates?.map((e=>({original:C(e[0],o),current:C(e[1],o)})))||[],deletes:r?.deletes?.map((e=>C(e,o)))||[],spatialReference:o}})}l.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:e,exceededTransferLimit:!1,historicMoment:u.moment})}return u}async submitTopologyValidationJob(e,t){let o=null;if(!e.validateArea)throw new p.A("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){const e=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");o=(await(0,d.A)(e,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}const[{submitValidateNetworkTopologyJob:i},{default:s}]=await Promise.all([r.e(7814).then(r.bind(r,77814)),r.e(8266).then(r.bind(r,28266))]),n=s.from(e);(0,N.w5)(this.featureServiceUrl,this.gdbVersion||null)?(n.sessionID=N.TA,await(0,N.ZJ)(this.featureServiceUrl,this.gdbVersion,!0)):n.sessionID=null,n.gdbVersion=this.gdbVersion||o;const a=this.networkServiceUrl,l=this.featureServiceUrl?(0,v.Zk)(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,u=await i(a,n,{...t});return new M({statusUrl:u,editsResolver:l})}getSourceTypeById(e){if(!this.dataElement)return null;for(const t of this.dataElement.domainNetworks)for(const r of[t.edgeSources??[],t.junctionSources??[]])for(const o of r)if(o.sourceId===e)return r===t.edgeSources?"edge":"junction";return null}_traverseNetworkSources(e,t,r,o,i){for(const s of e)for(const e of[s.edgeSources??[],s.junctionSources??[]])for(const s of e)if(s[r]===i)return t.set(i,s[o]),s[o];return-1}async _fetchLayerMetaData(e,t){const r=await(0,d.A)(e,{responseType:"json",query:{f:"json"},...t});this.sourceJSON=r.data,this.read(r.data,{origin:"service"})}async _fetchDataElement(e,t,r){if(this.dataElement)return;const o=await(0,d.A)(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...r}).then((e=>e.data.layerDataElements?.[0]));o&&this.read(o,{origin:"service"})}};function C(e,t){return new i.A({attributes:e.attributes,geometry:(0,f.rS)({...e.geometry,spatialReference:t})})}(0,o._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],Z.prototype,"id",void 0),(0,o._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],Z.prototype,"title",void 0),(0,o._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],Z.prototype,"layerUrl",void 0),(0,o._)([(0,s.MZ)({type:Object,json:{origins:{service:{read:!0}},read:!1}})],Z.prototype,"dataElement",void 0),(0,o._)([(0,s.MZ)({type:g.A,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],Z.prototype,"fullExtent",void 0),(0,o._)([(0,s.MZ)({type:w.A,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],Z.prototype,"spatialReference",void 0),(0,o._)([(0,s.MZ)({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],Z.prototype,"type",void 0),(0,o._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"datasetName",null),(0,o._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"owner",null),(0,o._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"schemaGeneration",null),(0,o._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"parsedUrl",null),(0,o._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"featureServiceUrl",null),(0,o._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"networkServiceUrl",null),(0,o._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"layerId",null),(0,o._)([(0,s.MZ)()],Z.prototype,"sourceJSON",void 0),(0,o._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"networkSystemLayers",null),(0,o._)([(0,s.MZ)()],Z.prototype,"gdbVersion",void 0),(0,o._)([(0,s.MZ)({type:Date})],Z.prototype,"historicMoment",void 0),Z=(0,o._)([(0,a.$)("esri.networks.Network")],Z);const R=Z;var k=r(42553),E=r(31933),x=r(12899);let L=class extends(k.A.JSONSupportMixin(c.A)){constructor(e){super(e),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=d.A}initialize(){}async load(e){const t=this.rulesLayer.load(e).then((()=>this._initializeRulesTable()));return this.addResolvingPromise(t),this}getFeaturesCanAssociateWithClause(e,t,r){return this._getWhereClauseForCompatibleFeatures(e,t,r)}getFeaturesCanAssociateWith(e,t,r){return null==this._getFeatureSourceLayerId(e)?[]:t.filter((t=>this.canAssociateFeatures(e,t,r)))}canAssociateFeatures(e,t,r){const[o,i]=this._getFeatureAssetCodes(e),s=this._getFeatureSourceLayerId(e),[n,a]=this._getFeatureAssetCodes(t),l=this._getFeatureSourceLayerId(t);return null!=s&&null!=l&&r.some((e=>{const{type:t,direction:r}=e;return this._getRulesForAssociationType(t).some((e=>{const u=this._getRuleFieldValuesForAssociation(e,t,r);return u?.some((e=>s===e?.ruleLayerIdForSource&&o===e?.ruleAssetGroupCodeForSource&&i===e?.ruleAssetTypeCodeForSource&&l===e?.ruleLayerIdForTarget&&n===e?.ruleAssetGroupCodeForTarget&&a===e?.ruleAssetTypeCodeForTarget))}))}))}getLayersCanAssociateWith(e,t,r){return null==this._getFeatureSourceLayerId(e)?[]:t.filter((t=>this.canAssociateFeatureToLayer(e,t,r)))}canAssociateFeatureToLayer(e,t,r){const o=(0,E.Sv)(t)?t.parent:t;if(!o)return!1;const i=o.layerId,s=(0,E.Sv)(t)?t.subtypeCode:null,[n,a]=this._getFeatureAssetCodes(e),l=this._getFeatureSourceLayerId(e);return null!=l&&r.some((e=>{const{type:t,direction:r}=e;return this._getRulesForAssociationType(t).some((e=>{const o=this._getRuleFieldValuesForAssociation(e,t,r);return o?.some((e=>l===e?.ruleLayerIdForSource&&n===e?.ruleAssetGroupCodeForSource&&a===e?.ruleAssetTypeCodeForSource&&i===e?.ruleLayerIdForTarget&&(null==s||s===e?.ruleAssetGroupCodeForTarget)))}))}))}getFeatureSQL(e,t){const r=e.layerId.toString(),o=e.fieldsIndex?.normalizeFieldName("assetGroup"),i=e.fieldsIndex?.normalizeFieldName("assetType"),s=o?t.attributes[o]:null,n=i?t.attributes[i]:null,a=this.rulesHash[r];if(a){const e=a.assetGroupHash[s];if(e)return e.assetTypeHash[n]||null}return null}async _initializeRulesTable(){const e={};let t;!function(e){e[e.from=0]="from",e[e.to=1]="to",e[e.via=2]="via"}(t||(t={}));const r=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(const o of this.rules){if(o.ruleType===x.D2.RTAttachment){this.rulesCategorized.attachment.push(o);continue}if(o.ruleType===x.D2.RTContainment){this.rulesCategorized.containment.push(o);continue}if(o.ruleType===x.D2.RTJunctionJunctionConnectivity){this.rulesCategorized.connectivity.push(o);continue}this.rulesCategorized.connectivity.push(o);let i=[[t.from,t.to],[t.to,t.from]];o.ruleType===x.D2.RTEdgeJunctionEdgeConnectivity&&(i=[[t.from,t.via],[t.via,t.from],[t.to,t.via],[t.via,t.to]]);for(const s of i){const i=s.shift(),n=s.shift();let a=!1;switch(o.ruleType){case x.D2.RTEdgeJunctionEdgeConnectivity:a=i===t.from||i===t.to;break;case x.D2.RTJunctionEdgeConnectivity:a=i===t.to}const l=r[i],u=o[l.networkSourceId]?.layerId.toString()??"",d=o[l.assetGroupId]?.assetGroupCode?.toString(),p=o[l.assetTypeId],c=p?.assetTypeCode?.toString(),y=r[n],h=o[y.networkSourceId]?.layerId.toString()??"",m=o[y.assetGroupId]?.assetGroupCode?.toString(),g=o[y.assetTypeId],w=g?.assetTypeCode?.toString(),f=e[u]??{assetGroupHash:{}};if(!(d&&c&&m&&w))continue;const v=f.assetGroupHash[d]??{assetTypeHash:{}},b=v.assetTypeHash[c]??{};if(b[h]=b[h]??{},a){b[u]=b[u]??{};const e=`(assetgroup = ${d} AND assettype = ${c})`;"esriNECPEndVertex"===g?.connectivityPolicy?b[u].endVertex=b[u]?.endVertex?`${b[u].endVertex}`:`${e}`:b[u].anyVertex=b[u].anyVertex?`${b[u].anyVertex}`:`${e}`}const _=`(assetgroup = ${m} AND assettype = ${w})`;"esriNECPEndVertex"===g?.connectivityPolicy?b[h].endVertex=b[h]?.endVertex?`${b[h].endVertex} OR ${_}`:`${_}`:b[h].anyVertex=b[h]?.anyVertex?`${b[h].anyVertex} OR ${_}`:`${_}`,v.assetTypeHash[c]=b,f.assetGroupHash[d]=v,e[u]=f}}this._set("rulesHash",e)}_getRuleFieldValuesForAssociation(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"from";switch(t){case"attachment":case"containment":return"from"===r?[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode}]:[{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode}];case"connectivity":case"junction-junction-connectivity":return[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode},{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode}];case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return e.ruleType===x.D2.RTEdgeJunctionEdgeConnectivity?[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.viaAssetType?.assetTypeCode},{ruleLayerIdForSource:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.viaAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode},{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.viaAssetType?.assetTypeCode},{ruleLayerIdForSource:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.viaAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode}]:[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode},{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode}];default:return[]}}_getWhereClauseForCompatibleFeatures(e,t,r){const o=new Map,[i,s]=this._getAssetFieldNames(e.sourceLayer),[n,a]=this._getFeatureAssetCodes(e),l=this._getFeatureSourceLayerId(e),u=(0,E.Sv)(t)?t.parent:t,d=(0,E.Sv)(t)?t.subtypeCode:null;r.forEach((e=>{const{type:t,direction:r}=e;this._getRulesForAssociationType(t).forEach((e=>{this._getRuleFieldValuesForAssociation(e,t,r).forEach((e=>{if(null!=e.ruleAssetGroupCodeForTarget&&null!=e.ruleAssetTypeCodeForTarget&&l===e?.ruleLayerIdForSource&&n===e?.ruleAssetGroupCodeForSource&&a===e?.ruleAssetTypeCodeForSource&&u.layerId===e?.ruleLayerIdForTarget&&(null==d||d===e?.ruleAssetGroupCodeForTarget)){const t=o.get(e.ruleAssetGroupCodeForTarget)??new Set;t.add(e.ruleAssetTypeCodeForTarget),o.set(e.ruleAssetGroupCodeForTarget,t)}}))}))}));let p=[];return this._mergeAssetCodes(o).forEach(((e,t)=>p.push(`${i} IN (${t}) AND ${s} IN (${Array.from(e).sort().join(", ")})`))),p.length>1&&(p=p.map((e=>`(${e})`))),p.join(" OR ")}_getRulesForAssociationType(e){const{rulesCategorized:t}=this;switch(e){case"attachment":return t.attachment;case"containment":return t.containment;case"connectivity":case"junction-junction-connectivity":return t.connectivity.filter((e=>e.ruleType===x.D2.RTJunctionJunctionConnectivity));case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return t.connectivity.filter((e=>e.ruleType===x.D2.RTJunctionEdgeConnectivity||e.ruleType===x.D2.RTEdgeJunctionEdgeConnectivity));default:return[]}}_getFeatureSourceLayerId(e){const{sourceLayer:t}=e;let r;return(0,E.yZ)(t)?r=t.layerId:(0,E.Sv)(t)&&(r=t.parent?.layerId),r??null}_getAssetFieldNames(e){return e&&"fieldsIndex"in e?[e.fieldsIndex.normalizeFieldName("assetGroup")??null,e.fieldsIndex.normalizeFieldName("assetType")??null]:[null,null]}_getFeatureAssetCodes(e){const[t,r]=this._getAssetFieldNames(e.sourceLayer);return[t?e.attributes[t]:null,r?e.attributes[r]:null]}_areSetsEqual(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}_mergeAssetCodes(e){const t=new Map,r=new Set;for(const[o,i]of e){const s=new Set([o]);for(const[t,a]of e)o!==t&&!r.has(t)&&this._areSetsEqual(i,a)&&(s.add(t),r.add(t));const n=Array.from(s).sort().join(", ");t.set(n,i)}return t}};(0,o._)([(0,s.MZ)({constructOnly:!0})],L.prototype,"rulesLayer",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],L.prototype,"rules",void 0),(0,o._)([(0,s.MZ)({readOnly:!0})],L.prototype,"rulesHash",void 0),(0,o._)([(0,s.MZ)()],L.prototype,"rulesCategorized",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],L.prototype,"request",void 0),L=(0,o._)([(0,a.$)("esri.networks.RulesTable")],L);const O=L;var U=r(99666),G=r(28009),V=r(91967);let P=class extends V.A{constructor(e){super(e),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTable=null,this.associationsTableId=null,this.associationsTableUrl=null}destroy(){this.associationsTable?.destroy()}async loadAssociationsTable(){if(!this.associationsTable){const{associationsTableUrl:e}=this;if(!e)throw new p.A("utility-network-system-layers:missing-associations-table-url","Unable to load the associations table, as the `associationsTableUrl` is not set.");this.associationsTable=new l.default({url:e})}return await this.associationsTable.load(),this.associationsTable}};(0,o._)([(0,s.MZ)({constructOnly:!0})],P.prototype,"rulesTableId",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],P.prototype,"rulesTableUrl",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],P.prototype,"subnetworksTableId",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],P.prototype,"subnetworksTableUrl",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],P.prototype,"dirtyAreasLayerId",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],P.prototype,"dirtyAreasLayerUrl",void 0),(0,o._)([(0,s.MZ)()],P.prototype,"associationsTable",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],P.prototype,"associationsTableId",void 0),(0,o._)([(0,s.MZ)({constructOnly:!0})],P.prototype,"associationsTableUrl",void 0),P=(0,o._)([(0,a.$)("esri.networks.support.NetworkSystemLayers")],P);const $=P;let J=class extends k.A{constructor(e){super(e),this.id=null,this.name=null}};(0,o._)([(0,s.MZ)({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],J.prototype,"id",void 0),(0,o._)([(0,s.MZ)({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],J.prototype,"name",void 0),(0,o._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],J.prototype,"isUpstreamTerminal",void 0),J=(0,o._)([(0,a.$)("esri.networks.support.Terminal")],J);const B=J,D=new _.J({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let q=class extends k.A{constructor(e){super(e),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};(0,o._)([(0,s.MZ)({type:String,json:{write:!0}})],q.prototype,"defaultConfiguration",void 0),(0,o._)([(0,s.MZ)({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],q.prototype,"id",void 0),(0,o._)([(0,s.MZ)({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],q.prototype,"name",void 0),(0,o._)([(0,s.MZ)({type:[B],json:{write:!0}})],q.prototype,"terminals",void 0),(0,o._)([(0,s.MZ)({type:D.apiValues,json:{type:D.jsonValues,read:D.read,write:D.write}})],q.prototype,"traversabilityModel",void 0),q=(0,o._)([(0,a.$)("esri.networks.support.TerminalConfiguration")],q);const z=q;var W=r(57778);const K=(0,_.O)()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let H=class extends W.A{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const t={...e,query:{f:"json"}},{data:r}=await(0,d.A)(this.statusUrl,t),o=r.traceResults?{...r.traceResults,...r}:r;return this.read(o),this}async waitForJobCompletion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{interval:t=1e3,statusCallback:r}=e;return new Promise(((e,o)=>{this._clearTimer();const i=setInterval((()=>{this._timer||o((0,h.NK)()),this.checkJobStatus().then((t=>{const{status:o}=t;switch(this.status=o,o){case"job-succeeded":this._clearTimer(),e(this);break;case"job-waiting":case"job-executing":r&&r(this)}}),(e=>{this._clearTimer(),o(e)}))}),t);this._timer=i}))}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};(0,o._)([(0,s.MZ)({type:String,json:{write:!0}})],H.prototype,"statusUrl",void 0),(0,o._)([(0,S.e)(K)],H.prototype,"status",void 0),(0,o._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],H.prototype,"submissionTime",void 0),(0,o._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],H.prototype,"lastUpdatedTime",void 0),H=(0,o._)([(0,a.$)("esri.networks.support.TraceJobInfo")],H);const X=H;var Y=r(97015);let Q=class extends R{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility",this._terminalById=new Map}get serviceTerritoryFeatureLayerId(){return this.dataElement?.serviceTerritoryFeatureLayerId??null}get networkSystemLayers(){return new $({rulesTableId:this.sourceJSON?.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.rulesTableId}`:null,subnetworksTableId:this.sourceJSON?.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:this.sourceJSON?.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:this.sourceJSON?.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){return this.dataElement?.terminalConfigurations.map((e=>z.fromJSON(e)))||[]}get domainNetworkNames(){return this.dataElement?.domainNetworks.map((e=>e.domainNetworkName))||[]}get _utilityLayerList(){const e=new Set;return this.dataElement?.domainNetworks?.map((t=>{t?.edgeSources?.map((t=>{let{layerId:r,sourceId:o}=t;this._layerIdBySourceId.set(o,r),this._sourceIdByLayerId.set(r,o),e.add(r)})),t?.junctionSources?.map((t=>{let{layerId:r,sourceId:o}=t;this._layerIdBySourceId.set(o,r),this._sourceIdByLayerId.set(r,o),e.add(r)}))})),e}async load(e){return this.addResolvingPromise(super.load(e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this}getTerminalConfiguration(e){let t=null,r=null;const o=e.layer;let i=null;if("feature"===o?.type){if(i=o.layerId,null===i)return null}else{if("subtype-sublayer"!==o?.type)return null;if(i=o?.parent?.layerId??null,null===i)return null}const s=e.attributes;if(null==s)return null;for(const l of Object.keys(s))"ASSETGROUP"===l.toUpperCase()&&(t=e.getAttribute(l)),"ASSETTYPE"===l.toUpperCase()&&(r=e.getAttribute(l));if(!this.dataElement)return null;let n=null;const a=this.dataElement.domainNetworks;for(const l of a){const e=l.junctionSources?.find((e=>e.layerId===i));if(e){const o=e.assetGroups?.find((e=>e.assetGroupCode===t));if(o){const e=o.assetTypes?.find((e=>e.assetTypeCode===r));if(e?.isTerminalConfigurationSupported){n=e.terminalConfigurationId;break}}}}if(null!=n){const e=this.dataElement.terminalConfigurations,t=e?.find((e=>e.terminalConfigurationId===n));return t?z.fromJSON(t):null}return null}getTierNames(e){const t=this.dataElement?.domainNetworks.find((t=>t.domainNetworkName===e));return t?.tiers.map((e=>e.name))||[]}async getRulesTable(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),await this._sharedRulesTable}getTerminalById(e){if(!this.dataElement||null==e)return null;const t=this._terminalById.get(e);return null!=t?t:(this.terminalConfigurations.forEach((e=>{e.terminals.forEach((e=>{this._terminalById.set(e.id,e)}))})),this._terminalById.get(e))}isUtilityLayer(e){return"layerId"in e?this._utilityLayerList.has(e?.layerId)&&(e.url?.startsWith(this.featureServiceUrl)??!1):!("subtype-sublayer"!==e.type||!e.parent)&&this._utilityLayerList.has(e.parent.layerId)&&(e.parent.url?.startsWith(this.featureServiceUrl)??!1)}async queryAssociations(e,t){const[{queryAssociations:o},{default:i}]=await Promise.all([r.e(4176).then(r.bind(r,34176)),r.e(2623).then(r.bind(r,2623))]),s=i.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,(await o(this.networkServiceUrl,s,t)).associations}async synthesizeAssociationGeometries(e){const[{synthesizeAssociationGeometries:t},{default:o}]=await Promise.all([r.e(440).then(r.bind(r,70440)),r.e(5624).then(r.bind(r,75624))]),i=o.from(e);return i.gdbVersion=this.gdbVersion,i.moment=this.historicMoment,t(this.networkServiceUrl,i)}async trace(e){const[{trace:t},{default:o}]=await Promise.all([r.e(998).then(r.bind(r,40998)),r.e(4515).then(r.bind(r,54515))]),i=o.from(e);return i.gdbVersion=this.gdbVersion,i.moment=this.historicMoment,t(this.networkServiceUrl,i)}async submitTraceJob(e){const[{submitTraceJob:t},{default:o}]=await Promise.all([r.e(998).then(r.bind(r,40998)),r.e(4515).then(r.bind(r,54515))]),i=o.from(e);i.gdbVersion=this.gdbVersion,i.moment=this.historicMoment;const s=await t(this.networkServiceUrl,i);return new X({statusUrl:s})}async canAddAssociation(e){const t=await this.getRulesTable();if(!t)return!1;await t.load();const r=e=>({fromRuleElement:{networkSource:e.fromNetworkSource,assetGroup:e.fromAssetGroup,assetType:e.fromAssetType,terminal:e.fromTerminal},viaRuleElement:e.viaNetworkSource?{networkSource:e.viaNetworkSource,assetGroup:e.viaAssetGroup,assetType:e.viaAssetType,terminal:e.viaTerminal}:void 0,toRuleElement:{networkSource:e.toNetworkSource,assetGroup:e.toAssetGroup,assetType:e.toAssetType,terminal:e.toTerminal}}),o=function(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.networkSource?.sourceId===t.networkSourceId&&e.assetGroup?.assetGroupCode===t.assetGroupCode&&e.assetType?.assetTypeCode===t.assetTypeCode&&(!r||((e,t)=>e?1===e.terminalId?!t?.terminalId||t?.terminalId===e.terminalId:e.terminalId===t?.terminalId:!t?.terminalId)(e.terminal,t))},i=(e,t)=>{const{fromRuleElement:i,toRuleElement:s}=r(e);return o(i,t.fromNetworkElement,!1)&&o(s,t.toNetworkElement,!1)};return"containment"===e.associationType?t.rulesCategorized.containment.some((t=>i(t,e))):"attachment"===e.associationType?t.rulesCategorized.attachment.some((t=>i(t,e))):t.rulesCategorized.connectivity.some((t=>t.ruleType===x.D2.RTEdgeJunctionEdgeConnectivity?((e,t)=>{const{fromRuleElement:i,toRuleElement:s,viaRuleElement:n}=r(e);return o(i,t.fromNetworkElement)&&o(n,t.toNetworkElement)||o(i,t.toNetworkElement)&&o(n,t.fromNetworkElement)||o(n,t.fromNetworkElement)&&o(s,t.toNetworkElement)||o(n,t.toNetworkElement)&&o(s,t.fromNetworkElement)})(t,e):((e,t)=>{const{fromRuleElement:i,toRuleElement:s}=r(e);return o(i,t.fromNetworkElement)&&o(s,t.toNetworkElement)||o(i,t.toNetworkElement)&&o(s,t.fromNetworkElement)})(t,e)))}generateAddAssociations(e){const{associationsTable:t}=this.networkSystemLayers,{fromNetworkSourceId:r,fromGlobalId:o,fromTerminalId:s,toNetworkSourceId:n,toGlobalId:a,toTerminalId:l,associationType:u,isContentVisible:d,percentAlong:p,globalId:c}=(0,G.E)(t);return{addFeatures:e.map((e=>new i.A({attributes:{[r]:e.fromNetworkElement?.networkSourceId,[o]:e.fromNetworkElement?.globalId,[s]:e.fromNetworkElement?.terminalId,[n]:e.toNetworkElement?.networkSourceId,[a]:e.toNetworkElement?.globalId,[l]:e.toNetworkElement?.terminalId,[u]:x.v9[e.associationType],[d]:null==e.isContentVisible?void 0:e.isContentVisible?1:0,[p]:e.percentAlong,[c]:e.globalId}}))),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:t?.globalIdField??"globalid",objectIdField:t?.objectIdField??"objectid"}}}generateDeleteAssociations(e){const{associationsTable:t,associationsTableId:r}=this.networkSystemLayers;return{deleteFeatures:e.map((e=>({globalId:e.globalId}))),id:r,identifierFields:{globalIdField:t?.globalIdField??"globalid",objectIdField:t?.objectIdField??"objectid"}}}async loadAssociationsTable(){return this.networkSystemLayers.loadAssociationsTable()}async _loadNamedTraceConfigurationsFromNetwork(e){if(0===this.sharedNamedTraceConfigurations?.length)return;const t=this.sharedNamedTraceConfigurations.map((e=>e.globalId)),r=await this.queryNamedTraceConfigurations({globalIds:t},e);for(const o of this.sharedNamedTraceConfigurations){const e=r?.find((e=>e.globalId===o.globalId));if(e){const t=e.write({},{origin:"service"});o.read(t,{origin:"service"})}}}async _createRulesTable(){const e=this.networkSystemLayers.rulesTableUrl,t=new l.default({url:e});await t.load();const r=this.dataElement?.domainNetworks;if(!r)return null;const o=r.flatMap((e=>[...e.edgeSources||[],...e.junctionSources||[]])),i=(await async function(e){const t=new Y.A({where:"1=1",outFields:["*"]});return(await(0,u.SE)(e,t)).features}(t)).map((e=>this._hydrateRuleInfo(t,o,e)));return new O({rulesLayer:t,rules:i})}_hydrateRuleInfo(e,t,r){const o=e.fieldsIndex,i=o.get("RULETYPE"),s=o.get("CREATIONDATE"),n=o.get("FROMNETWORKSOURCEID"),a=o.get("FROMASSETGROUP"),l=o.get("FROMASSETTYPE"),u=o.get("FROMTERMINALID"),d=o.get("TONETWORKSOURCEID"),p=o.get("TOASSETGROUP"),c=o.get("TOASSETTYPE"),y=o.get("TOTERMINALID"),h=o.get("VIANETWORKSOURCEID"),m=o.get("VIAASSETGROUP"),g=o.get("VIAASSETTYPE"),w=o.get("VIATERMINALID"),f=r.attributes[i.name],v=new Date(r.attributes[s.name]),b=[{networkSourceId:r.attributes[n.name],assetGroupId:r.attributes[a.name],assetTypeId:r.attributes[l.name],terminalId:r.attributes[u.name]},{networkSourceId:r.attributes[d.name],assetGroupId:r.attributes[p.name],assetTypeId:r.attributes[c.name],terminalId:r.attributes[y.name]},{networkSourceId:r.attributes[h.name],assetGroupId:r.attributes[m.name],assetTypeId:r.attributes[g.name],terminalId:r.attributes[w.name]}];let _;!function(e){e[e.from=0]="from",e[e.to=1]="to",e[e.via=2]="via"}(_||(_={}));const S={ruleType:f,creationDate:v};for(const A of[_.from,_.to,_.via]){if(f!==x.D2.RTEdgeJunctionEdgeConnectivity&&A===_.via)continue;const e=b[A],r=t.find((t=>t.sourceId===e.networkSourceId)),o=r?.assetGroups.find((t=>t.assetGroupCode===e.assetGroupId)),i=o?.assetTypes.find((t=>t.assetTypeCode===e.assetTypeId)),s=this._getTerminal(i,e);let n="";switch(A){case _.from:n="from";break;case _.to:n="to";break;case _.via:n="via"}S[`${n}NetworkSource`]=r,S[`${n}AssetGroup`]=o,S[`${n}AssetType`]=i,S[`${n}Terminal`]=s?.toJSON()}return S}_getTerminal(e,t){const r=e?.terminalConfigurationId,o=this.terminalConfigurations?.find((e=>e.id===r));return o?.terminals?.find((e=>e.id===t.terminalId))??null}};(0,o._)([(0,s.MZ)({type:[U.A],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],Q.prototype,"sharedNamedTraceConfigurations",void 0),(0,o._)([(0,s.MZ)({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],Q.prototype,"type",void 0),(0,o._)([(0,s.MZ)({readOnly:!0})],Q.prototype,"serviceTerritoryFeatureLayerId",null),(0,o._)([(0,s.MZ)({readOnly:!0})],Q.prototype,"networkSystemLayers",null),(0,o._)([(0,s.MZ)({readOnly:!0})],Q.prototype,"terminalConfigurations",null),(0,o._)([(0,s.MZ)({readOnly:!0})],Q.prototype,"domainNetworkNames",null),Q=(0,o._)([(0,a.$)("esri.networks.UtilityNetwork")],Q);const ee=Q},99666:(e,t,r)=>{r.d(t,{A:()=>c});var o=r(35143),i=r(77717),s=r(46053),n=(r(81806),r(76460),r(47249),r(28379)),a=r(85842),l=r(79685),u=r(12899),d=r(64154);let p=class extends i.L{constructor(e){super(e),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(e,t){return void 0!==e.tierName?d.A.fromJSON(e):l.A.fromJSON(e)}};(0,o._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],p.prototype,"globalId",void 0),(0,o._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],p.prototype,"title",void 0),(0,o._)([(0,s.MZ)({type:l.A,json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"traceConfiguration",void 0),(0,o._)([(0,n.w)("service","traceConfiguration")],p.prototype,"readTraceConfiguration",null),(0,o._)([(0,s.MZ)({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"creationDate",void 0),(0,o._)([(0,s.MZ)({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"creator",void 0),(0,o._)([(0,s.MZ)({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"description",void 0),(0,o._)([(0,s.MZ)({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],p.prototype,"minStartingPoints",void 0),(0,o._)([(0,s.MZ)({json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"resultTypes",void 0),(0,o._)([(0,s.MZ)({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"tags",void 0),(0,o._)([(0,s.MZ)({type:u.fO.apiValues,json:{type:u.fO.jsonValues,origins:{service:{read:u.fO.read,write:u.fO.write}},read:!1}})],p.prototype,"traceType",void 0),p=(0,o._)([(0,a.$)("esri.networks.support.NamedTraceConfiguration")],p);const c=p}}]);
//# sourceMappingURL=1088.72d2b891.chunk.js.map