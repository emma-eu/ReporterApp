"use strict";(self.webpackChunkfeedback_map=self.webpackChunkfeedback_map||[]).push([[8465,73836],{1900:(e,t,r)=>{r.d(t,{A:()=>y});var i=r(50076),o=r(42553),s=r(76460),n=r(87663),a=r(64920),l=r(53430),u=r(36693),d=r(67478),p=r(24241);const c=new Map;class y{static fromJSON(e){return new y(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new y(e.fields??[],f(e))}static fromLayerJSON(e){return new y(e.fields??[],f(e))}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const i of this.fields){const e=i?.name,t=m(e);if(e&&t){const o=h(e);this._fieldsMap.set(e,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(t,i),r.push(`${o}:${i.type}:${this._timeZoneByFieldName?.get(e)}`),(0,l.vE)(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):(0,l.WA)(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),(0,l.te)(i)||(0,l.Xz)(i)||(i.editable=null==i.editable||!!i.editable,i.nullable=null==i.nullable||!!i.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)(0,l.te)(e)||(0,l.Xz)(e)||e.nullable||void 0!==(0,l.lD)(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(h(e))??this._normalizedFieldsMap.get(m(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(e){const t=this.get(e&&"string"!=typeof e?e.name:e);return t?this._timeZoneByFieldName?this._timeZoneByFieldName.get(t.name):"date"===t.type||"esriFieldTypeDate"===t.type?(s.A.getLogger("esri.layers.support.FieldsIndex").errorOnce(new i.A("getTimeZone:no-timezone-information",`no time zone information for field '${t.name}'`)),u.n$):g.has(t.type)?u.L5:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===u.L5?a.GB.instance:t===u.n$?p.mQ.utcInstance:(0,n.tE)(c,t,(()=>p.oh.create(t))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return(0,l.OH)(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>o.A.isSerializable(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function h(e){return e.trim().toLowerCase()}function m(e){return(0,l.rS)(e)?.toLowerCase()??""}const g=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function f(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:i,editFieldsInfo:o}=e,s=(i?"startField"in i?i.startField:i.startTimeField:"")??"",n=(i?"endField"in i?i.endField:i.endTimeField:"")??"",a=function(e){return"dateFieldsTimeZone"in e}(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?(0,d.ZS)(e.dateFieldsTimeReference):null,l=o?function(e){return"timeZone"in e}(o)?o.timeZone??a:o.dateFieldsTimeReference?(0,d.ZS)(o.dateFieldsTimeReference):a??u.n$:null,p=i?function(e){return"timeZone"in e}(i)?i.timeZone??a:i.timeReference?(0,d.ZS)(i.timeReference):a:null,c=new Map([[h(o?.creationDateField??""),l],[h(o?.editDateField??""),l],[h(s),p],[h(n),p]]);for(const{name:d,type:y}of e.fields)if(g.has(y))t.set(d,u.L5);else if("date"!==y&&"esriFieldTypeDate"!==y)t.set(d,null);else if(r)t.set(d,u.L5);else{const e=c.get(h(d??""))??a;t.set(d,e)}return t}},4414:(e,t,r)=>{r.d(t,{O3:()=>p,PU:()=>u,YW:()=>y,ex:()=>a,hv:()=>c,zp:()=>l});var i=r(15941),o=r(76931),s=r(43047),n=r(55855);const a=2.4;function l(e){return(0,o.PN)(e*a)}function u(e){return(0,o.Lz)(e)/a}function d(e,t,r,o){let{color:n,ratio:a}=t,{color:l,ratio:u}=r;if(u===a){const e=1e-6;1===u?a-=e:u+=e}const d=(0,i.qE)((o-a)/(u-a),0,1);(0,s.l)(e,n.toArray(),l.toArray(),d)}function p(e){const t=new Uint8ClampedArray(2048);if(e=e.filter((e=>{let{ratio:t}=e;return t>=0&&t<=1})).sort(((e,t)=>e.ratio-t.ratio)).map((e=>{let{color:t,ratio:r}=e;return{color:t,ratio:Math.max(r,.001)}})),e.length<1)return t;let r=e[0],i=e[0],o=1;const s=(0,n.vt)();for(let n=0;n<512;n++){const a=(n+.5)/512;for(;a>i.ratio&&o<e.length;)r=i,i=e[o++];d(s,r,i,a),t.set(s,4*n)}return t}function c(e,t,r){const i=Math.sqrt(e**2+t**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function y(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1}},6127:(e,t,r)=>{r.d(t,{m:()=>i});const i=new(r(45802).J)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"})},11187:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(35143),o=r(42553),s=r(46053),n=(r(81806),r(76460),r(47249),r(85842));let a=class extends o.A{constructor(e){super(e),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.exceededTransferLimit=null,this.serviceEdits=null,this.discoveredSubnetworks=null}};(0,i._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.moment=e?e.getTime():null}}}})],a.prototype,"moment",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"fullUpdate",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"validateErrorsCreated",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"exceededTransferLimit",void 0),(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"serviceEdits",void 0),(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"discoveredSubnetworks",void 0),a=(0,i._)([(0,n.$)("esri.rest.networks.support.ValidateNetworkTopologyResult")],a);const l=a},11265:(e,t,r)=>{r(65256),r(50265),r(39348),r(38042);var i=r(63860),o=r(3825),s=r(50076);async function n(e){if(null!=l.fetchBundleAsset)return l.fetchBundleAsset(e);const t=await(0,o.A)(e,{responseType:"text"});return JSON.parse(t.data)}class a{constructor(e){let t,{base:r="",pattern:i,location:o=new URL(window.location.href)}=e;t="string"==typeof o?e=>new URL(e,new URL(o,window.location.href)).href:o instanceof URL?e=>new URL(e,o).href:o,this.pattern="string"==typeof i?new RegExp(`^${i}`):i,this.getAssetUrl=t,r=r?r.endsWith("/")?r:r+"/":"",this.matcher=new RegExp(`^${r}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,t){return async function(e,t,r,o){const a=t.exec(r);if(!a)throw new s.A("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${t}"`);const l=a[1]?`${a[1]}/`:"",u=a[2],d=(0,i.xO)(o),p=`${l}${u}.json`,c=d?`${l}${u}_${d}.json`:p;let y;try{y=await n(e(c))}catch(h){if(c===p)throw new s.A("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:h});try{y=await n(e(p))}catch(h){throw new s.A("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:h})}}return y}(this.getAssetUrl,this.matcher,e,t)}}const l={};var u,d=r(28899);(0,i.ao)((u={pattern:"esri/",location:d.s},new a(u)))},11957:(e,t,r)=>{r.r(t),r.d(t,{default:()=>zt});var i=r(35143),o=r(55171),s=r(32809),n=r(16036),a=r(18690),l=r(94643),u=r(50076),d=r(49304),p=r(27741),c=r(76460),y=r(30726),h=r(77717),m=r(91291),g=r(50346),f=r(68134),w=r(90534),v=r(46053),_=(r(81806),r(28379)),b=r(85842),S=r(17707),A=r(6527),T=r(13312),I=r(70652),M=r(72945),F=r(42553);r(47249);let N=class extends F.A{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],N.prototype,"facilityIdField",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],N.prototype,"layerId",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],N.prototype,"nameField",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:!0}})],N.prototype,"siteIdField",void 0),(0,i._)([(0,v.MZ)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],N.prototype,"sublayerId",void 0),N=(0,i._)([(0,b.$)("esri.layers.support.FacilityLayerInfo")],N);const j=N;let Z=class extends F.A{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"facilityIdField",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"layerId",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"levelIdField",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"levelNumberField",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"longNameField",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"shortNameField",void 0),(0,i._)([(0,v.MZ)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Z.prototype,"sublayerId",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Z.prototype,"verticalOrderField",void 0),Z=(0,i._)([(0,b.$)("esri.layers.support.LevelLayerInfo")],Z);const C=Z;let x=class extends F.A{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],x.prototype,"layerId",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],x.prototype,"nameField",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],x.prototype,"siteIdField",void 0),(0,i._)([(0,v.MZ)({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],x.prototype,"sublayerId",void 0),x=(0,i._)([(0,b.$)("esri.layers.support.SiteLayerInfo")],x);const R=x;let k=class extends F.A{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};(0,i._)([(0,v.MZ)({type:C,json:{write:{isRequired:!0}}})],k.prototype,"levelLayer",void 0),(0,i._)([(0,v.MZ)({type:j,json:{write:{isRequired:!0}}})],k.prototype,"facilityLayer",void 0),(0,i._)([(0,v.MZ)({type:R,json:{write:!0}})],k.prototype,"siteLayer",void 0),k=(0,i._)([(0,b.$)("esri.support.MapFloorInfo")],k);const E=k;var L,O=r(59187),V=r(61701),U=r(53084);let G=L=class extends F.A{constructor(e){super(e),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new L((0,U.o8)({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};(0,i._)([(0,v.MZ)({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],G.prototype,"activeRange",void 0),(0,i._)([(0,v.MZ)({type:[Number],json:{write:!0}})],G.prototype,"currentRangeExtent",void 0),(0,i._)([(0,v.MZ)({type:[Number],json:{write:!0}})],G.prototype,"fullRangeExtent",void 0),G=L=(0,i._)([(0,b.$)("esri.webdoc.RangeInfo")],G);const z=G;var $;let P=$=class extends F.A{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new $((0,U.o8)({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};(0,i._)([(0,v.MZ)({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],P.prototype,"enabled",void 0),(0,i._)([(0,v.MZ)({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],P.prototype,"longNames",void 0),(0,i._)([(0,v.MZ)({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],P.prototype,"minimized",void 0),(0,i._)([(0,v.MZ)({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],P.prototype,"pinnedLevels",void 0),(0,i._)([(0,v.MZ)({type:String,json:{read:{source:"site"},write:{target:"site"}}})],P.prototype,"site",void 0),(0,i._)([(0,v.MZ)({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],P.prototype,"facility",void 0),(0,i._)([(0,v.MZ)({type:String,json:{read:{source:"level"},write:{target:"level"}}})],P.prototype,"level",void 0),P=$=(0,i._)([(0,b.$)("esri.webdoc.widgets.FloorFilter")],P);const J=P;var B,D=r(45802),q=r(40565);const W=new D.J({slider:"slider",picker:"picker"});let H=B=class extends F.A{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new B({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};(0,i._)([(0,v.MZ)({type:W.apiValues,nonNullable:!0,json:{type:W.jsonValues,default:null,read:{reader:W.read},write:{isRequired:!0,writer:W.write}}})],H.prototype,"interactionMode",void 0),(0,i._)([(0,v.MZ)({type:q.jz,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=null!=this.stopInterval;return{enabled:!e,isRequired:!e}}}}})],H.prototype,"numStops",void 0),(0,i._)([(0,v.MZ)({type:Number,json:{write:{overridePolicy(){return{isRequired:null==this.numStops}}}}})],H.prototype,"stopInterval",void 0),H=B=(0,i._)([(0,b.$)("esri.webdoc.widgets.Range")],H);const K=H;var Y,X=r(48611),Q=r(90115),ee=r(93030);let te=Y=class extends F.A{constructor(e){super(e),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(e){return e?O.A.fromArray(e):void 0}writeCurrentTimeExtent(e,t,r){e&&(0,X.sM)(r,e.toArray(),t)}readFullTimeExtent(e,t){const r=t.properties;if(!r)return;const i=null!=r.endTime?new Date(r.endTime):null,o=null!=r.startTime?new Date(r.startTime):null;return new O.A({start:o,end:i})}writeFullTimeExtent(e,t){if(!e)return;const r=t.properties=t.properties||{},i=e.end,o=e.start;i&&(r.endTime=null!=i?i.getTime():null),o&&(r.startTime=null!=o?o.getTime():null)}readStopInterval(e,t,r){return e?ee.A.fromJSON({value:e.interval,unit:e.units},r):null}writeStopInterval(e,t,r,i){if(!e)return;const o=e.toJSON(i);(0,X.sM)("properties.timeStopInterval",{interval:o.value,units:o.unit},t)}readStops(e){return e?.length?e.map((e=>new Date(e))):null}writeStops(e,t,r){e?.length&&(0,X.sM)(r,e.map((e=>e.getTime())),t)}clone(){return new Y((0,U.o8)({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};(0,i._)([(0,v.MZ)({type:O.A,json:{type:[[q.jz,q.Uv]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],te.prototype,"currentTimeExtent",void 0),(0,i._)([(0,_.w)("currentTimeExtent")],te.prototype,"readCurrentTimeExtent",null),(0,i._)([(0,S.K)("currentTimeExtent")],te.prototype,"writeCurrentTimeExtent",null),(0,i._)([(0,v.MZ)({type:O.A,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],te.prototype,"fullTimeExtent",void 0),(0,i._)([(0,_.w)("fullTimeExtent")],te.prototype,"readFullTimeExtent",null),(0,i._)([(0,S.K)("fullTimeExtent")],te.prototype,"writeFullTimeExtent",null),(0,i._)([(0,v.MZ)({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],te.prototype,"loop",void 0),(0,i._)([(0,v.MZ)({type:q.jz,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){const e=!!this.stopInterval,t=!!this.stops?.length,r=!(e||t);return{enabled:r,isRequired:r}}}}})],te.prototype,"numStops",void 0),(0,i._)([(0,v.MZ)({type:[1,2],nonNullable:!0,json:{type:q.jz,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],te.prototype,"numThumbs",void 0),(0,i._)([(0,v.MZ)({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],te.prototype,"stopDelay",void 0),(0,i._)([(0,v.MZ)({type:ee.A,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:Q.j.jsonValues.filter((e=>"esriTimeUnitsUnknown"!==e))}},overridePolicy(){const e=null!=this.numStops,t=!!this.stops?.length;return{enabled:!t,isRequired:!(e||t)}}}}})],te.prototype,"stopInterval",void 0),(0,i._)([(0,_.w)("stopInterval")],te.prototype,"readStopInterval",null),(0,i._)([(0,S.K)("stopInterval")],te.prototype,"writeStopInterval",null),(0,i._)([(0,v.MZ)({type:[Date],json:{type:[q.jz],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:null==this.numStops&&!this.stopInterval}}}}})],te.prototype,"stops",void 0),(0,i._)([(0,_.w)("stops")],te.prototype,"readStops",null),(0,i._)([(0,S.K)("stops")],te.prototype,"writeStops",null),te=Y=(0,i._)([(0,b.$)("esri.webdoc.widgets.TimeSlider")],te);const re=te;var ie;let oe=ie=class extends F.A{constructor(e){super(e),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new ie((0,U.o8)({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};(0,i._)([(0,v.MZ)({type:K,json:{write:!0}})],oe.prototype,"range",void 0),(0,i._)([(0,v.MZ)({type:re,json:{write:!0}})],oe.prototype,"timeSlider",void 0),(0,i._)([(0,v.MZ)({type:J,json:{write:!0}})],oe.prototype,"floorFilter",void 0),oe=ie=(0,i._)([(0,b.$)("esri.webdoc.Widgets")],oe);const se=oe,ne={width:600,height:400},ae=1.5;var le=r(45417),ue=r(65308),de=r(79942),pe=r(71334),ce=r(70414);function ye(e,t){return t.resourceInfo?he(t,t.resourceInfo,{origin:e.origin}):t.portalItem?.id?async function(e,t,i){if(await i.load().catch((t=>{throw new u.A(`${e.name}:load-portal-item`,"Failed to load portal item",{error:t})})),i.type!==e.itemType)throw new u.A(`${e.name}:invalid-portal-item`,`Invalid portal item type '${i.type}', expected '${e.itemType}'`,{type:i.type});const o=await i.fetchData();t.resourceInfo=o;const s=(0,de.v)(i,e.origin);await function(e,t,r,i){const o=function(e,t){const r=e.parseVersion(t.version||"",e.name);return e.currentVersion.validate(r),t.version=`${r.major}.${r.minor}`,t}(e,r);return t.read(o,i),he(t,o,i)}(e,t,o,s),t.resourceReferences={portalItem:i,paths:s.readResourcePaths};const a=await async function(e,t,i){const o=e?.viewpoint?.targetGeometry;if(o)return null;const s=await async function(e,t,i){const o=e?.spatialReference,s=t?.extent;if(!o||!s)return null;if(o.isWGS84)return s.clone();if(o.isWebMercator)return(0,le.Gh)(s);const{getGeometryServiceURL:n}=await r.e(39483).then(r.bind(r,39483));try{const e=await n(t),r=new ce.A({geometries:[s],outSpatialReference:o});return(await(0,pe.C)(e,r))[0]}catch(E){i.error("Error projecting item's extent:",E)}return null}(e,t,i);return s?new n.A({targetGeometry:s}):null}(t.initialViewProperties,i,c.A.getLogger(t));if(a){const r=t.initialViewProperties?.clone()??e.createInitialViewProperties();r.viewpoint=a,t.initialViewProperties=r}}(e,t,t.portalItem):Promise.resolve()}function he(e,t,i){const o={context:{...i,layerContainerType:"operational-layers"}};return e.portalItem&&(o.context.portal=e.portalItem.portal||ue.A.getDefault()),r.e(15477).then(r.bind(r,60239)).then((r=>{let{populateOperationalLayers:i}=r;const s=[],n=t.operationalLayers;n?.length&&s.push(i(e.layers,n,o));const a={...o,context:{...o.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},l=t.tables;return l?.length&&s.push(i(e.tables,l,a)),Promise.allSettled(s).then((()=>{}))}))}var me=r(8837);function ge(e){return{enabled:!!e?.length}}var fe,we=r(6409),ve=r(6127);let _e=fe=class extends F.A{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new fe({exactMatch:this.exactMatch,type:this.type,name:this.name})}};(0,i._)([(0,v.MZ)({type:Boolean,json:{write:!0}})],_e.prototype,"exactMatch",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:!0}})],_e.prototype,"name",void 0),(0,i._)([(0,we.e)(ve.m)],_e.prototype,"type",void 0),_e=fe=(0,i._)([(0,b.$)("esri.webdoc.applicationProperties.SearchLayerField")],_e);const be=_e;var Se;let Ae=Se=class extends F.A{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new Se((0,U.o8)({field:this.field,id:this.id,subLayer:this.subLayer}))}};(0,i._)([(0,v.MZ)({type:be,json:{write:{isRequired:!0}}})],Ae.prototype,"field",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Ae.prototype,"id",void 0),(0,i._)([(0,v.MZ)({type:q.jz,json:{write:!0}})],Ae.prototype,"subLayer",void 0),Ae=Se=(0,i._)([(0,b.$)("esri.webdoc.applicationProperties.SearchLayer")],Ae);const Te=Ae;var Ie;let Me=Ie=class extends F.A{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new Ie({exactMatch:this.exactMatch,type:this.type,name:this.name})}};(0,i._)([(0,v.MZ)({type:Boolean,json:{write:!0}})],Me.prototype,"exactMatch",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:!0}})],Me.prototype,"name",void 0),(0,i._)([(0,we.e)(ve.m)],Me.prototype,"type",void 0),Me=Ie=(0,i._)([(0,b.$)("esri.webdoc.applicationProperties.SearchTableField")],Me);const Fe=Me;var Ne;let je=Ne=class extends F.A{constructor(e){super(e),this.field=null,this.id=null}clone(){return new Ne((0,U.o8)({field:this.field,id:this.id}))}};(0,i._)([(0,v.MZ)({type:Fe,json:{write:{isRequired:!0}}})],je.prototype,"field",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],je.prototype,"id",void 0),je=Ne=(0,i._)([(0,b.$)("esri.webdoc.applicationProperties.SearchTable")],je);const Ze=je;var Ce;const xe=l.A.ofType(Te),Re=l.A.ofType(Ze);let ke=Ce=class extends F.A{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new xe,this.tables=new Re}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,r){t[r]=!e}clone(){return new Ce((0,U.o8)({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};(0,i._)([(0,v.MZ)({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],ke.prototype,"addressSearchEnabled",void 0),(0,i._)([(0,_.w)("addressSearchEnabled")],ke.prototype,"readAddressSearchEnabled",null),(0,i._)([(0,S.K)("addressSearchEnabled")],ke.prototype,"writeAddressSearchEnabled",null),(0,i._)([(0,v.MZ)({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],ke.prototype,"enabled",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:!0}})],ke.prototype,"hintText",void 0),(0,i._)([(0,v.MZ)({type:xe,json:{write:{overridePolicy:ge},origins:{"web-scene":{write:{isRequired:!0}}}}})],ke.prototype,"layers",void 0),(0,i._)([(0,v.MZ)({type:Re,json:{read:!0,write:{overridePolicy:ge}}})],ke.prototype,"tables",void 0),ke=Ce=(0,i._)([(0,b.$)("esri.webdoc.applicationProperties.Search")],ke);const Ee=ke;var Le;let Oe=Le=class extends F.A{constructor(e){super(e),this.search=null}clone(){return new Le((0,U.o8)({search:this.search}))}};(0,i._)([(0,v.MZ)({type:Ee,json:{write:!0}})],Oe.prototype,"search",void 0),Oe=Le=(0,i._)([(0,b.$)("esri.webdoc.applicationProperties.Viewing")],Oe);const Ve=Oe;var Ue;let Ge=Ue=class extends F.A{constructor(e){super(e),this.editing=null,this.offline=null,this.viewing=null}clone(){return new Ue((0,U.o8)({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};(0,i._)([(0,v.MZ)({json:{write:!0}})],Ge.prototype,"editing",void 0),(0,i._)([(0,v.MZ)({json:{write:!0}})],Ge.prototype,"offline",void 0),(0,i._)([(0,v.MZ)({type:Ve,json:{write:!0}})],Ge.prototype,"viewing",void 0),Ge=Ue=(0,i._)([(0,b.$)("esri.webmap.ApplicationProperties")],Ge);const ze=Ge;var $e,Pe=r(5632),Je=r(21403);let Be=$e=class extends F.A{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return(0,w.m3)(this.url)}get isDataURI(){return(0,w.DB)(this.url)}clone(){return new $e({url:this.url})}};(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],Be.prototype,"url",void 0),(0,i._)([(0,v.MZ)()],Be.prototype,"isSecureUrl",null),(0,i._)([(0,v.MZ)()],Be.prototype,"isDataURI",null),Be=$e=(0,i._)([(0,b.$)("esri.webdoc.support.SlideThumbnail")],Be);const De={type:O.A,json:{read:{source:"timeExtent",reader:e=>e?Array.isArray(e)?O.A.fromArray(e):O.A.fromJSON(e):null},write:{writer:(e,t,r,i)=>{e&&(e.isEmpty?i?.messages&&i.messages.push(new u.A("invalid-timeExtent","TimeExtent cannot be empty")):t[r]=e.toArray())},target:{timeExtent:{type:[[q.jz,q.Uv]]}}}}};var qe;let We=qe=class extends(Pe.A.IdentifiableMixin(F.A)){constructor(e){super(e),this.name=null,this.thumbnail=new Be,this.timeExtent=null}castThumbnail(e){return"string"==typeof e?new Be({url:e}):(0,q.dp)(Be,e)}set viewpoint(e){const{targetGeometry:t,scale:r}=e;null!=t&&"point"===t.type&&null==r&&c.A.getLogger(this).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",e),this._set("viewpoint",e)}readViewpoint(e,t){const{extent:r,viewpoint:i}=t;return n.A.fromJSON(i||{targetGeometry:r})}writeViewpoint(e,t,r,i){if(!e)return;const{targetGeometry:o}=e;if(null==o||"extent"===o.type)null!=o&&(t.extent=o.toJSON()),t[r]=e.toJSON();else{const e="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";i?.messages?i.messages.push(new u.A("property:unsupported",e)):c.A.getLogger(this).error(e)}}clone(){return new qe((0,U.o8)({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};(0,i._)([(0,v.MZ)({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],We.prototype,"name",void 0),(0,i._)([(0,v.MZ)({type:Be,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.url)})}}})],We.prototype,"thumbnail",void 0),(0,i._)([(0,Je.w)("thumbnail")],We.prototype,"castThumbnail",null),(0,i._)([(0,v.MZ)(De)],We.prototype,"timeExtent",void 0),(0,i._)([(0,v.MZ)({type:n.A,nonNullable:!0,json:{write:!0}})],We.prototype,"viewpoint",null),(0,i._)([(0,_.w)("viewpoint",["extent","viewpoint"])],We.prototype,"readViewpoint",null),(0,i._)([(0,S.K)("viewpoint")],We.prototype,"writeViewpoint",null),We=qe=(0,i._)([(0,b.$)("esri.webmap.Bookmark")],We);const He=We;var Ke=r(91967),Ye=r(69098),Xe=r(36693),Qe=r(9409);let et=class extends(Ye.A.ClonableMixin(Ke.A)){constructor(e){super(e),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.timeExtent=null,this.timeZone=Xe.qU,this.viewpoint=null}};(0,i._)([(0,v.MZ)({type:Qe.A})],et.prototype,"background",void 0),(0,i._)([(0,v.MZ)({type:z})],et.prototype,"rangeInfo",void 0),(0,i._)([(0,v.MZ)({type:T.A})],et.prototype,"spatialReference",void 0),(0,i._)([(0,v.MZ)({type:O.A})],et.prototype,"timeExtent",void 0),(0,i._)([(0,v.MZ)({nonNullable:!0})],et.prototype,"timeZone",void 0),(0,i._)([(0,v.MZ)({type:n.A})],et.prototype,"viewpoint",void 0),et=(0,i._)([(0,b.$)("esri.webmap.InitialViewProperties")],et);const tt=et;var rt=r(90761);const it=l.A.ofType(He),ot=new Map([["image/jpeg","jpeg"],["image/jpg","jpg"],["image/png","png"],["image/gif","gif"]]),st=M.mm.JSAPI;let nt=class extends((0,h.P)(d.A.LoadableMixin(m.A.EsriPromiseMixin(s.A)))){constructor(e){super(e),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this.resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new it,this.floorInfo=null,this.initialViewProperties=new tt,this.portalItem=null,this.sourceVersion=null,this.widgets=null,this._debouncedSaveOperations=(0,g.sg)((async(e,t,i)=>{const{save:o,saveAs:s}=await r.e(20339).then(r.bind(r,20339));switch(e){case V.X.SAVE:return o(this.context,this,t);case V.X.SAVE_AS:return s(this.context,this,i,t)}})),this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){this.portalItem=(0,y.pR)(this.portalItem)}initialize(){if(this.when().catch((e=>{c.A.getLogger(this).error("#load()","Failed to load web map",e)})),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(ge){return void this.addResolvingPromise(Promise.reject(ge))}this.read(e)}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp=st}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=o.rE}readInitialViewProperties(e,t){const r=new tt;t.background&&(r.background=Qe.A.fromJSON(t.background));const i=t.initialState?.timeExtent;i&&(r.timeExtent=O.A.fromArray(i));const o=t.initialState?.viewpoint;return o&&(o.rotation&&rt.R.parse(t.version||"","webmap").lessThan(2,20)&&"ArcGIS Pro"===t.authoringApp&&(o.rotation*=-1),r.viewpoint=n.A.fromJSON(o)),t.mapRangeInfo&&(r.rangeInfo=z.fromJSON(t.mapRangeInfo)),t.spatialReference&&(r.spatialReference=T.A.fromJSON(t.spatialReference)),t.timeZone&&(r.timeZone=t.timeZone),r}writeInitialViewProperties(e,t,r,i){if(!e)return;e.background?.color&&(t.background=e.background.write({},i));const{timeExtent:o,viewpoint:s}=e;if(s||o){const e={};s&&(e.viewpoint=s.write({},i)),o&&(e.timeExtent=o.toArray()),t.initialState=e}e.rangeInfo&&(t.mapRangeInfo=e.rangeInfo.toJSON(i)),e.spatialReference&&(t.spatialReference=e.spatialReference.write({},i)),t.timeZone=e.timeZone}writeLayers(e,t,r,i){t[r]=this._writeLayers(e,i,"operational-layers")}readSourceVersion(e,t){const[r,i]=t.version.split(".");return new rt.R(parseInt(r,10),parseInt(i,10))}writeSourceVersion(e,t,r){t[r]=`${this.context.currentVersion.major}.${this.context.currentVersion.minor}`}writeTables(e,t,r,i){const o=this._writeLayers(e,i,"tables");o.length&&(t[r]=o)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}get updatingFromView(){return!!this._updateFromPromise}load(e){return this.addResolvingPromise(ye(this.context,this)),Promise.resolve(this)}loadAll(){return(0,p.g)(this,(e=>{e(this.ground,this.basemap,this.layers,this.tables)}))}read(e,t){t={...t,origin:this.context.origin};const r=this._getAuthoringPropsState();(0,A.t)(this,e,(t=>super.read(e,t)),t),this._restoreAuthoringPropsFromState(r)}write(e,t){if("loaded"!==this.loadStatus){const e=new u.A("webmap:not-loaded","Web map must be loaded before it can be serialized");throw c.A.getLogger(this).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),e}return this._removeDanglingLayerRefs(),t={...t,origin:this.context.origin,restrictedWebMapWriting:!0,webmap:this},super.write(e,t)}async save(e){return this._debouncedSaveOperations(V.X.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(V.X.SAVE_AS,t,e)}async updateFrom(e,t){const r=this._updateFromInternal(e,t);this._updateFromPromise=r,await r,r===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(e){const t=this.resourceInfo;return this._collectAllLayersJSON([...t?.baseMap?.baseMapLayers||[],...t?.operationalLayers||[],...this.basemap?.resourceInfo?.data?.baseMapLayers||[]]).find((t=>t.id===e.id))}async updateItemThumbnail(){this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await(this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})),this._clearThumbnailOverride())}getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:(0,w.rs)(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}_collectAllLayersJSON(e){return e.reduce(((e,t)=>(e.push(t),"GroupLayer"===t.layerType&&(e=e.concat(this._collectAllLayersJSON(t.layers||[]))),e)),[])}_writeLayers(e,t,r){return t={...t,layerContainerType:r},e.map((e=>(0,me.CJ)(e,"tables"===r?null:this.getLayerJSONFromResourceInfo(e),t))).filter(a.Ru).toArray()}_validateJSON(e){const t=rt.R.parse(e.version||"","webmap");return this.context.currentVersion.validate(t),e.version=`${t.major}.${t.minor}`,e}_removeDanglingLayerRefs(){const e=this.applicationProperties,t=e?.viewing?.search,r=e=>this.allLayers.some((t=>t.id===e));if(t?.layers&&(t.layers=t.layers.filter((e=>r(e.id)))),t?.tables&&(t.tables=t.tables.filter((e=>this.tables.some((t=>t.id===e.id))))),e){const t=e.editing?.locationTracking;t?.info&&!r(t.info.layerId)&&(e.editing=null)}const i="presentation"in this?this.presentation:null,o=i?.slides;o&&o.forEach((e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter((e=>r(e.id))))}))}async _updateFromInternal(e,t){if(t??={},await(0,f.C_)((()=>e.ready)),this._updateInitialViewProperties(e,t),e.map===this)for(const r of e.allLayerViews)"visible"in r&&"visible"in r.layer&&r._isOverridden("visible")&&(r.layer.visible=r.visible),"featureEffect"in r&&"featureEffect"in r.layer&&r._isOverridden("featureEffect")&&(r.layer.featureEffect=r.featureEffect);await this._updateThumbnailUrl(e,t)}_updateInitialViewProperties(e,t){if(t.backgroundExcluded||(this.initialViewProperties.background=e.background?.clone()),this.initialViewProperties.spatialReference=e.spatialReference?.clone(),this.initialViewProperties.timeZone=e.timeZone,t.viewpointExcluded||(this.initialViewProperties.viewpoint=new n.A({rotation:e.rotation,scale:t.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!t.widgetsExcluded)for(const r of e.persistableViewModels)r.updateWebDocument(this)}_getViewExtent(e){const t=e.center.clone().normalize(),r=e.extent.clone(),i=r.width/2;return r.xmin=t.x-i,r.xmax=t.x+i,r}async _updateThumbnailUrl(e,t){if(t.thumbnailExcluded)return;const r=function(e,t){t=t||ne;let{width:r,height:i}=t;const o=r/i;return o<ae?i=r/ae:o>ae&&(r=i*ae),r>e.width&&(i*=e.width/r,r=e.width),i>e.height&&(r*=e.height/i,i=e.height),{width:Math.round(r),height:Math.round(i)}}(e,t.thumbnailSize),i=await e.takeScreenshot({format:"png",width:r.width,height:r.height});this._setAutoGeneratedThumbnail(i.dataUrl)}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(e){if((0,w.DB)(e)){const t=(0,w.r$)(e),r=t?.mediaType,i=r&&ot.get(r.toLowerCase())||null,o=`thumbnail${Date.now()}`;return i?`${o}.${i}`:o}return null}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}};(0,i._)([(0,v.MZ)()],nt.prototype,"_updateFromPromise",void 0),(0,i._)([(0,v.MZ)({type:ze,json:{write:!0}})],nt.prototype,"applicationProperties",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],nt.prototype,"authoringApp",null),(0,i._)([(0,S.K)("authoringApp")],nt.prototype,"writeAuthoringApp",null),(0,i._)([(0,v.MZ)({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],nt.prototype,"authoringAppVersion",null),(0,i._)([(0,S.K)("authoringAppVersion")],nt.prototype,"writeAuthoringAppVersion",null),(0,i._)([(0,v.MZ)({type:it,json:{write:{overridePolicy:e=>({enabled:!!(e&&e.length>0),ignoreOrigin:!0})}}})],nt.prototype,"bookmarks",void 0),(0,i._)([(0,v.MZ)({type:E,json:{name:"mapFloorInfo",write:!0}})],nt.prototype,"floorInfo",void 0),(0,i._)([(0,v.MZ)({type:tt,nonNullable:!0,json:{read:{source:["background","initialState.timeExtent","initialState.viewpoint","mapRangeInfo","spatialReference","timeZone"]},write:{ignoreOrigin:!0,target:{background:{type:Qe.A},"initialState.timeExtent":{type:O.A},"initialState.viewpoint":{type:n.A},mapRangeInfo:{type:z},spatialReference:{type:T.A},"timeZone:":{type:String}}}}})],nt.prototype,"initialViewProperties",void 0),(0,i._)([(0,_.w)("initialViewProperties")],nt.prototype,"readInitialViewProperties",null),(0,i._)([(0,S.K)("initialViewProperties")],nt.prototype,"writeInitialViewProperties",null),(0,i._)([(0,v.MZ)({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],nt.prototype,"layers",void 0),(0,i._)([(0,S.K)("layers")],nt.prototype,"writeLayers",null),(0,i._)([(0,v.MZ)({type:I.default})],nt.prototype,"portalItem",void 0),(0,i._)([(0,v.MZ)()],nt.prototype,"resourceInfo",void 0),(0,i._)([(0,v.MZ)({readOnly:!0,type:rt.R,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],nt.prototype,"sourceVersion",void 0),(0,i._)([(0,_.w)("sourceVersion")],nt.prototype,"readSourceVersion",null),(0,i._)([(0,S.K)("sourceVersion")],nt.prototype,"writeSourceVersion",null),(0,i._)([(0,v.MZ)({json:{read:!1,write:{ignoreOrigin:!0}}})],nt.prototype,"tables",void 0),(0,i._)([(0,S.K)("tables")],nt.prototype,"writeTables",null),(0,i._)([(0,v.MZ)()],nt.prototype,"thumbnailUrl",null),(0,i._)([(0,v.MZ)()],nt.prototype,"updatingFromView",null),(0,i._)([(0,v.MZ)({type:se,json:{write:!0}})],nt.prototype,"widgets",void 0),nt=(0,i._)([(0,b.$)("esri.WebDocument2D")],nt);const at=nt;var lt=r(83475);let ut=class extends(Ye.A.ClonableMixin(F.A)){constructor(e){super(e),this.expression=null,this.returnType="string",this.title=null}};(0,i._)([(0,v.MZ)({type:String,json:{write:{isRequired:!0}}})],ut.prototype,"expression",void 0),(0,i._)([(0,v.MZ)({type:["number","string"],json:{write:!0}})],ut.prototype,"returnType",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:!0}})],ut.prototype,"title",void 0),ut=(0,i._)([(0,b.$)("esri.webdoc.geotriggersInfo.ExpressionInfo")],ut);const dt=ut,pt=new D.J({deviceLocation:"device-location"});let ct=class extends(Ye.A.ClonableMixin(F.A)){constructor(e){super(e),this.filterExpression=null,this.type="device-location"}};(0,i._)([(0,v.MZ)({type:dt,json:{write:!0}})],ct.prototype,"filterExpression",void 0),(0,i._)([(0,v.MZ)({type:pt.apiValues,readOnly:!0,json:{type:pt.jsonValues,read:pt.read,write:pt.write}})],ct.prototype,"type",void 0),ct=(0,i._)([(0,b.$)("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],ct);const yt=ct;var ht=r(19902),mt=r(31608);let gt=class extends(Ye.A.ClonableMixin(F.A)){constructor(e){super(e),this.geometry=null,this.where=null}};(0,i._)([(0,v.MZ)({types:mt.yR,json:{read:ht.rS,write:!0}})],gt.prototype,"geometry",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:!0}})],gt.prototype,"where",void 0),gt=(0,i._)([(0,b.$)("esri.webdoc.geotriggersInfo.FeatureFilter")],gt);const ft=gt;let wt=class extends(Ye.A.ClonableMixin(F.A)){constructor(e){super(e),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};(0,i._)([(0,v.MZ)({type:String,json:{write:{overridePolicy(){return{isRequired:null===this.layerUrl}}}}})],wt.prototype,"layerId",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:{overridePolicy(){return{isRequired:null===this.layerId}}}}})],wt.prototype,"layerUrl",void 0),(0,i._)([(0,we.e)({featureLayer:"feature-layer"},{readOnly:!0})],wt.prototype,"type",void 0),wt=(0,i._)([(0,b.$)("esri.webdoc.geotriggersInfo.FeatureLayerSource")],wt);const vt=wt;let _t=class extends(Ye.A.ClonableMixin(F.A)){constructor(e){super(e),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};(0,i._)([(0,v.MZ)({type:vt,json:{write:{isRequired:!0}}})],_t.prototype,"fenceSource",void 0),(0,i._)([(0,v.MZ)({type:ft,json:{write:!0}})],_t.prototype,"filter",void 0),(0,i._)([(0,v.MZ)({type:Number,json:{write:!0}})],_t.prototype,"bufferDistance",void 0),(0,i._)([(0,we.e)({features:"features"},{readOnly:!0})],_t.prototype,"type",void 0),_t=(0,i._)([(0,b.$)("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],_t);const bt=_t;let St=class extends(Ye.A.ClonableMixin(F.A)){constructor(e){super(e),this.type="fence"}};(0,i._)([(0,we.e)({fence:"fence"},{readOnly:!0})],St.prototype,"type",void 0),St=(0,i._)([(0,b.$)("esri.webdoc.geotriggersInfo.Geotrigger")],St);const At=St;let Tt=class extends(Ye.A.ClonableMixin(F.A)){constructor(e){super(e),this.expressionInfo=null,this.requestedActions=null}};(0,i._)([(0,v.MZ)({type:dt,json:{write:!0}})],Tt.prototype,"expressionInfo",void 0),(0,i._)([(0,v.MZ)({type:[String],json:{write:!0}})],Tt.prototype,"requestedActions",void 0),Tt=(0,i._)([(0,b.$)("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],Tt);const It=Tt,Mt=new D.J({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),Ft=new D.J({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),Nt=new D.J({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let jt=class extends At{constructor(e){super(e),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};(0,i._)([(0,we.e)(Mt)],jt.prototype,"enterExitRule",void 0),(0,i._)([(0,v.MZ)({type:yt,json:{write:{isRequired:!0}}})],jt.prototype,"feed",void 0),(0,i._)([(0,we.e)(Ft)],jt.prototype,"feedAccuracyMode",void 0),(0,i._)([(0,v.MZ)({type:Nt.apiValues,json:{type:Nt.jsonValues,read:Nt.read,write:{writer:Nt.write,isRequired:!0}}})],jt.prototype,"fenceNotificationRule",void 0),(0,i._)([(0,v.MZ)({type:bt,json:{write:{isRequired:!0}}})],jt.prototype,"fenceParameters",void 0),(0,i._)([(0,v.MZ)({type:String,json:{write:!0}})],jt.prototype,"name",void 0),(0,i._)([(0,v.MZ)({type:It,json:{write:!0}})],jt.prototype,"notificationOptions",void 0),(0,i._)([(0,we.e)({fence:"fence"},{readOnly:!0})],jt.prototype,"type",void 0),jt=(0,i._)([(0,b.$)("esri.webdoc.geotriggersInfo.FenceGeotrigger")],jt);const Zt={base:At,key:"type",typeMap:{fence:jt}};let Ct=class extends(Ye.A.ClonableMixin(F.A)){constructor(e){super(e),this.geotriggers=null}};(0,i._)([(0,v.MZ)({types:[Zt],json:{write:{isRequired:!0}}})],Ct.prototype,"geotriggers",void 0),Ct=(0,i._)([(0,b.$)("esri.webdoc.GeotriggersInfo")],Ct);const xt=Ct;let Rt=class extends(Ye.A.ClonableMixin(F.A)){constructor(e){super(e),this.portalItem=null}readPortalItem(e,t,r){const{itemId:i}=t;if(i)return new I.default({id:i,portal:r?.portal})}writePortalItem(e,t){e?.id&&(t.itemId=e.id)}};(0,i._)([(0,v.MZ)({type:I.default,json:{write:{isRequired:!0}}})],Rt.prototype,"portalItem",void 0),(0,i._)([(0,_.w)("portalItem",["itemId"])],Rt.prototype,"readPortalItem",null),(0,i._)([(0,S.K)("portalItem",{itemId:{type:String}})],Rt.prototype,"writePortalItem",null),Rt=(0,i._)([(0,b.$)("esri.webdoc.ips.PositioningService")],Rt);const kt=Rt;let Et=class extends(Ye.A.ClonableMixin(F.A)){constructor(e){super(e),this.positioningService=null}};(0,i._)([(0,v.MZ)({type:kt,json:{write:{isRequired:!0}}})],Et.prototype,"positioningService",void 0),Et=(0,i._)([(0,b.$)("esri.webdoc.IPSInfo")],Et);const Lt=Et;var Ot=r(42052);const Vt={currentVersion:Ot.Y,createInitialViewProperties:()=>new tt,parseVersion:rt.R.parse,itemType:"Web Map",name:"webmap",origin:"web-map"},Ut=l.A.ofType(lt.default);let Gt=class extends at{constructor(e){super(e),this.geotriggersInfo=null,this.ipsInfo=null,this.presentation=null,this.utilityNetworks=null}destroy(){if(this.utilityNetworks){const e=this.utilityNetworks.removeAll();for(const t of e)t.destroy();this.utilityNetworks.destroy()}}get context(){return Vt}loadAll(){return(0,p.g)(this,(e=>{e(this.ground,this.basemap,this.layers,this.tables,this.ipsInfo?.positioningService?.portalItem)}))}static fromJSON(e){if(e)return new this({resourceInfo:e});throw new u.A("webmap:empty-resource","Expected a JSON resource but got nothing")}};Gt.VERSION=Ot.Y,(0,i._)([(0,v.MZ)({type:xt,json:{write:!0}})],Gt.prototype,"geotriggersInfo",void 0),(0,i._)([(0,v.MZ)({type:Lt,json:{write:!0,name:"mapIPSInfo"}})],Gt.prototype,"ipsInfo",void 0),(0,i._)([(0,v.MZ)({json:{write:!0}})],Gt.prototype,"presentation",void 0),(0,i._)([(0,v.MZ)({type:Ut,json:{read:!0,write:!0}})],Gt.prototype,"utilityNetworks",void 0),Gt=(0,i._)([(0,b.$)("esri.WebMap")],Gt);const zt=Gt},12899:(e,t,r)=>{r.d(t,{BD:()=>u,D2:()=>i,XZ:()=>a,fO:()=>n,v9:()=>l});var i,o,s=r(45802);(o=i||(i={}))[o.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",o[o.RTContainment=2]="RTContainment",o[o.RTAttachment=3]="RTAttachment",o[o.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",o[o.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity";const n=new s.J({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"}),a=new s.J({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionEdgeMidspanConnectivity:"junction-edge-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"}),l={connectivity:1,"junction-junction-connectivity":1,containment:2,attachment:3,"junction-edge-from-connectivity":4,"junction-edge-midspan-connectivity":5,"junction-edge-to-connectivity":6},u=new s.J({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"})},28009:(e,t,r)=>{function i(e){const t=e?.fieldsIndex,r="fromnetworksourceid",i="fromglobalid",o="fromterminalid",s="tonetworksourceid",n="toglobalid",a="toterminalid",l="status",u="associationtype",d="iscontentvisible",p="percentalong",c="globalid";return{fromNetworkSourceId:t?.get(r)?.name??r,fromGlobalId:t?.get(i)?.name??i,fromTerminalId:t?.get(o)?.name??o,toNetworkSourceId:t?.get(s)?.name??s,toGlobalId:t?.get(n)?.name??n,toTerminalId:t?.get(a)?.name??a,status:t?.get(l)?.name??l,associationType:t?.get(u)?.name??u,isContentVisible:t?.get(d)?.name??d,percentAlong:t?.get(p)?.name??p,globalId:t?.get(e?.globalIdField??c)?.name??c}}function o(e,t){if("feature"!==t.type&&"subtype-group"!==t.type)return[];if(!t.url)return[];const r="utilityNetworks"in e.map?e.map.utilityNetworks??[]:[];for(const i of r)if(i.isUtilityLayer(t)){const e=t.fieldsIndex.get("assetgroup"),r=t.fieldsIndex.get("assettype");return[e?.name,r?.name].filter((e=>null!=e))}return[]}r.d(t,{E:()=>i,_:()=>o})},32173:(e,t,r)=>{r.d(t,{A:()=>u});var i,o=r(35143),s=(r(76460),r(81806),r(47249),r(50076),r(6409)),n=r(85842),a=r(44631);let l=i=class extends a.A{constructor(e){super(e),this.type="inherited"}clone(){return new i}};(0,o._)([(0,s.e)({inherited:"inherited"})],l.prototype,"type",void 0),l=i=(0,o._)([(0,n.$)("esri.layers.support.InheritedDomain")],l);const u=l},39348:(e,t,r)=>{r.d(t,{V:()=>u});var i=r(76460),o=r(48611),s=r(88685),n=r(65256),a=r(50265);const l=()=>i.A.getLogger("esri.intl.substitute");function u(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{format:i={}}=r;return(0,s.HC)(e,(e=>function(e,t,r){let i,s;const n=e.indexOf(":");if(-1===n?i=e.trim():(i=e.slice(0,n).trim(),s=e.slice(n+1).trim()),!i)return"";const a=(0,o.wc)(i,t);if(null==a)return"";const l=(s?r?.[s]:null)??r?.[i];return l?d(a,l):s?p(a,s):c(a)}(e,t,i)))}function d(e,t){switch(t.type){case"date":return(0,n.Yq)(e,t.intlOptions);case"number":return(0,a.ZV)(e,t.intlOptions);default:return l().warn("missing format descriptor for key {key}"),c(e)}}function p(e,t){switch(t.toLowerCase()){case"dateformat":return(0,n.Yq)(e);case"numberformat":return(0,a.ZV)(e);default:return l().warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?(0,n.Yq)(e):/^numberformat/i.test(t)?(0,a.ZV)(e):c(e)}}function c(e){switch(typeof e){case"string":return e;case"number":return(0,a.ZV)(e);case"boolean":return""+e;default:return e instanceof Date?(0,n.Yq)(e):""}}},44135:(e,t,r)=>{r.d(t,{A:()=>g});var i,o=r(35143),s=r(45802),n=r(42553),a=r(46053),l=r(40565),u=(r(81806),r(47249),r(6409)),d=r(28379),p=r(85842),c=r(76866),y=r(6127);const h=new s.J({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let m=i=class extends n.A{constructor(e){super(e),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=void 0,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(e,t){let{description:r}=t,i=null;try{i=r?JSON.parse(r):null}catch(o){}return i?.value??null}readValueType(e,t){let{description:r}=t,i=null;try{i=r?JSON.parse(r):null}catch(o){}return i?h.fromJSON(i.fieldValueType):null}clone(){return new i({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain?.clone()??null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};(0,o._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"alias",void 0),(0,o._)([(0,a.MZ)({type:[String,Number],json:{write:{allowNull:!0}}})],m.prototype,"defaultValue",void 0),(0,o._)([(0,a.MZ)()],m.prototype,"description",void 0),(0,o._)([(0,d.w)("description")],m.prototype,"readDescription",null),(0,o._)([(0,a.MZ)({types:c.gK,json:{read:{reader:c.rS},write:!0}})],m.prototype,"domain",void 0),(0,o._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],m.prototype,"editable",void 0),(0,o._)([(0,a.MZ)({type:l.jz,json:{write:{overridePolicy:e=>({enabled:Number.isFinite(e)})}}})],m.prototype,"length",void 0),(0,o._)([(0,a.MZ)({type:String,json:{write:!0}})],m.prototype,"name",void 0),(0,o._)([(0,a.MZ)({type:Boolean,json:{write:!0}})],m.prototype,"nullable",void 0),(0,o._)([(0,u.e)(y.m)],m.prototype,"type",void 0),(0,o._)([(0,a.MZ)()],m.prototype,"valueType",void 0),(0,o._)([(0,d.w)("valueType",["description"])],m.prototype,"readValueType",null),(0,o._)([(0,a.MZ)({type:Boolean,json:{read:!1}})],m.prototype,"visible",void 0),m=i=(0,o._)([(0,p.$)("esri.layers.support.Field")],m);const g=m},44460:(e,t,r)=>{r.d(t,{Cb:()=>s,HW:()=>d,JR:()=>o,JZ:()=>l,WR:()=>a,b6:()=>p,fT:()=>i,nC:()=>u,yM:()=>n});const i=[252,146,31,255],o=[153,153,153,255],s={type:"esriSMS",style:"esriSMSCircle",size:6,color:i,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},n={type:"esriSLS",style:"esriSLSSolid",width:.75,color:i},a={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},l={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},u={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},d={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},p={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},44631:(e,t,r)=>{r.d(t,{A:()=>p});var i=r(35143),o=r(45802),s=r(42553),n=r(46053),a=(r(81806),r(76460),r(47249),r(6409)),l=r(85842);const u=new o.J({inherited:"inherited",codedValue:"coded-value",range:"range"});let d=class extends s.A{constructor(e){super(e),this.name=null,this.type=null}};(0,i._)([(0,n.MZ)({type:String,json:{write:!0}})],d.prototype,"name",void 0),(0,i._)([(0,a.e)(u),(0,n.MZ)({json:{write:{isRequired:!0}}})],d.prototype,"type",void 0),d=(0,i._)([(0,l.$)("esri.layers.support.Domain")],d);const p=d},49723:(e,t,r)=>{r.d(t,{AG:()=>a,lk:()=>o,vD:()=>n,yS:()=>s});const i="randomUUID"in crypto;function o(){if(i)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const t=t=>e[t].toString(16).padStart(4,"0");return t(0)+t(1)+"-"+t(2)+"-"+t(3)+"-"+t(4)+"-"+t(5)+t(6)+t(7)}function s(){return`{${o().toUpperCase()}}`}function n(){return`{${o()}}`}function a(e){const t=e.toUpperCase();return"{"!==e[0]?`{${t}}`:t}},50265:(e,t,r)=>{r.d(t,{$J:()=>d,ZV:()=>u,yx:()=>l});var i=r(38042);const o={ar:"ar-u-nu-latn"};let s=new WeakMap,n={};function a(e){const t=e||n;if(!s.has(t)){const r=(0,i.JK)(),n=o[(0,i.JK)()]||r;s.set(t,new Intl.NumberFormat(n,e))}return s.get(t)}function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function u(e,t){return Object.is(e,-0)&&(e=0),a(t).format(e)}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,i.JK)();if(!e)return null;let r=p.get(t);if(!r){const e=a().formatToParts(12345.6),i=[...a({useGrouping:!1}).format(9876543210)].reverse(),o=new Map(i.map(((e,t)=>[e,t]))),s=new RegExp(`[${e.find((e=>"group"===e.type))?.value}]`,"g"),n=new RegExp(`[${e.find((e=>"decimal"===e.type))?.value}]`),l=new RegExp(`[${i.join("")}]`,"g"),u=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,d=/[-\u2212\u2013\u2014\u2015]/g;r=e=>{if(""===(e=e.trim().replaceAll(s,"").replace(n,".").replace(l,(e=>String(o.get(e)))).replaceAll(u,"").replaceAll(d,"-")))return null;const t=Number(e);return isNaN(t)?null:t},p.set(t,r)}return r(e)}(0,i.Ml)((()=>{s=new WeakMap,n={}}));const p=new Map},50654:(e,t,r)=>{r.d(t,{A:()=>d});var i,o=r(35143),s=r(46053),n=(r(81806),r(76460),r(47249),r(6409)),a=r(85842),l=r(44631);let u=i=class extends l.A{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new i({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};(0,o._)([(0,s.MZ)({json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range?.[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(e,t,r){t[r]=[this.minValue||0,e]},isRequired:!0}}})],u.prototype,"maxValue",void 0),(0,o._)([(0,s.MZ)({json:{type:[Number],read:{source:"range",reader:(e,t)=>t.range?.[0]},write:{target:"range",writer(e,t,r){t[r]=[e,this.maxValue||0]},isRequired:!0}}})],u.prototype,"minValue",void 0),(0,o._)([(0,n.e)({range:"range"})],u.prototype,"type",void 0),u=i=(0,o._)([(0,a.$)("esri.layers.support.RangeDomain")],u);const d=u},53521:(e,t,r)=>{r.d(t,{q:()=>o});var i=r(79369);class o{constructor(e,t){this._storage=new i.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},57778:(e,t,r)=>{r.d(t,{A:()=>g});var i=r(35143),o=r(42553),s=r(46053),n=(r(81806),r(76460),r(47249),r(85842)),a=r(66388),l=r(65215),u=r(23701);let d=class extends o.A{constructor(e){super(e),this.line=null,this.multipoint=null,this.polygon=null}};(0,i._)([(0,s.MZ)({type:u.A,json:{write:!0},readOnly:!0})],d.prototype,"line",void 0),(0,i._)([(0,s.MZ)({type:a.A,json:{read:{source:"point"},write:{target:"point"}},readOnly:!0})],d.prototype,"multipoint",void 0),(0,i._)([(0,s.MZ)({type:l.A,json:{write:!0},readOnly:!0})],d.prototype,"polygon",void 0),d=(0,i._)([(0,n.$)("esri.rest.networks.support.AggregatedGeometry")],d);const p=d;let c=class extends o.A{constructor(e){super(e),this.functionType=null,this.networkAttributeName=null,this.result=null}};(0,i._)([(0,s.MZ)({type:["add","subtract","average","count","min","max"],json:{write:!0},readOnly:!0})],c.prototype,"functionType",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0},readOnly:!0})],c.prototype,"networkAttributeName",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{write:!0},readOnly:!0})],c.prototype,"result",void 0),c=(0,i._)([(0,n.$)("esri.rest.networks.support.FunctionResult")],c);const y=c;var h=r(64533);let m=class extends o.A{constructor(e){super(e),this.aggregatedGeometry=null,this.elements=null,this.globalFunctionResults=null,this.kFeaturesForKNNFound=!1,this.startingPointsIgnored=!1,this.warnings=null}};(0,i._)([(0,s.MZ)({type:p,json:{write:!0},readOnly:!0})],m.prototype,"aggregatedGeometry",void 0),(0,i._)([(0,s.MZ)({type:[h.A],json:{write:!0},readOnly:!0})],m.prototype,"elements",void 0),(0,i._)([(0,s.MZ)({type:[y],json:{write:!0},readOnly:!0})],m.prototype,"globalFunctionResults",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0},readOnly:!0})],m.prototype,"kFeaturesForKNNFound",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0},readOnly:!0})],m.prototype,"startingPointsIgnored",void 0),(0,i._)([(0,s.MZ)({type:[String],json:{write:!0},readOnly:!0})],m.prototype,"warnings",void 0),m=(0,i._)([(0,n.$)("esri.rest.networks.support.TraceResult")],m);const g=m},63860:(e,t,r)=>{r.d(t,{ao:()=>y,ud:()=>h,xO:()=>m});var i=r(50076),o=r(54901),s=r(50346),n=r(38042);const a=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,l={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function u(e){if(function(e){return e in l}(e)){const t=l[e];return!0===t?e:t}return null}const d=[],p=new Map;function c(e){for(const t of p.keys())g(e.pattern,t)&&p.delete(t)}function y(e){return d.includes(e)||(c(e),d.unshift(e)),(0,o.hA)((()=>{const t=d.indexOf(e);t>-1&&(d.splice(t,1),c(e))}))}async function h(e){const t=(0,n.JK)();p.has(e)||p.set(e,async function(e,t){const r=[];for(const i of d)if(g(i.pattern,e))try{return await i.fetchMessageBundle(e,t)}catch(o){r.push(o)}if(r.length)throw new i.A("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:r});throw new i.A("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,t));const r=p.get(e);return r&&await f.add(r),r}function m(e){if(!a.test(e))return null;const t=a.exec(e);if(null===t)return null;const[,r,i]=t;return u(r+(i?"-"+i.toUpperCase():""))??u(r)}function g(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}(0,n.Ml)((()=>{p.clear()}));const f=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then((()=>this._decrease()),(()=>this._decrease())),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=(0,s.Tw)())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}}},64154:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(35143),o=r(46053),s=(r(81806),r(76460),r(47249),r(85842)),n=r(79685);let a=class extends n.A{constructor(e){super(e),this.filterBarriers=[],this.arcadeExpressionBarrier=null,this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.allowIndeterminateFlow=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.diagramTemplateName=null,this.tierName=null,this.validateLocatability=null}};(0,i._)([(0,o.MZ)({type:[Object],json:{write:!0}})],a.prototype,"filterBarriers",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],a.prototype,"arcadeExpressionBarrier",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],a.prototype,"domainNetworkName",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],a.prototype,"filterBitsetNetworkAttributeName",void 0),(0,i._)([(0,o.MZ)({type:[Object],json:{write:!0}})],a.prototype,"filterFunctionBarriers",void 0),(0,i._)([(0,o.MZ)({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],a.prototype,"filterScope",void 0),(0,i._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeContainers",void 0),(0,i._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeContent",void 0),(0,i._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeIsolated",void 0),(0,i._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeStructures",void 0),(0,i._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"allowIndeterminateFlow",void 0),(0,i._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeUpToFirstSpatialContainer",void 0),(0,i._)([(0,o.MZ)({type:Object,json:{write:!0}})],a.prototype,"nearestNeighbor",void 0),(0,i._)([(0,o.MZ)({type:[Object],json:{write:!0}})],a.prototype,"outputFilterCategories",void 0),(0,i._)([(0,o.MZ)({type:[Object],json:{write:!0}})],a.prototype,"outputFilters",void 0),(0,i._)([(0,o.MZ)({type:[Object],json:{write:!0}})],a.prototype,"propagators",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],a.prototype,"subnetworkName",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],a.prototype,"targetTierName",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],a.prototype,"diagramTemplateName",void 0),(0,i._)([(0,o.MZ)({type:String,json:{write:!0}})],a.prototype,"tierName",void 0),(0,i._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"validateLocatability",void 0),a=(0,i._)([(0,s.$)("esri.networks.support.UNTraceConfiguration")],a);const l=a},64810:(e,t,r)=>{r.d(t,{Ch:()=>a,mW:()=>s,u2:()=>n});var i=r(15941),o=r(34154);function s(e,t){return{...t,filterMode:e.mode}}function n(e,t){return l(e,t).next().value??null}function a(e,t,r){const s=function(e){if("manual"===d(e))return null;const t=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:r,maxScale:i}of e.filters)t[0]=Math.max(t[0],p(r)),t[1]=Math.min(t[1],c(i));return t}(e);if(s&&((0,i.gg)(t,s[0])||(0,i.ZH)(r,s[1])))return"";const n=Array.from(l(e,t,r)),a=function(e,t,r){if(0===e.length)return!0;const o=p(e.at(0)?.minScale),s=c(e.at(-1)?.maxScale);if((0,i.ZH)(o,t)||(0,i.gg)(s,r))return!0;for(let n=0;n<e.length-1;n++){const t=e[n],r=e[n+1];if((0,i.ZH)(p(r.minScale),c(t.maxScale)))return!0}return!1}(n,t,r)?"1=1":n.map((e=>e.where||"1=1")).reduce(((e,t)=>(0,o.IW)(e,t)),"");return a&&"1=1"!==a?a:""}function*l(e,t,r){if("manual"===d(e)){const t=e.filters.find((t=>t.id===e.activeFilterId));t&&(yield t)}else{"object"==typeof t&&(t=t.scale);for(const i of e.filters)u(i.minScale,i.maxScale,t,r)&&(yield i)}}function u(e,t,r,o){return e=p(e),r=p(r),t=c(t),!(!(0,i.Sp)(r,e)&&(o??r)>e)&&!(0,i.Hx)(t,r)&&(void 0===o||!(0,i.Sp)(o,e))}function d(e){return"mode"in e?e.mode:e.filterMode}function p(e){return e||Number.POSITIVE_INFINITY}function c(e){return e||0}},70414:(e,t,r)=>{r.d(t,{A:()=>p});var i=r(35143),o=r(42553),s=r(46053),n=(r(81806),r(76460),r(47249),r(85842)),a=r(13312),l=r(19902),u=r(80963);let d=class extends o.A{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map((e=>e.toJSON())),t=this.geometries[0],r={};return r.outSR=(0,u.YX)(this.outSpatialReference),r.inSR=(0,u.YX)(t.spatialReference),r.geometries=JSON.stringify({geometryType:(0,l.$B)(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}};(0,i._)([(0,s.MZ)()],d.prototype,"geometries",void 0),(0,i._)([(0,s.MZ)({type:a.A,json:{read:{source:"outSR"}}})],d.prototype,"outSpatialReference",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"transformation",void 0),(0,i._)([(0,s.MZ)()],d.prototype,"transformForward",void 0),d=(0,i._)([(0,n.$)("esri.rest.support.ProjectParameters")],d);const p=d},71334:(e,t,r)=>{r.d(t,{C:()=>d});var i=r(3825),o=r(40565),s=r(19902),n=r(54994),a=r(71838),l=r(70414);const u=(0,o.dp)(l.A);async function d(e,t,r){t=u(t);const o=(0,n.Dl)(e),l={...o.query,f:"json",...t.toJSON()},d=t.outSpatialReference,p=(0,s.$B)(t.geometries[0]),c=(0,n.jV)(l,r);return(0,i.A)(o.path+"/project",c).then((e=>{let{data:{geometries:t}}=e;return(0,a.V)(t,p,d)}))}},72599:(e,t,r)=>{r.d(t,{A:()=>c});var i,o=r(35143),s=r(53084),n=r(46053),a=(r(81806),r(76460),r(6409)),l=r(85842),u=r(92115),d=r(44631);let p=i=class extends d.A{constructor(e){super(e),this.codedValues=null,this.type="coded-value"}getName(e){let t=null;if(this.codedValues){const r=String(e);this.codedValues.some((e=>(String(e.code)===r&&(t=e.name),!!t)))}return t}clone(){return new i({codedValues:(0,s.o8)(this.codedValues),name:this.name})}};(0,o._)([(0,n.MZ)({type:[u.H],json:{write:{isRequired:!0}}})],p.prototype,"codedValues",void 0),(0,o._)([(0,a.e)({codedValue:"coded-value"})],p.prototype,"type",void 0),p=i=(0,o._)([(0,l.$)("esri.layers.support.CodedValueDomain")],p);const c=p},76866:(e,t,r)=>{r.d(t,{gK:()=>a,rS:()=>l});r(81806);var i=r(72599),o=r(44631),s=r(32173),n=r(50654);const a={key:"type",base:o.A,typeMap:{range:n.A,"coded-value":i.A,inherited:s.A}};function l(e){if(!e?.type)return null;switch(e.type){case"range":return n.A.fromJSON(e);case"codedValue":return i.A.fromJSON(e);case"inherited":return s.A.fromJSON(e)}return null}},79369:(e,t,r)=>{r.d(t,{F:()=>l,Ti:()=>o});var i=r(30015);const o=-3,s=o-1;var n,a;(a=n||(n={}))[a.ALL=0]="ALL",a[a.SOME=1]="SOME";class l{get size(){return this._size}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new i.A,this._users=new i.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear()}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,r,i,a){t=e.id+t;const l=this._db.get(t);if(l&&(this._size-=l.size,e.size-=l.size,this._db.delete(t),l.entry!==r&&this._notifyRemove(t,l.entry,l.size,n.ALL)),i>this._maxSize)return void this._notifyRemove(t,r,i,n.ALL);if(void 0===r)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return console.warn(`Refusing to cache entry with size ${i} for key ${t}`),void this._notifyRemove(t,r,0,n.ALL);const d=1+Math.max(a,s)-o;this._db.set(t,new u(r,i,d)),this._size+=i,e.size+=i,this._checkSize()}updateSize(e,t,r,i){t=e.id+t;const o=this._db.get(t);if(o&&o.entry===r){for(this._size-=o.size,e.size-=o.size;i>this._maxSize;){const e=this._notifyRemove(t,r,i,n.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);i=e}o.size=i,this._size+=i,e.size+=i,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach(((e,i)=>{const o=e.lifetime;r[o]=(r[o]||0)+e.size,this._users.forAll((r=>{const{id:o,name:s}=r;if(i.startsWith(o)){const r=t[s]||0;t[s]=r+e.size}}))}));const i={};this._users.forAll((e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const o=t[r]||0;t[r]=o,i[r]=Math.round(100*e.hitRate)+"%"}else i[r]="0%"}));const s=Object.keys(t);s.sort(((e,r)=>t[r]-t[e])),s.forEach((r=>e[r]=Math.round(t[r]/2**20)+"MB / "+i[r]));for(let n=r.length-1;n>=0;--n){const t=r[n];t&&(e["Priority "+(n+o-1)]=Math.round(t/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,n.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,n.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,i){let o;return this._removeFuncs.some((s=>{if(e.startsWith(s[0])){const e=s[1](t,i,r);return"number"==typeof e&&(o=e),!0}return!1})),o}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const r=e?.id;let i=!0;for(;i;){i=!1;for(const[o,s]of this._db)if(0===s.lifetime&&(!r||o.startsWith(r))){if(this._purgeItem(o,s,e),t.size<=.9*t.maxSize)return;i||=this._db.has(o)}}for(const[o,s]of this._db)if((!r||o.startsWith(r))&&(this._purgeItem(o,s,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._users.find((t=>e.startsWith(t.id)));if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const i=this._notifyRemove(e,t.entry,t.size,n.SOME);null!=i&&i>0&&(this._size+=i,r&&(r.size+=i),t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}class u{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}},79685:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(35143),o=r(42553),s=r(46053),n=(r(81806),r(76460),r(47249),r(85842));let a=class extends o.A{constructor(e){super(e),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"conditionBarriers",void 0),(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"outputConditions",void 0),(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"functions",void 0),(0,i._)([(0,s.MZ)({type:[Object],json:{write:!0}})],a.prototype,"functionBarriers",void 0),(0,i._)([(0,s.MZ)({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],a.prototype,"traversabilityScope",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],a.prototype,"shortestPathNetworkAttributeName",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"includeBarriers",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"validateConsistency",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],a.prototype,"ignoreBarriersAtStartingPoints",void 0),a=(0,i._)([(0,n.$)("esri.networks.support.TraceConfiguration")],a);const l=a},79942:(e,t,r)=>{r.d(t,{m:()=>n,v:()=>s});var i=r(90534),o=r(65308);function s(e,t){return{...a(e,t),readResourcePaths:[]}}function n(e,t,r){const o=(0,i.An)(e.itemUrl);return{...a(e,t),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:o?{rootPath:o.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function a(e,t){return{origin:t,url:(0,i.An)(e.itemUrl),portal:e.portal||o.A.getDefault(),portalItem:e}}},83475:(e,t,r)=>{r.d(t,{default:()=>ee});var i=r(35143),o=r(39356),s=r(46053),n=(r(81806),r(76460)),a=(r(47249),r(85842)),l=r(38451),u=r(74438),d=r(3825),p=r(50076),c=r(49304),y=r(77717),h=r(50346),m=r(90534),g=r(76797),f=r(13312),w=r(19902),v=r(61979),_=r(13096),b=r(45802),S=r(6409),A=r(11187);const T=(0,b.O)()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let I=class extends A.A{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const t={...e,query:{f:"json"}},{data:r}=await(0,d.A)(this.statusUrl,t);return this.read(r),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this}async waitForJobCompletion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{interval:t=1e3,statusCallback:r}=e;return new Promise(((e,i)=>{this._clearTimer();const o=setInterval((()=>{this._timer||i((0,h.NK)()),this.checkJobStatus().then((t=>{const{status:i}=t;switch(this.status=i,i){case"job-succeeded":this._clearTimer(),e(this);break;case"job-waiting":case"job-executing":r&&r(this)}}),(e=>{this._clearTimer(),i(e)}))}),t);this._timer=o}))}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};(0,i._)([(0,s.MZ)()],I.prototype,"editsResolver",void 0),(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],I.prototype,"statusUrl",void 0),(0,i._)([(0,S.e)(T)],I.prototype,"status",void 0),(0,i._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],I.prototype,"submissionTime",void 0),(0,i._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],I.prototype,"lastUpdatedTime",void 0),I=(0,i._)([(0,a.$)("esri.networks.support.TopologyValidationJobInfo")],I);const M=I;var F=r(70652);r(77725);async function N(e,t){if("Utility Network Layer"===e){const{default:e}=await Promise.resolve().then(r.bind(r,83475));return new e({layerUrl:t})}return null}var j=r(35298);let Z=class extends((0,y.P)(c.A)){static fromPortalItem(e){return async function(e){let t="portalItem"in e?e:{portalItem:e};!t.portalItem||t.portalItem instanceof F.default||(t={...t,portalItem:new F.default(t.portalItem)});const r=t.portalItem;if(await r.load(),"Feature Service"!==r.type)throw new p.A("portal:unknown-item-type","Unknown item type '${type}'",{type:r.type});const i=r.url,o=await(0,d.A)(i,{responseType:"json",query:{f:"json"}}),s="Network Layer";if(o.data.type?.includes(s))return N(o.data.type,i);if(o.data.layers){const e=o.data.layers.find((e=>e.type.includes(s)));if(e){const t=`${i}/${e.id}`;return N(e.type,t)}}return null}(e)}constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this.gdbVersion=null,this.historicMoment=null,this._sourceIdByLayerId=new Map,this._layerIdBySourceId=new Map,this._applyEditsHandler=e=>{const{serviceUrl:t,gdbVersion:r,result:i}=e,o=t===this.featureServiceUrl,s=(0,v.gz)(t,r,this.gdbVersion);o&&s&&i.then((e=>{(0,j.w5)(t,r)&&(this.historicMoment=e.historicMoment)}))},this._updateMomentHandler=e=>{const{serviceUrl:t,gdbVersion:r,moment:i}=e,o=t===this.featureServiceUrl,s=(0,v.gz)(t,r,this.gdbVersion);o&&s&&(this.historicMoment=i)},this.when().then((()=>{this.addHandles([(0,v.Jz)(this._applyEditsHandler),(0,v.dP)(this._updateMomentHandler)])}),(()=>{}))}initialize(){this.when().catch((e=>{(0,h.zf)(e)||n.A.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})}))}get datasetName(){return this.dataElement?.name??null}get owner(){return this.dataElement?.userIdentity??null}get schemaGeneration(){return this.dataElement?.schemaGeneration??null}get parsedUrl(){return(0,m.An)(this.layerUrl)}get featureServiceUrl(){return(0,_.qg)(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return(0,_.qg)(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(!this.dataElement)return null;const t=this._layerIdBySourceId.get(e);if(null!=t)return t;const r=this.dataElement.domainNetworks,i=this._traverseNetworkSources(r,this._layerIdBySourceId,"sourceId","layerId",e);return i>=0?i:null}getSourceIdByLayerId(e){if(!this.dataElement)return null;const t=this._sourceIdByLayerId.get(e);if(null!=t)return t;const r=this.dataElement.domainNetworks,i=this._traverseNetworkSources(r,this._sourceIdByLayerId,"layerId","sourceId",e);return i>=0?i:null}getObjectIdsFromElements(e){const t=[],r=new Map;for(const o of e){const e=this.getLayerIdBySourceId(o.networkSourceId);if(null==e)continue;let t=r.get(e);void 0===t&&(t=[]),t.push(o.objectId),r.set(e,t)}const i=this.featureServiceUrl;return r.forEach(((e,r)=>t.push({layerUrl:`${i}/${r}`,objectIds:e}))),t}async queryNamedTraceConfigurations(e,t){const[{queryNamedTraceConfigurations:i},{default:o}]=await Promise.all([r.e(8341).then(r.bind(r,8341)),r.e(77194).then(r.bind(r,77194))]),s=this.networkServiceUrl,n=o.from(e);return(await i(s,n,{...t}))?.namedTraceConfigurations}async validateTopology(e,t){if(!e.validateArea)throw new p.A("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const[{validateNetworkTopology:i},{default:o}]=await Promise.all([r.e(77814).then(r.bind(r,77814)),r.e(28266).then(r.bind(r,28266))]),s=o.from(e);(0,j.w5)(this.featureServiceUrl,this.gdbVersion||null)?(s.sessionID=j.TA,await(0,j.ZJ)(this.featureServiceUrl,this.gdbVersion,!0)):s.sessionID=null,s.gdbVersion=this.gdbVersion;const n=this.networkServiceUrl,a=this.featureServiceUrl,l=(0,v.Zk)(a,null,this.gdbVersion,!0),u=await i(n,s,{...t});if(u?.serviceEdits){const e=[];for(const t of u.serviceEdits){const{editedFeatures:r}=t,i=r?.spatialReference?new f.A(r.spatialReference):null;e.push({layerId:t.layerId,editedFeatures:{adds:r?.adds?.map((e=>C(e,i)))||[],updates:r?.updates?.map((e=>({original:C(e[0],i),current:C(e[1],i)})))||[],deletes:r?.deletes?.map((e=>C(e,i)))||[],spatialReference:i}})}l.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:e,exceededTransferLimit:!1,historicMoment:u.moment})}return u}async submitTopologyValidationJob(e,t){let i=null;if(!e.validateArea)throw new p.A("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){const e=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");i=(await(0,d.A)(e,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}const[{submitValidateNetworkTopologyJob:o},{default:s}]=await Promise.all([r.e(77814).then(r.bind(r,77814)),r.e(28266).then(r.bind(r,28266))]),n=s.from(e);(0,j.w5)(this.featureServiceUrl,this.gdbVersion||null)?(n.sessionID=j.TA,await(0,j.ZJ)(this.featureServiceUrl,this.gdbVersion,!0)):n.sessionID=null,n.gdbVersion=this.gdbVersion||i;const a=this.networkServiceUrl,l=this.featureServiceUrl?(0,v.Zk)(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,u=await o(a,n,{...t});return new M({statusUrl:u,editsResolver:l})}getSourceTypeById(e){if(!this.dataElement)return null;for(const t of this.dataElement.domainNetworks)for(const r of[t.edgeSources??[],t.junctionSources??[]])for(const i of r)if(i.sourceId===e)return r===t.edgeSources?"edge":"junction";return null}_traverseNetworkSources(e,t,r,i,o){for(const s of e)for(const e of[s.edgeSources??[],s.junctionSources??[]])for(const s of e)if(s[r]===o)return t.set(o,s[i]),s[i];return-1}async _fetchLayerMetaData(e,t){const r=await(0,d.A)(e,{responseType:"json",query:{f:"json"},...t});this.sourceJSON=r.data,this.read(r.data,{origin:"service"})}async _fetchDataElement(e,t,r){if(this.dataElement)return;const i=await(0,d.A)(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...r}).then((e=>e.data.layerDataElements?.[0]));i&&this.read(i,{origin:"service"})}};function C(e,t){return new o.A({attributes:e.attributes,geometry:(0,w.rS)({...e.geometry,spatialReference:t})})}(0,i._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],Z.prototype,"id",void 0),(0,i._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],Z.prototype,"title",void 0),(0,i._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],Z.prototype,"layerUrl",void 0),(0,i._)([(0,s.MZ)({type:Object,json:{origins:{service:{read:!0}},read:!1}})],Z.prototype,"dataElement",void 0),(0,i._)([(0,s.MZ)({type:g.A,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],Z.prototype,"fullExtent",void 0),(0,i._)([(0,s.MZ)({type:f.A,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],Z.prototype,"spatialReference",void 0),(0,i._)([(0,s.MZ)({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],Z.prototype,"type",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"datasetName",null),(0,i._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"owner",null),(0,i._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"schemaGeneration",null),(0,i._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"parsedUrl",null),(0,i._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"featureServiceUrl",null),(0,i._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"networkServiceUrl",null),(0,i._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"layerId",null),(0,i._)([(0,s.MZ)()],Z.prototype,"sourceJSON",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],Z.prototype,"networkSystemLayers",null),(0,i._)([(0,s.MZ)()],Z.prototype,"gdbVersion",void 0),(0,i._)([(0,s.MZ)({type:Date})],Z.prototype,"historicMoment",void 0),Z=(0,i._)([(0,a.$)("esri.networks.Network")],Z);const x=Z;var R=r(42553),k=r(31933),E=r(12899);let L=class extends(R.A.JSONSupportMixin(c.A)){constructor(e){super(e),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=d.A}initialize(){}async load(e){const t=this.rulesLayer.load(e).then((()=>this._initializeRulesTable()));return this.addResolvingPromise(t),this}getFeaturesCanAssociateWithClause(e,t,r){return this._getWhereClauseForCompatibleFeatures(e,t,r)}getFeaturesCanAssociateWith(e,t,r){return null==this._getFeatureSourceLayerId(e)?[]:t.filter((t=>this.canAssociateFeatures(e,t,r)))}canAssociateFeatures(e,t,r){const[i,o]=this._getFeatureAssetCodes(e),s=this._getFeatureSourceLayerId(e),[n,a]=this._getFeatureAssetCodes(t),l=this._getFeatureSourceLayerId(t);return null!=s&&null!=l&&r.some((e=>{const{type:t,direction:r}=e;return this._getRulesForAssociationType(t).some((e=>{const u=this._getRuleFieldValuesForAssociation(e,t,r);return u?.some((e=>s===e?.ruleLayerIdForSource&&i===e?.ruleAssetGroupCodeForSource&&o===e?.ruleAssetTypeCodeForSource&&l===e?.ruleLayerIdForTarget&&n===e?.ruleAssetGroupCodeForTarget&&a===e?.ruleAssetTypeCodeForTarget))}))}))}getLayersCanAssociateWith(e,t,r){return null==this._getFeatureSourceLayerId(e)?[]:t.filter((t=>this.canAssociateFeatureToLayer(e,t,r)))}canAssociateFeatureToLayer(e,t,r){const i=(0,k.Sv)(t)?t.parent:t;if(!i)return!1;const o=i.layerId,s=(0,k.Sv)(t)?t.subtypeCode:null,[n,a]=this._getFeatureAssetCodes(e),l=this._getFeatureSourceLayerId(e);return null!=l&&r.some((e=>{const{type:t,direction:r}=e;return this._getRulesForAssociationType(t).some((e=>{const i=this._getRuleFieldValuesForAssociation(e,t,r);return i?.some((e=>l===e?.ruleLayerIdForSource&&n===e?.ruleAssetGroupCodeForSource&&a===e?.ruleAssetTypeCodeForSource&&o===e?.ruleLayerIdForTarget&&(null==s||s===e?.ruleAssetGroupCodeForTarget)))}))}))}getFeatureSQL(e,t){const r=e.layerId.toString(),i=e.fieldsIndex?.normalizeFieldName("assetGroup"),o=e.fieldsIndex?.normalizeFieldName("assetType"),s=i?t.attributes[i]:null,n=o?t.attributes[o]:null,a=this.rulesHash[r];if(a){const e=a.assetGroupHash[s];if(e)return e.assetTypeHash[n]||null}return null}async _initializeRulesTable(){const e={};let t;!function(e){e[e.from=0]="from",e[e.to=1]="to",e[e.via=2]="via"}(t||(t={}));const r=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(const i of this.rules){if(i.ruleType===E.D2.RTAttachment){this.rulesCategorized.attachment.push(i);continue}if(i.ruleType===E.D2.RTContainment){this.rulesCategorized.containment.push(i);continue}if(i.ruleType===E.D2.RTJunctionJunctionConnectivity){this.rulesCategorized.connectivity.push(i);continue}this.rulesCategorized.connectivity.push(i);let o=[[t.from,t.to],[t.to,t.from]];i.ruleType===E.D2.RTEdgeJunctionEdgeConnectivity&&(o=[[t.from,t.via],[t.via,t.from],[t.to,t.via],[t.via,t.to]]);for(const s of o){const o=s.shift(),n=s.shift();let a=!1;switch(i.ruleType){case E.D2.RTEdgeJunctionEdgeConnectivity:a=o===t.from||o===t.to;break;case E.D2.RTJunctionEdgeConnectivity:a=o===t.to}const l=r[o],u=i[l.networkSourceId]?.layerId.toString()??"",d=i[l.assetGroupId]?.assetGroupCode?.toString(),p=i[l.assetTypeId],c=p?.assetTypeCode?.toString(),y=r[n],h=i[y.networkSourceId]?.layerId.toString()??"",m=i[y.assetGroupId]?.assetGroupCode?.toString(),g=i[y.assetTypeId],f=g?.assetTypeCode?.toString(),w=e[u]??{assetGroupHash:{}};if(!(d&&c&&m&&f))continue;const v=w.assetGroupHash[d]??{assetTypeHash:{}},_=v.assetTypeHash[c]??{};if(_[h]=_[h]??{},a){_[u]=_[u]??{};const e=`(assetgroup = ${d} AND assettype = ${c})`;"esriNECPEndVertex"===g?.connectivityPolicy?_[u].endVertex=_[u]?.endVertex?`${_[u].endVertex}`:`${e}`:_[u].anyVertex=_[u].anyVertex?`${_[u].anyVertex}`:`${e}`}const b=`(assetgroup = ${m} AND assettype = ${f})`;"esriNECPEndVertex"===g?.connectivityPolicy?_[h].endVertex=_[h]?.endVertex?`${_[h].endVertex} OR ${b}`:`${b}`:_[h].anyVertex=_[h]?.anyVertex?`${_[h].anyVertex} OR ${b}`:`${b}`,v.assetTypeHash[c]=_,w.assetGroupHash[d]=v,e[u]=w}}this._set("rulesHash",e)}_getRuleFieldValuesForAssociation(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"from";switch(t){case"attachment":case"containment":return"from"===r?[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode}]:[{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode}];case"connectivity":case"junction-junction-connectivity":return[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode},{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode}];case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return e.ruleType===E.D2.RTEdgeJunctionEdgeConnectivity?[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.viaAssetType?.assetTypeCode},{ruleLayerIdForSource:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.viaAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode},{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.viaAssetType?.assetTypeCode},{ruleLayerIdForSource:e.viaNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.viaAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.viaAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode}]:[{ruleLayerIdForSource:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.fromAssetType?.assetTypeCode,ruleLayerIdForTarget:e.toNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.toAssetType?.assetTypeCode},{ruleLayerIdForSource:e.toNetworkSource?.layerId,ruleAssetGroupCodeForSource:e.toAssetGroup?.assetGroupCode,ruleAssetTypeCodeForSource:e.toAssetType?.assetTypeCode,ruleLayerIdForTarget:e.fromNetworkSource?.layerId,ruleAssetGroupCodeForTarget:e.fromAssetGroup?.assetGroupCode,ruleAssetTypeCodeForTarget:e.fromAssetType?.assetTypeCode}];default:return[]}}_getWhereClauseForCompatibleFeatures(e,t,r){const i=new Map,[o,s]=this._getAssetFieldNames(e.sourceLayer),[n,a]=this._getFeatureAssetCodes(e),l=this._getFeatureSourceLayerId(e),u=(0,k.Sv)(t)?t.parent:t,d=(0,k.Sv)(t)?t.subtypeCode:null;r.forEach((e=>{const{type:t,direction:r}=e;this._getRulesForAssociationType(t).forEach((e=>{this._getRuleFieldValuesForAssociation(e,t,r).forEach((e=>{if(null!=e.ruleAssetGroupCodeForTarget&&null!=e.ruleAssetTypeCodeForTarget&&l===e?.ruleLayerIdForSource&&n===e?.ruleAssetGroupCodeForSource&&a===e?.ruleAssetTypeCodeForSource&&u.layerId===e?.ruleLayerIdForTarget&&(null==d||d===e?.ruleAssetGroupCodeForTarget)){const t=i.get(e.ruleAssetGroupCodeForTarget)??new Set;t.add(e.ruleAssetTypeCodeForTarget),i.set(e.ruleAssetGroupCodeForTarget,t)}}))}))}));let p=[];return this._mergeAssetCodes(i).forEach(((e,t)=>p.push(`${o} IN (${t}) AND ${s} IN (${Array.from(e).sort().join(", ")})`))),p.length>1&&(p=p.map((e=>`(${e})`))),p.join(" OR ")}_getRulesForAssociationType(e){const{rulesCategorized:t}=this;switch(e){case"attachment":return t.attachment;case"containment":return t.containment;case"connectivity":case"junction-junction-connectivity":return t.connectivity.filter((e=>e.ruleType===E.D2.RTJunctionJunctionConnectivity));case"junction-edge-from-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-to-connectivity":return t.connectivity.filter((e=>e.ruleType===E.D2.RTJunctionEdgeConnectivity||e.ruleType===E.D2.RTEdgeJunctionEdgeConnectivity));default:return[]}}_getFeatureSourceLayerId(e){const{sourceLayer:t}=e;let r;return(0,k.yZ)(t)?r=t.layerId:(0,k.Sv)(t)&&(r=t.parent?.layerId),r??null}_getAssetFieldNames(e){return e&&"fieldsIndex"in e?[e.fieldsIndex.normalizeFieldName("assetGroup")??null,e.fieldsIndex.normalizeFieldName("assetType")??null]:[null,null]}_getFeatureAssetCodes(e){const[t,r]=this._getAssetFieldNames(e.sourceLayer);return[t?e.attributes[t]:null,r?e.attributes[r]:null]}_areSetsEqual(e,t){if(e.size!==t.size)return!1;for(const r of e)if(!t.has(r))return!1;return!0}_mergeAssetCodes(e){const t=new Map,r=new Set;for(const[i,o]of e){const s=new Set([i]);for(const[t,a]of e)i!==t&&!r.has(t)&&this._areSetsEqual(o,a)&&(s.add(t),r.add(t));const n=Array.from(s).sort().join(", ");t.set(n,o)}return t}};(0,i._)([(0,s.MZ)({constructOnly:!0})],L.prototype,"rulesLayer",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],L.prototype,"rules",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],L.prototype,"rulesHash",void 0),(0,i._)([(0,s.MZ)()],L.prototype,"rulesCategorized",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],L.prototype,"request",void 0),L=(0,i._)([(0,a.$)("esri.networks.RulesTable")],L);const O=L;var V=r(99666),U=r(28009),G=r(91967);let z=class extends G.A{constructor(e){super(e),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTable=null,this.associationsTableId=null,this.associationsTableUrl=null}destroy(){this.associationsTable?.destroy()}async loadAssociationsTable(){if(!this.associationsTable){const{associationsTableUrl:e}=this;if(!e)throw new p.A("utility-network-system-layers:missing-associations-table-url","Unable to load the associations table, as the `associationsTableUrl` is not set.");this.associationsTable=new l.default({url:e})}return await this.associationsTable.load(),this.associationsTable}};(0,i._)([(0,s.MZ)({constructOnly:!0})],z.prototype,"rulesTableId",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],z.prototype,"rulesTableUrl",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],z.prototype,"subnetworksTableId",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],z.prototype,"subnetworksTableUrl",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],z.prototype,"dirtyAreasLayerId",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],z.prototype,"dirtyAreasLayerUrl",void 0),(0,i._)([(0,s.MZ)()],z.prototype,"associationsTable",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],z.prototype,"associationsTableId",void 0),(0,i._)([(0,s.MZ)({constructOnly:!0})],z.prototype,"associationsTableUrl",void 0),z=(0,i._)([(0,a.$)("esri.networks.support.NetworkSystemLayers")],z);const $=z;let P=class extends R.A{constructor(e){super(e),this.id=null,this.name=null}};(0,i._)([(0,s.MZ)({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],P.prototype,"id",void 0),(0,i._)([(0,s.MZ)({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],P.prototype,"name",void 0),(0,i._)([(0,s.MZ)({type:Boolean,json:{write:!0}})],P.prototype,"isUpstreamTerminal",void 0),P=(0,i._)([(0,a.$)("esri.networks.support.Terminal")],P);const J=P,B=new b.J({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let D=class extends R.A{constructor(e){super(e),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],D.prototype,"defaultConfiguration",void 0),(0,i._)([(0,s.MZ)({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],D.prototype,"id",void 0),(0,i._)([(0,s.MZ)({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],D.prototype,"name",void 0),(0,i._)([(0,s.MZ)({type:[J],json:{write:!0}})],D.prototype,"terminals",void 0),(0,i._)([(0,s.MZ)({type:B.apiValues,json:{type:B.jsonValues,read:B.read,write:B.write}})],D.prototype,"traversabilityModel",void 0),D=(0,i._)([(0,a.$)("esri.networks.support.TerminalConfiguration")],D);const q=D;var W=r(57778);const H=(0,b.O)()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let K=class extends W.A{constructor(e){super(e),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const t={...e,query:{f:"json"}},{data:r}=await(0,d.A)(this.statusUrl,t),i=r.traceResults?{...r.traceResults,...r}:r;return this.read(i),this}async waitForJobCompletion(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{interval:t=1e3,statusCallback:r}=e;return new Promise(((e,i)=>{this._clearTimer();const o=setInterval((()=>{this._timer||i((0,h.NK)()),this.checkJobStatus().then((t=>{const{status:i}=t;switch(this.status=i,i){case"job-succeeded":this._clearTimer(),e(this);break;case"job-waiting":case"job-executing":r&&r(this)}}),(e=>{this._clearTimer(),i(e)}))}),t);this._timer=o}))}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};(0,i._)([(0,s.MZ)({type:String,json:{write:!0}})],K.prototype,"statusUrl",void 0),(0,i._)([(0,S.e)(H)],K.prototype,"status",void 0),(0,i._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],K.prototype,"submissionTime",void 0),(0,i._)([(0,s.MZ)({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],K.prototype,"lastUpdatedTime",void 0),K=(0,i._)([(0,a.$)("esri.networks.support.TraceJobInfo")],K);const Y=K;var X=r(97015);let Q=class extends x{constructor(e){super(e),this.sharedNamedTraceConfigurations=[],this.type="utility",this._terminalById=new Map}get serviceTerritoryFeatureLayerId(){return this.dataElement?.serviceTerritoryFeatureLayerId??null}get networkSystemLayers(){return new $({rulesTableId:this.sourceJSON?.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.rulesTableId}`:null,subnetworksTableId:this.sourceJSON?.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:this.sourceJSON?.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:this.sourceJSON?.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${this.sourceJSON?.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){return this.dataElement?.terminalConfigurations.map((e=>q.fromJSON(e)))||[]}get domainNetworkNames(){return this.dataElement?.domainNetworks.map((e=>e.domainNetworkName))||[]}get _utilityLayerList(){const e=new Set;return this.dataElement?.domainNetworks?.map((t=>{t?.edgeSources?.map((t=>{let{layerId:r,sourceId:i}=t;this._layerIdBySourceId.set(i,r),this._sourceIdByLayerId.set(r,i),e.add(r)})),t?.junctionSources?.map((t=>{let{layerId:r,sourceId:i}=t;this._layerIdBySourceId.set(i,r),this._sourceIdByLayerId.set(r,i),e.add(r)}))})),e}async load(e){return this.addResolvingPromise(super.load(e)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(e)),this}getTerminalConfiguration(e){let t=null,r=null;const i=e.layer;let o=null;if("feature"===i?.type){if(o=i.layerId,null===o)return null}else{if("subtype-sublayer"!==i?.type)return null;if(o=i?.parent?.layerId??null,null===o)return null}const s=e.attributes;if(null==s)return null;for(const l of Object.keys(s))"ASSETGROUP"===l.toUpperCase()&&(t=e.getAttribute(l)),"ASSETTYPE"===l.toUpperCase()&&(r=e.getAttribute(l));if(!this.dataElement)return null;let n=null;const a=this.dataElement.domainNetworks;for(const l of a){const e=l.junctionSources?.find((e=>e.layerId===o));if(e){const i=e.assetGroups?.find((e=>e.assetGroupCode===t));if(i){const e=i.assetTypes?.find((e=>e.assetTypeCode===r));if(e?.isTerminalConfigurationSupported){n=e.terminalConfigurationId;break}}}}if(null!=n){const e=this.dataElement.terminalConfigurations,t=e?.find((e=>e.terminalConfigurationId===n));return t?q.fromJSON(t):null}return null}getTierNames(e){const t=this.dataElement?.domainNetworks.find((t=>t.domainNetworkName===e));return t?.tiers.map((e=>e.name))||[]}async getRulesTable(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),await this._sharedRulesTable}getTerminalById(e){if(!this.dataElement||null==e)return null;const t=this._terminalById.get(e);return null!=t?t:(this.terminalConfigurations.forEach((e=>{e.terminals.forEach((e=>{this._terminalById.set(e.id,e)}))})),this._terminalById.get(e))}isUtilityLayer(e){return"layerId"in e?this._utilityLayerList.has(e?.layerId)&&(e.url?.startsWith(this.featureServiceUrl)??!1):!("subtype-sublayer"!==e.type||!e.parent)&&this._utilityLayerList.has(e.parent.layerId)&&(e.parent.url?.startsWith(this.featureServiceUrl)??!1)}async queryAssociations(e,t){const[{queryAssociations:i},{default:o}]=await Promise.all([r.e(34176).then(r.bind(r,34176)),r.e(2623).then(r.bind(r,2623))]),s=o.from(e);return s.gdbVersion=this.gdbVersion,s.moment=this.historicMoment,(await i(this.networkServiceUrl,s,t)).associations}async synthesizeAssociationGeometries(e){const[{synthesizeAssociationGeometries:t},{default:i}]=await Promise.all([r.e(70440).then(r.bind(r,70440)),r.e(75624).then(r.bind(r,75624))]),o=i.from(e);return o.gdbVersion=this.gdbVersion,o.moment=this.historicMoment,t(this.networkServiceUrl,o)}async trace(e){const[{trace:t},{default:i}]=await Promise.all([r.e(40998).then(r.bind(r,40998)),r.e(54515).then(r.bind(r,54515))]),o=i.from(e);return o.gdbVersion=this.gdbVersion,o.moment=this.historicMoment,t(this.networkServiceUrl,o)}async submitTraceJob(e){const[{submitTraceJob:t},{default:i}]=await Promise.all([r.e(40998).then(r.bind(r,40998)),r.e(54515).then(r.bind(r,54515))]),o=i.from(e);o.gdbVersion=this.gdbVersion,o.moment=this.historicMoment;const s=await t(this.networkServiceUrl,o);return new Y({statusUrl:s})}async canAddAssociation(e){const t=await this.getRulesTable();if(!t)return!1;await t.load();const r=e=>({fromRuleElement:{networkSource:e.fromNetworkSource,assetGroup:e.fromAssetGroup,assetType:e.fromAssetType,terminal:e.fromTerminal},viaRuleElement:e.viaNetworkSource?{networkSource:e.viaNetworkSource,assetGroup:e.viaAssetGroup,assetType:e.viaAssetType,terminal:e.viaTerminal}:void 0,toRuleElement:{networkSource:e.toNetworkSource,assetGroup:e.toAssetGroup,assetType:e.toAssetType,terminal:e.toTerminal}}),i=function(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e.networkSource?.sourceId===t.networkSourceId&&e.assetGroup?.assetGroupCode===t.assetGroupCode&&e.assetType?.assetTypeCode===t.assetTypeCode&&(!r||((e,t)=>e?1===e.terminalId?!t?.terminalId||t?.terminalId===e.terminalId:e.terminalId===t?.terminalId:!t?.terminalId)(e.terminal,t))},o=(e,t)=>{const{fromRuleElement:o,toRuleElement:s}=r(e);return i(o,t.fromNetworkElement,!1)&&i(s,t.toNetworkElement,!1)};return"containment"===e.associationType?t.rulesCategorized.containment.some((t=>o(t,e))):"attachment"===e.associationType?t.rulesCategorized.attachment.some((t=>o(t,e))):t.rulesCategorized.connectivity.some((t=>t.ruleType===E.D2.RTEdgeJunctionEdgeConnectivity?((e,t)=>{const{fromRuleElement:o,toRuleElement:s,viaRuleElement:n}=r(e);return i(o,t.fromNetworkElement)&&i(n,t.toNetworkElement)||i(o,t.toNetworkElement)&&i(n,t.fromNetworkElement)||i(n,t.fromNetworkElement)&&i(s,t.toNetworkElement)||i(n,t.toNetworkElement)&&i(s,t.fromNetworkElement)})(t,e):((e,t)=>{const{fromRuleElement:o,toRuleElement:s}=r(e);return i(o,t.fromNetworkElement)&&i(s,t.toNetworkElement)||i(o,t.toNetworkElement)&&i(s,t.fromNetworkElement)})(t,e)))}generateAddAssociations(e){const{associationsTable:t}=this.networkSystemLayers,{fromNetworkSourceId:r,fromGlobalId:i,fromTerminalId:s,toNetworkSourceId:n,toGlobalId:a,toTerminalId:l,associationType:u,isContentVisible:d,percentAlong:p,globalId:c}=(0,U.E)(t);return{addFeatures:e.map((e=>new o.A({attributes:{[r]:e.fromNetworkElement?.networkSourceId,[i]:e.fromNetworkElement?.globalId,[s]:e.fromNetworkElement?.terminalId,[n]:e.toNetworkElement?.networkSourceId,[a]:e.toNetworkElement?.globalId,[l]:e.toNetworkElement?.terminalId,[u]:E.v9[e.associationType],[d]:null==e.isContentVisible?void 0:e.isContentVisible?1:0,[p]:e.percentAlong,[c]:e.globalId}}))),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:t?.globalIdField??"globalid",objectIdField:t?.objectIdField??"objectid"}}}generateDeleteAssociations(e){const{associationsTable:t,associationsTableId:r}=this.networkSystemLayers;return{deleteFeatures:e.map((e=>({globalId:e.globalId}))),id:r,identifierFields:{globalIdField:t?.globalIdField??"globalid",objectIdField:t?.objectIdField??"objectid"}}}async loadAssociationsTable(){return this.networkSystemLayers.loadAssociationsTable()}async _loadNamedTraceConfigurationsFromNetwork(e){if(0===this.sharedNamedTraceConfigurations?.length)return;const t=this.sharedNamedTraceConfigurations.map((e=>e.globalId)),r=await this.queryNamedTraceConfigurations({globalIds:t},e);for(const i of this.sharedNamedTraceConfigurations){const e=r?.find((e=>e.globalId===i.globalId));if(e){const t=e.write({},{origin:"service"});i.read(t,{origin:"service"})}}}async _createRulesTable(){const e=this.networkSystemLayers.rulesTableUrl,t=new l.default({url:e});await t.load();const r=this.dataElement?.domainNetworks;if(!r)return null;const i=r.flatMap((e=>[...e.edgeSources||[],...e.junctionSources||[]])),o=(await async function(e){const t=new X.A({where:"1=1",outFields:["*"]});return(await(0,u.SE)(e,t)).features}(t)).map((e=>this._hydrateRuleInfo(t,i,e)));return new O({rulesLayer:t,rules:o})}_hydrateRuleInfo(e,t,r){const i=e.fieldsIndex,o=i.get("RULETYPE"),s=i.get("CREATIONDATE"),n=i.get("FROMNETWORKSOURCEID"),a=i.get("FROMASSETGROUP"),l=i.get("FROMASSETTYPE"),u=i.get("FROMTERMINALID"),d=i.get("TONETWORKSOURCEID"),p=i.get("TOASSETGROUP"),c=i.get("TOASSETTYPE"),y=i.get("TOTERMINALID"),h=i.get("VIANETWORKSOURCEID"),m=i.get("VIAASSETGROUP"),g=i.get("VIAASSETTYPE"),f=i.get("VIATERMINALID"),w=r.attributes[o.name],v=new Date(r.attributes[s.name]),_=[{networkSourceId:r.attributes[n.name],assetGroupId:r.attributes[a.name],assetTypeId:r.attributes[l.name],terminalId:r.attributes[u.name]},{networkSourceId:r.attributes[d.name],assetGroupId:r.attributes[p.name],assetTypeId:r.attributes[c.name],terminalId:r.attributes[y.name]},{networkSourceId:r.attributes[h.name],assetGroupId:r.attributes[m.name],assetTypeId:r.attributes[g.name],terminalId:r.attributes[f.name]}];let b;!function(e){e[e.from=0]="from",e[e.to=1]="to",e[e.via=2]="via"}(b||(b={}));const S={ruleType:w,creationDate:v};for(const A of[b.from,b.to,b.via]){if(w!==E.D2.RTEdgeJunctionEdgeConnectivity&&A===b.via)continue;const e=_[A],r=t.find((t=>t.sourceId===e.networkSourceId)),i=r?.assetGroups.find((t=>t.assetGroupCode===e.assetGroupId)),o=i?.assetTypes.find((t=>t.assetTypeCode===e.assetTypeId)),s=this._getTerminal(o,e);let n="";switch(A){case b.from:n="from";break;case b.to:n="to";break;case b.via:n="via"}S[`${n}NetworkSource`]=r,S[`${n}AssetGroup`]=i,S[`${n}AssetType`]=o,S[`${n}Terminal`]=s?.toJSON()}return S}_getTerminal(e,t){const r=e?.terminalConfigurationId,i=this.terminalConfigurations?.find((e=>e.id===r));return i?.terminals?.find((e=>e.id===t.terminalId))??null}};(0,i._)([(0,s.MZ)({type:[V.A],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],Q.prototype,"sharedNamedTraceConfigurations",void 0),(0,i._)([(0,s.MZ)({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],Q.prototype,"type",void 0),(0,i._)([(0,s.MZ)({readOnly:!0})],Q.prototype,"serviceTerritoryFeatureLayerId",null),(0,i._)([(0,s.MZ)({readOnly:!0})],Q.prototype,"networkSystemLayers",null),(0,i._)([(0,s.MZ)({readOnly:!0})],Q.prototype,"terminalConfigurations",null),(0,i._)([(0,s.MZ)({readOnly:!0})],Q.prototype,"domainNetworkNames",null),Q=(0,i._)([(0,a.$)("esri.networks.UtilityNetwork")],Q);const ee=Q},84202:(e,t,r)=>{r.d(t,{A7:()=>u,Cx:()=>d,Hk:()=>p,JJ:()=>m,SF:()=>c,UK:()=>l,jM:()=>y,x3:()=>h});r(81806);var i=r(86875),o=r(7246),s=r(76940),n=r(86659),a=r(44460);const l=s.A.fromJSON(a.Cb),u=o.A.fromJSON(a.yM),d=i.A.fromJSON(a.WR),p=n.A.fromJSON(a.JZ);function c(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return l;case"polyline":return u;case"polygon":case"extent":return d}return null}const y=s.A.fromJSON(a.nC),h=o.A.fromJSON(a.HW),m=i.A.fromJSON(a.b6)},92115:(e,t,r)=>{r.d(t,{H:()=>l});var i,o=r(35143),s=r(42553),n=r(46053),a=(r(81806),r(76460),r(47249),r(85842));let l=i=class extends s.A{constructor(e){super(e),this.name=null,this.code=null}clone(){return new i({name:this.name,code:this.code})}};(0,o._)([(0,n.MZ)({type:String,json:{write:{isRequired:!0}}})],l.prototype,"name",void 0),(0,o._)([(0,n.MZ)({type:[String,Number],json:{write:{isRequired:!0}}})],l.prototype,"code",void 0),l=i=(0,o._)([(0,a.$)("esri.layers.support.CodedValue")],l)},99666:(e,t,r)=>{r.d(t,{A:()=>c});var i=r(35143),o=r(77717),s=r(46053),n=(r(81806),r(76460),r(47249),r(28379)),a=r(85842),l=r(79685),u=r(12899),d=r(64154);let p=class extends o.L{constructor(e){super(e),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(e,t){return void 0!==e.tierName?d.A.fromJSON(e):l.A.fromJSON(e)}};(0,i._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],p.prototype,"globalId",void 0),(0,i._)([(0,s.MZ)({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],p.prototype,"title",void 0),(0,i._)([(0,s.MZ)({type:l.A,json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"traceConfiguration",void 0),(0,i._)([(0,n.w)("service","traceConfiguration")],p.prototype,"readTraceConfiguration",null),(0,i._)([(0,s.MZ)({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"creationDate",void 0),(0,i._)([(0,s.MZ)({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"creator",void 0),(0,i._)([(0,s.MZ)({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"description",void 0),(0,i._)([(0,s.MZ)({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],p.prototype,"minStartingPoints",void 0),(0,i._)([(0,s.MZ)({json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"resultTypes",void 0),(0,i._)([(0,s.MZ)({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],p.prototype,"tags",void 0),(0,i._)([(0,s.MZ)({type:u.fO.apiValues,json:{type:u.fO.jsonValues,origins:{service:{read:u.fO.read,write:u.fO.write}},read:!1}})],p.prototype,"traceType",void 0),p=(0,i._)([(0,a.$)("esri.networks.support.NamedTraceConfiguration")],p);const c=p}}]);
//# sourceMappingURL=8465.a285b1d6.chunk.js.map