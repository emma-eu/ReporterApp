"use strict";(self.webpackChunkfeedback_map=self.webpackChunkfeedback_map||[]).push([[77567],{18153:(e,t,i)=>{i.d(t,{$:()=>h,p:()=>c});var s=i(23862),n=i(80794),r=i(9876),o=i(72317);function a(e){let{x:t,y:i,z:n}=e;return(0,s.fA)(t,i,n??0)}function h(e,t){switch(e.type){case"edge":return e.draped?new n.X({edgeStart:a(e.start),edgeEnd:a(e.end),targetPoint:(0,s.de)(a(e.target)),objectId:e.objectId,getGroundElevation:t}):new r.z({edgeStart:a(e.start),edgeEnd:a(e.end),targetPoint:(0,s.de)(a(e.target)),objectId:e.objectId,isDraped:!1});case"vertex":return new o.C({targetPoint:(0,s.de)(a(e.target)),objectId:e.objectId,isDraped:!1})}}function c(e,t){return null!=e&&"3d"===e.type?(i,s)=>e.elevationProvider.getElevation(i,s,0,t,"ground"):()=>null}},23241:(e,t,i)=>{i.d(t,{_:()=>r});var s=i(20664),n=i(64753);class r extends n.m{constructor(e,t,i){super(t,i),this.point=e}equals(e){return e instanceof r&&(0,s.p)(this.point,e.point)}}},35961:(e,t,i)=>{i.d(t,{n:()=>h});i(81806);var s=i(53521),n=i(87663),r=i(50346),o=i(31633),a=i(59097);function h(){let e=arguments.length>1?arguments[1]:void 0;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]){const{elevationInfo:t,alignPointsInFeatures:i}=e;return new l(t,i)}return new c}class c{async alignCandidates(e,t,i){return e}notifyElevationSourceChange(){}}class l{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new s.q(1024),this._cacheVersion=0}async alignCandidates(e,t,i){const s=this._elevationInfo;return null==s||"absolute-height"!==s.mode||s.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,i):(function(e,t,i){const{offset:s,unit:n}=i;if(null==s)return;const r=(0,o.G9)(t),h=s*((0,a.Ao)(n??"meters")/r);for(const o of e)switch(o.type){case"edge":o.start.z+=h,o.end.z+=h;continue;case"vertex":o.target.z+=h;continue}}(e,t,s),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,t,i){const s=new Map;for(const r of e)(0,n.tE)(s,r.objectId,p).push(r);const[o,a,h]=this._prepareQuery(s,t),c=await this._alignPointsInFeatures(o,i);if((0,r.Te)(i),h!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,i);this._applyCacheAndResponse(o,c,a);const{drapedObjectIds:l,failedObjectIds:u}=c,d=[];for(const n of e){const{objectId:e}=n;l.has(e)&&"edge"===n.type&&(n.draped=!0),u.has(e)||d.push(n)}return d}_prepareQuery(e,t){const i=[],s=[];for(const[n,r]of e){const e=[];for(const t of r)this._addToQueriesOrCachedResult(n,t.target,e,s),"edge"===t.type&&(this._addToQueriesOrCachedResult(n,t.start,e,s),this._addToQueriesOrCachedResult(n,t.end,e,s));0!==e.length&&i.push({objectId:n,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:i},s,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,i,s){const n=d(e,t),r=this._alignmentsCache.get(n);null==r?i.push(t):s.push(new u(t,r))}_applyCacheAndResponse(e,t,i){let{elevations:s,drapedObjectIds:n,failedObjectIds:r}=t;for(const h of i)h.apply();let o=0;const a=this._alignmentsCache;for(const{objectId:h,points:c}of e.pointsInFeatures){if(r.has(h)){o+=c.length;continue}const e=!n.has(h);for(const t of c){const i=d(h,t),n=s[o++];t.z=n,e&&a.put(i,n,1)}}}}class u{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function d(e,t){let{x:i,y:s,z:n,spatialReference:r}=t;return`${e}-${i}-${s}-${n??0}}-wkid:${r?.wkid}`}function p(){return[]}},53521:(e,t,i)=>{i.d(t,{q:()=>n});var s=i(79369);class n{constructor(e,t){this._storage=new s.F,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),t&&this._storage.registerRemoveFunc("",t)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._storage.put(this,e,t,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},56002:(e,t,i)=>{function s(e){let t,i,s=[],n=!1;return function(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return n&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(o,s)||(i=e.apply(this,o),t=this,s=o,n=!0),i}}i.d(t,{B:()=>s})},69963:(e,t,i)=>{i.d(t,{H:()=>a});i(81806);var s=i(53084),n=i(53521),r=i(50346),o=i(88685);function a(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new c(arguments.length>1?arguments[1]:void 0):new h}class h{async fetch(){return[]}notifySymbologyChange(){}}class c{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new n.q(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const i=[],n=[],o=this._candidatesCache;for(const r of e){const e=l(r),t=o.get(e);if(t)for(const i of t)n.push((0,s.o8)(i));else i.push(r),o.put(e,[],1)}if(0===i.length)return n;const a=this._cacheVersion,{candidates:h,sourceCandidateIndices:c}=await this._getSymbologyCandidates(i,t);if((0,r.Te)(t),a!==this._cacheVersion)return this.fetch(e,t);const u=[],{length:d}=h;for(let r=0;r<d;++r){const e=h[r],t=l(i[c[r]]),n=o.get(t);n.push(e),o.put(t,n,n.length),u.push((0,s.o8)(e))}return n.concat(u)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function l(e){switch(e.type){case"vertex":{const{objectId:t,target:i}=e,s=`${t}-vertex-${i.x}-${i.y}-${i.z??0}`;return(0,o.Wm)(s).toString()}case"edge":{const{objectId:t,start:i,end:s}=e,n=`${t}-edge-${i.x}-${i.y}-${i.z??0}-to-${s.x}-${s.y}-${s.z??0}`;return(0,o.Wm)(n).toString()}default:return""}}},72317:(e,t,i)=>{i.d(t,{C:()=>o});var s=i(75543),n=i(61751),r=i(23241);class o extends n.w{constructor(e){super({...e,constraint:new s.i7(e.targetPoint)})}get hints(){return[new r._(this.targetPoint,this.isDraped,this.domain)]}}},74964:(e,t,i)=>{i.d(t,{z:()=>o});i(81806);class s{filter(e,t){return t}notifyElevationSourceChange(){}}class n{filter(e,t){const{point:i,distance:s}=e,{z:n}=i;if(null==n)return t;if(0===t.length)return t;const o=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(s),a=this._updateCandidatesTo3D(t,i,o).filter(r);return a.sort(c),a}_updateCandidatesTo3D(e,t,i){for(const s of e)switch(s.type){case"edge":a(s,t,i);continue;case"vertex":h(s,t,i);continue}return e}}function r(e){return e.distance<=1}function o(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?new n:new s}function a(e,t,i){let{x:s,y:n,z:r}=i;const{start:o,end:a,target:h}=e;e.draped||function(e,t,i,s){const n=s.x-i.x,r=s.y-i.y,o=s.z-i.z,a=n*n+r*r+o*o,h=(t.x-i.x)*n+(t.y-i.y)*r+o*(t.z-i.z),c=Math.min(1,Math.max(0,h/a)),l=i.x+n*c,u=i.y+r*c,d=i.z+o*c;e.x=l,e.y=u,e.z=d}(h,t,o,a);const c=(t.x-h.x)/s,l=(t.y-h.y)/n,u=(t.z-h.z)/r;e.distance=Math.sqrt(c*c+l*l+u*u)}function h(e,t,i){let{x:s,y:n,z:r}=i;const{target:o}=e,a=(t.x-o.x)/s,h=(t.y-o.y)/n,c=(t.z-o.z)/r,l=Math.sqrt(a*a+h*h+c*c);e.distance=l}function c(e,t){return e.distance-t.distance}},77567:(e,t,i)=>{i.r(t),i.d(t,{FeatureCollectionSnappingSource:()=>f});var s=i(35143),n=i(91967),r=i(56002),o=i(50346),a=i(68134),h=i(34154),c=i(46053),l=(i(81806),i(76460),i(47249),i(85842)),u=i(12482),d=i(70330),p=i(18153),_=i(35961),g=i(74964),y=i(69963);let f=class extends n.A{get availability(){return 1}get _snappingElevationAligner(){const{view:e}=this,{layer:t}=this.layerSource,i=null!=e&&"3d"===e.type;if(!i||"subtype-group"===t.type)return(0,_.n)();return(0,_.n)(i,{elevationInfo:t.elevationInfo,alignPointsInFeatures:async(i,s)=>(await(0,o.qr)(e.whenLayerView(t),s)).elevationAlignPointsInFeatures(i,s)})}get _snappingElevationFilter(){const{view:e}=this,t=null!=e&&"3d"===e.type&&"subtype-group"!==this.layerSource.layer.type;return(0,g.z)(t)}get _symbologySnappingFetcher(){const{view:e}=this,{layer:t}=this.layerSource;return null!=e&&"3d"===e.type&&"subtype-group"!==t.type?(0,y.H)(this._symbologySnappingSupported,(async(i,s)=>{const n=await e.whenLayerView(t);return(0,o.Te)(s),n.queryForSymbologySnapping({candidates:i,spatialReference:e.spatialReference},s)})):(0,y.H)()}get _layerView(){const{view:e}=this;if(null==e)return null;const{layer:t}=this.layerSource;return e.allLayerViews.find((e=>e.layer===t))}get _layerView3D(){const{view:e}=this;return null==e||"2d"===e.type?null:this._layerView}get _symbologySnappingSupported(){return null!=this._layerView3D&&this._layerView3D.symbologySnappingSupported}initialize(){const{view:e}=this,{layer:t}=this.layerSource;null!=e&&"3d"===e.type&&"subtype-group"!==t.type&&this.addHandles([e.elevationProvider.on("elevation-change",(e=>{let{context:i}=e;const{elevationInfo:s}=t;(0,u.Up)(i,s)&&this._snappingElevationAligner.notifyElevationSourceChange()})),(0,a.wB)((()=>t.elevationInfo),(()=>this._snappingElevationAligner.notifyElevationSourceChange()),a.Vh),(0,a.wB)((()=>null!=this._layerView3D?this._layerView3D.layer?.renderer:null),(()=>this._symbologySnappingFetcher.notifySymbologyChange()),a.Vh),(0,a.on)((()=>this._layerView3D?.layer),["edits","apply-edits","graphic-update"],(()=>this._symbologySnappingFetcher.notifySymbologyChange()))])}constructor(e){super(e),this.view=null,this.updating=!1,this._memoizedMakeGetGroundElevation=(0,r.B)(p.p)}refresh(){}async fetchCandidates(e,t){const{layer:i}=this.layerSource,s=i.source;if(!s?.querySnapping)return[];const n=i.createQuery();this._layerView&&"effectiveDisplayFilter"in this._layerView&&(n.where=(0,h.mA)(n.where,this._layerView.effectiveDisplayFilter?.where));const r=(0,d.nf)(e,this.view?.type??"2d",n),a=await s.querySnapping(r,{signal:t});(0,o.Te)(t);const c=e.coordinateHelper.spatialReference,l=await this._snappingElevationAligner.alignCandidates(a.candidates,c,t);(0,o.Te)(t);const u=await this._symbologySnappingFetcher.fetch(l,t);(0,o.Te)(t);const _=0===u.length?l:[...l,...u],g=this._snappingElevationFilter.filter(r,_),y=this._memoizedMakeGetGroundElevation(this.view,c);return g.map((e=>(0,p.$)(e,y)))}};(0,s._)([(0,c.MZ)({constructOnly:!0})],f.prototype,"layerSource",void 0),(0,s._)([(0,c.MZ)({constructOnly:!0})],f.prototype,"view",void 0),(0,s._)([(0,c.MZ)()],f.prototype,"_snappingElevationAligner",null),(0,s._)([(0,c.MZ)()],f.prototype,"_snappingElevationFilter",null),(0,s._)([(0,c.MZ)()],f.prototype,"_symbologySnappingFetcher",null),(0,s._)([(0,c.MZ)()],f.prototype,"_layerView",null),(0,s._)([(0,c.MZ)()],f.prototype,"_layerView3D",null),(0,s._)([(0,c.MZ)()],f.prototype,"_symbologySnappingSupported",null),f=(0,s._)([(0,l.$)("esri.views.interactive.snapping.featureSources.FeatureCollectionSnappingSource")],f)},79369:(e,t,i)=>{i.d(t,{F:()=>h,Ti:()=>n});var s=i(30015);const n=-3,r=n-1;var o,a;(a=o||(o={}))[a.ALL=0]="ALL",a[a.SOME=1]="SOME";class h{get size(){return this._size}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10485760;this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new s.A,this._users=new s.A}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear()}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,t){this._removeFuncs.push([e,t])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace((t=>t[0]!==e))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const i=this._db.get(e.id+t);return i?.size??0}put(e,t,i,s,a){t=e.id+t;const h=this._db.get(t);if(h&&(this._size-=h.size,e.size-=h.size,this._db.delete(t),h.entry!==i&&this._notifyRemove(t,h.entry,h.size,o.ALL)),s>this._maxSize)return void this._notifyRemove(t,i,s,o.ALL);if(void 0===i)return void console.warn("Refusing to cache undefined entry ");if(!s||s<0)return console.warn(`Refusing to cache entry with size ${s} for key ${t}`),void this._notifyRemove(t,i,0,o.ALL);const l=1+Math.max(a,r)-n;this._db.set(t,new c(i,s,l)),this._size+=s,e.size+=s,this._checkSize()}updateSize(e,t,i,s){t=e.id+t;const n=this._db.get(t);if(n&&n.entry===i){for(this._size-=n.size,e.size-=n.size;s>this._maxSize;){const e=this._notifyRemove(t,i,s,o.SOME);if(!(null!=e&&e>0))return void this._db.delete(t);s=e}n.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,t){t=e.id+t;const i=this._db.get(t);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(t),++this._hit,i.entry;++this._miss}get(e,t){t=e.id+t;const i=this._db.get(t);if(void 0!==i)return this._db.delete(t),i.lives=i.lifetime,this._db.set(t,i),++this._hit,i.entry;++this._miss}peek(e,t){const i=this._db.get(e.id+t);return i?++this._hit:++this._miss,i?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},i=new Array;this._db.forEach(((e,s)=>{const n=e.lifetime;i[n]=(i[n]||0)+e.size,this._users.forAll((i=>{const{id:n,name:r}=i;if(s.startsWith(n)){const i=t[r]||0;t[r]=i+e.size}}))}));const s={};this._users.forAll((e=>{const i=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const n=t[i]||0;t[i]=n,s[i]=Math.round(100*e.hitRate)+"%"}else s[i]="0%"}));const r=Object.keys(t);r.sort(((e,i)=>t[i]-t[e])),r.forEach((i=>e[i]=Math.round(t[i]/2**20)+"MB / "+s[i]));for(let o=i.length-1;o>=0;--o){const t=i[o];t&&(e["Priority "+(o+n-1)]=Math.round(t/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll((e=>e.resetHitRate()))}clear(e){const t=e.id;this._db.forEach(((e,i)=>{i.startsWith(t)&&(this._size-=e.size,this._db.delete(i),this._notifyRemove(i,e.entry,e.size,o.ALL))})),e.size=0}clearAll(){this._db.forEach(((e,t)=>this._notifyRemove(t,e.entry,e.size,o.ALL))),this._users.forAll((e=>e.size=0)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,i,s){let n;return this._removeFuncs.some((r=>{if(e.startsWith(r[0])){const e=r[1](t,s,i);return"number"==typeof e&&(n=e),!0}return!1})),n}_checkSize(){this._users.forAll((e=>this._checkSizeLimits(e))),this._checkSizeLimits()}_checkSizeLimits(e){const t=e??this;if(t.maxSize<0||t.size<=t.maxSize)return;const i=e?.id;let s=!0;for(;s;){s=!1;for(const[n,r]of this._db)if(0===r.lifetime&&(!i||n.startsWith(i))){if(this._purgeItem(n,r,e),t.size<=.9*t.maxSize)return;s||=this._db.has(n)}}for(const[n,r]of this._db)if((!i||n.startsWith(i))&&(this._purgeItem(n,r,e),t.size<=.9*t.maxSize))return}_purgeItem(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._users.find((t=>e.startsWith(t.id)));if(this._db.delete(e),t.lives<=1){this._size-=t.size,i&&(i.size-=t.size);const s=this._notifyRemove(e,t.entry,t.size,o.SOME);null!=s&&s>0&&(this._size+=s,i&&(i.size+=s),t.lives=t.lifetime,t.size=s,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}class c{constructor(e,t,i){this.entry=e,this.size=t,this.lifetime=i,this.lives=i}}}}]);
//# sourceMappingURL=77567.9551ff7f.chunk.js.map