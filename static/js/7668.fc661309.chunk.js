"use strict";(self.webpackChunkfeedback_map=self.webpackChunkfeedback_map||[]).push([[7668],{1109:(t,e,i)=>{i.d(e,{N:()=>kt,l:()=>Zt});var o,n,r=i(35143),s=i(39356),a=i(91967),l=i(94643),c=i(68134),d=i(46053),p=(i(81806),i(76460),i(47249),i(85842)),h=i(19451);!function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"}(o||(o={})),function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"}(n||(n={}));const u={[n.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[n.UndoInvalidError]:"There are no items to Undo",[n.RedoInvalidError]:"There are no items to Redo",[n.ApplyInvalidError]:"Cannot apply an item that is already applied"};class y extends Error{constructor(){super(u[n.UndoRedoUpdating]),this.type="undo-redo-updating-error"}}class g extends Error{constructor(){super(u[n.UndoInvalidError]),this.type="undo-redo-undo-error"}}class m extends Error{constructor(){super(u[n.RedoInvalidError]),this.type="undo-redo-redo-error"}}class v extends Error{constructor(){super(u[n.ApplyInvalidError]),this.type="undo-redo-apply-error"}}var f;!function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"}(f||(f={}));let _=class extends a.A{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=o.NeverApplied}get canUndo(){return this.status===o.Applied}get canRedo(){return this.status===o.Undone}async executeUndoRedoOperation(t){switch(t){case f.Apply:if(this.status!==o.NeverApplied)throw new v;return await this.apply(),void(this.status=o.Applied);case f.Undo:if(this.status!==o.Applied)throw new g;return await this.undo(),void(this.status=o.Undone);case f.Redo:if(this.status!==o.Undone)throw new g;return await this.redo(),void(this.status=o.Applied)}}};(0,r._)([(0,d.MZ)()],_.prototype,"name",void 0),(0,r._)([(0,d.MZ)()],_.prototype,"tag",void 0),_=(0,r._)([(0,p.$)("esri.undoredo.UndoableOperation")],_);let w=class extends a.A{constructor(){super(...arguments),this._stack=new l.A,this._stackPosition=-1,this._updatingHandles=new h.U}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((t=>t.destroy()))}_drainStack(){this._stack.drain((t=>t.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new g;if(this.updating)throw new y;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(f.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new m;if(this.updating)throw new y;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new m;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(f.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new y;await this._updatingHandles.addPromise((async()=>{t.status===o.NeverApplied&&await t.executeUndoRedoOperation(f.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((t=>t.destroy())),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new y;await this._updatingHandles.addPromise((async()=>{t.status===o.NeverApplied&&await t.executeUndoRedoOperation(f.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.updating&&!e)return;await(0,c.C_)((()=>!this.updating));const i=new l.A;for(let o=0;o<this._stack.length;o++){const e=this._stack.getItemAt(o);e&&(e.tag===t?(e.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(e))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.updating&&!t)throw new y;await(0,c.C_)((()=>!this.updating)),this._drainStack()}};(0,r._)([(0,d.MZ)()],w.prototype,"_stack",void 0),(0,r._)([(0,d.MZ)()],w.prototype,"_stackPosition",void 0),(0,r._)([(0,d.MZ)()],w.prototype,"updating",null),(0,r._)([(0,d.MZ)({readOnly:!0})],w.prototype,"canUndo",null),(0,r._)([(0,d.MZ)({readOnly:!0})],w.prototype,"hasUndo",null),(0,r._)([(0,d.MZ)({readOnly:!0})],w.prototype,"canRedo",null),(0,r._)([(0,d.MZ)({readOnly:!0})],w.prototype,"hasRedo",null),w=(0,r._)([(0,p.$)("esri.UndoRedo")],w);var O=i(98773),k=i(54099),x=i(54901),M=i(30726),Z=i(58905),b=i(63733),T=i(74e3);class V{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}var U=i(48384),G=i(42151),A=i(24648),I=i(31633),R=i(12482);function C(t,e,i){if(null==t)return"noTool";switch(t){case"point":return"point";case"multipoint":return"multipoint";case"polyline":return function(t,e){const i=null!=t&&"polyline"===t.type&&t.paths.length?t.paths[0].length:0;return"freehand"===e?i<2?"freehandStart":"freehandEnd":i<2?"polylineZeroVertices":"polylineOneVertex"}(e,i);case"polygon":return function(t,e){const i=null!=t&&"polygon"===t.type&&t.rings.length?t.rings[0].length:0;if(i<3)switch(e){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(i<4)return"freehand"===e?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}(e,i);case"rectangle":case"circle":return function(t,e){if((null!=t&&"polygon"===t.type&&t.rings.length?t.rings[0].length:0)<3)switch(e){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(e){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}(e,i);default:return}}var P=i(20664),S=i(9392);const E=20,z=1,H=.1,F=(0,S.vt)();var L=i(48851),N=i(10535),D=i(37159);let $=class extends D.w{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=A.iT}get allFields(){return[]}};(0,r._)([(0,d.MZ)()],$.prototype,"type",void 0),(0,r._)([(0,d.MZ)()],$.prototype,"radius",void 0),(0,r._)([(0,d.MZ)()],$.prototype,"xSize",void 0),(0,r._)([(0,d.MZ)()],$.prototype,"ySize",void 0),(0,r._)([(0,d.MZ)()],$.prototype,"area",void 0),(0,r._)([(0,d.MZ)()],$.prototype,"helpMessage",void 0),(0,r._)([(0,d.MZ)()],$.prototype,"allFields",null),$=(0,r._)([(0,p.$)("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],$);var B=i(5512),Y=i(65240);let j=class extends((0,Y.B)(D.w)){constructor(t){super(t),this.type="draw-mesh",this.orientation=(0,B.LJ)({lockable:!1}),this.scale=(0,B.dy)({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};(0,r._)([(0,d.MZ)()],j.prototype,"helpMessage",void 0),(0,r._)([(0,d.MZ)()],j.prototype,"allFields",null),j=(0,r._)([(0,p.$)("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],j);let K=class extends((0,Y.B)(D.w)){constructor(t){super(t),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,r._)([(0,d.MZ)()],K.prototype,"helpMessage",void 0),(0,r._)([(0,d.MZ)()],K.prototype,"allFields",null),K=(0,r._)([(0,p.$)("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],K);let Q=class extends((0,Y.B)(D.w)){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,r._)([(0,d.MZ)()],Q.prototype,"helpMessage",void 0),(0,r._)([(0,d.MZ)()],Q.prototype,"allFields",null),Q=(0,r._)([(0,p.$)("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],Q);let q=class extends((0,Y.B)(D.w)){constructor(t){super(t),this.type="draw-polygon",this.direction=(0,B.Gk)(),this.distance=(0,B.Ku)(),this.area=(0,B.Am)(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};(0,r._)([(0,d.MZ)()],q.prototype,"xyMode",void 0),(0,r._)([(0,d.MZ)()],q.prototype,"helpMessage",void 0),(0,r._)([(0,d.MZ)()],q.prototype,"allFields",null),q=(0,r._)([(0,p.$)("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],q);let J=class extends((0,Y.B)(D.w)){constructor(t){super(t),this.type="draw-polyline",this.direction=(0,B.Gk)(),this.distance=(0,B.Ku)(),this.totalLength=(0,B.fr)(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};(0,r._)([(0,d.MZ)()],J.prototype,"helpMessage",void 0),(0,r._)([(0,d.MZ)()],J.prototype,"xyMode",void 0),(0,r._)([(0,d.MZ)()],J.prototype,"allFields",null),J=(0,r._)([(0,p.$)("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],J);let W=class extends D.w{constructor(t){super(t),this.type="draw-rectangle",this.xSize=A.r7,this.ySize=A.r7,this.area=A.iT}get allFields(){return[]}};(0,r._)([(0,d.MZ)()],W.prototype,"type",void 0),(0,r._)([(0,d.MZ)()],W.prototype,"xSize",void 0),(0,r._)([(0,d.MZ)()],W.prototype,"ySize",void 0),(0,r._)([(0,d.MZ)()],W.prototype,"area",void 0),(0,r._)([(0,d.MZ)()],W.prototype,"helpMessage",void 0),(0,r._)([(0,d.MZ)()],W.prototype,"allFields",null),W=(0,r._)([(0,p.$)("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],W);var X=i(89646),tt=i(50621),et=i(68655),it=i(29772);function ot(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:n}=t,r=e=>{const i=gt(t).mode,o=n[e].elevation;"relative-to-ground"===i||"relative-to-scene"===i||"on-the-ground"===i?o.lock(vt(t)):o.unlock()};switch(i){case"polygon":case"polyline":r(i),(t=>{if(e){const i=n[t].direction;i.committed=e.angle,i.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}})(i);break;case"point":case"mesh":r(i)}}function nt(t,e){const{drawOperation:i,view:o}=e,n=st(e),r=gt(e);if("2d"===o.type||!t||"absolute-height"!==r.mode||1!==i?.numCommittedVertices||!n||"draw-polyline"!==n.type&&"draw-polygon"!==n.type||n.elevation.locked)return;const[s,a,l]=t,c=function(t,e,i,o,n){const{view:r,drawOperation:s}=n;if("3d"!==r.type||!s)return;i??=0;const a=mt(n),l=gt(n),c=(0,R.Fo)(r,t,e,i,a,l,o);return(0,it.Qc)(c,a)??vt(n)}(s,a,l,r,e);null!=c&&n.elevation.lock(c)}function rt(t){st(t)?.allFields.forEach((t=>{t.unlockOnVertexPlacement&&t.unlock()}))}function st(t){let{geometryType:e,graphic:i,tooltipInfos:o}=t;return i?.geometry?.type!==at[e]?"circle"===e||"rectangle"===e?o[e]:null:o[e]}const at={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function lt(t,e){switch(t?.type){case"draw-point":!function(t,e){const i=e.graphic?.geometry;"point"===i?.type&&(ct(t,i,e),t.helpMessage=C("point",i,e.drawOperation.drawingMode))}(t,e);break;case"draw-multipoint":!function(t,e){const i=e.graphic?.geometry;"multipoint"===i?.type&&(ct(t,i,e),t.helpMessage=C("multipoint",i,e.drawOperation.drawingMode))}(t,e);break;case"draw-polyline":!function(t,e){const{createOperationGeometry:i,drawOperation:o}=e,n=null!=i?i.full:null;n&&"polyline"!==n.type||(dt(t,e),t.totalLength.actual=o.lastVertex?(n?(0,et.ob)(n):null)??A.r7:null,t.helpMessage=C("polyline",n,e.drawOperation.drawingMode))}(t,e);break;case"draw-polygon":!function(t,e){const{createOperationGeometry:i,drawOperation:o}=e,n=null!=i?i.full:null;n&&"polygon"!==n.type||(dt(t,e),t.area.actual=o.lastVertex?(n?(0,tt.n)(n):null)??A.iT:null,t.helpMessage=C("polygon",n,e.drawOperation.drawingMode))}(t,e);break;case"draw-rectangle":!function(t,e){t.sketchOptions=e.sketchOptions,t.xSize=ut(e),t.ySize=yt(e),t.area=ht(e),t.helpMessage=C("rectangle",e.graphic?.geometry,e.drawOperation.drawingMode)}(t,e);break;case"draw-circle":!function(t,e){const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?function(t){let{createOperationGeometry:e}=t;return(null!=e?.circle?.center&&null!=e.circle.edge?(0,et.Kt)(e.circle.center,e.circle.edge):null)??A.r7}(e):null,t.xSize=i?null:ut(e),t.ySize=i?null:yt(e),t.area=ht(e),t.helpMessage=C("circle",e.graphic?.geometry,e.drawOperation.drawingMode)}(t,e);break;case"draw-mesh":!function(t,e){const{graphic:i,view:o}=e,n=i?.geometry;"3d"!==o.type||n&&"mesh"!==n.type||(ct(t,n?.origin,e),n&&(0,N.Ue)(t,n),t.helpMessage=function(t,e){const i=t?.geometry;if(!t||"mesh"!==i?.type||!e)return;const{renderCoordsHelper:o,elevationProvider:n}=e,{camera:r}=e.state,{extent:s}=i,{center:a,spatialReference:l}=s,c=(0,I.GA)(l),d=(0,I.G9)(l),p=(0,I.GA)(o.spatialReference),h=s.width*c,u=s.height*d,y=(s.zmax??0)*d,g=y-(s.zmin??0)*d,m=Math.max(h,u,g)/p,{x:v,y:f}=a,_=a.z??0;(0,P.i)(F,v,f,_),o.toRenderCoords(F,l,F);const w=m/r.computeScreenPixelSizeAt(F);if(w>r.width*z)return"meshTooClose";if(w<E)return"meshTooFar";const O=(0,R.bh)(t),{absoluteZ:k}=(0,R.Q5)(v,f,y,l,e,O);return k<(n.getElevation(v,f,_,l,"ground")??0)*d+g*H?"meshUnderground":"mesh"}(i,o))}(t,e)}}function ct(t,e,i){const{drawOperation:o,view:n,sketchOptions:r}=i,{cursorVertex:s}=o;t.sketchOptions=r,t.viewType=n.type;const a="multipoint"===e?.type?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(a,mt(i)),pt(t.elevation,i),!s)return void(o.constraints=void 0);const l=s;o.constraints={context:ft(l,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function dt(t,e){const{drawOperation:i,sketchOptions:o,view:n}=e,{cursorVertex:r,lastVertex:s,secondToLastVertex:a}=i,l=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=n.type;const c=s&&r?(0,et.Kt)(s,r)??A.r7:null;if(t.distance.actual=c,t.distance.readOnly=null==s,t.direction.actual=null,t.direction.readOnly=!0,s&&r&&("absolute"===l||a)){const e=(0,X.uR)(a,s,r,l);t.direction.actual=e??A.n0,t.direction.readOnly=!1}t.setLocationFromPoint(r,mt(e)),pt(t.elevation,e);const d=function(t,e){let{sketchOptions:i}=e;const o=i.tooltips.xyMode;return"auto"===o?t?"direction-distance":"coordinates":o}(s,e);t.xyMode=d,t.direction.visible="direction-distance"===d,t.distance.visible="direction-distance"===d,t.effectiveX.visible="coordinates"===d,t.effectiveY.visible="coordinates"===d;const p=r??s;i.constraints=p?{context:ft(p,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function pt(t,e){const{drawOperation:i}=e,o=i?.cursorVertex??i?.lastVertex;t.actual=(0,it.Of)(o)??vt(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function ht(t){const e=t.createOperationGeometry?.full;return"polygon"!==e?.type?A.iT:(0,tt.n)(e)??A.iT}function ut(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(null!=e?(0,et.Kt)(e.left,e.right):null)??A.r7}function yt(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(null!=e?(0,et.Kt)(e.top,e.bottom):null)??A.r7}function gt(t){return t.drawOperation.elevationInfo??R.qt}function mt(t){return t.drawOperation.coordinateHelper.spatialReference}function vt(t){const e=(0,I.G9)(mt(t));return(0,A.d_)(t.defaultZ*e,"meters")}function ft(t,e){return(0,L.hj)(t,e.view,mt(e),gt(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}var _t=i(46975),wt=i(97513),Ot=i(49281);let kt=class extends(k.A.EventedMixin(_t.g)){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new wt.A}initialize(){const{view:t}=this;this.internalGraphicsLayer=new b.default({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=function(t,e){return{point:new Q({sketchOptions:e,viewType:t}),multipoint:new K({sketchOptions:e,viewType:t}),polyline:new J({sketchOptions:e,viewType:t}),polygon:new q({sketchOptions:e,viewType:t}),mesh:new j({sketchOptions:e,viewType:t}),rectangle:new W({sketchOptions:e}),circle:new $({sketchOptions:e})}}(t.type,this.sketchOptions);const i=(0,N.A)((()=>({view:t,options:this.sketchOptions.tooltips})));this.tooltip=i,ot(this._tooltipsContext),this._coordinateFormatterLoadTask=(0,O.UT)((()=>(0,Z.Hh)())),this.addHandles([e.on("vertex-add",(t=>this.onVertexAdd(t))),e.on("vertex-remove",(t=>this.onVertexRemove(t))),e.on("vertex-update",(t=>this.onVertexUpdate(t))),e.on("cursor-update",(t=>this.onCursorUpdate(t))),e.on("cursor-remove",(()=>this._updateGraphic())),e.on("complete",(t=>this.onComplete(t))),this._coordinateFormatterLoadTask,i.on("paste",(t=>(0,N.HA)(t,this.activeTooltipInfo))),(0,c.wB)((()=>this.cursor),(t=>{e.cursor=t}),c.pc),(0,Ot.fm)((()=>{const{activeTooltipInfo:t,sketchOptions:e}=this;lt(t,this._tooltipsContext),i.info=e.tooltips.effectiveEnabled?t:null})),(0,Ot.fm)((()=>{e.constraintZ=function(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;if(!o)return;return(0,A.l3)(o,"meters")/(0,I.G9)(mt(t))}default:return}}(this._tooltipsContext)}),c.OH)]),this.finishToolCreation()}destroy(){this.drawOperation=(0,M.pR)(this.drawOperation),this.tooltip=(0,M.pR)(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,M.pR)(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),null!=this._graphic&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return"2d"===t&&e&&"undoRedo"in e&&e.undoRedo instanceof w?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||(0,N.wG)(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&ot(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(Mt.outline),this.removeHandles(Mt.regularVertices),this.removeHandles(Mt.activeVertex),this.removeHandles(Mt.activeEdge),this.removeHandles(xt)}_createOrUpdateGraphic(t){if(null!=this._graphic)return this.updateGraphicGeometry(t),this._graphic;const e=new s.A({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles((0,x.hA)((()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)})),xt),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};if(null==this.drawOperation)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:n,committedVertices:r,geometryIncludingUncommittedVertices:s,numCommittedVertices:a}=this.drawOperation;if(!(a>0||null!=o))return;const l=t.operationComplete?r:s,c=l.length,d=null!=o?e.pointToArray(o):null,p=this._drawSpatialReference,h="3d"===i.type&&"global"===i.viewingMode,u=new V;u.committedVertices=r,u.cursorVertex=d;const{geometryType:y}=this;switch(y){case"point":case"mesh":u.full=e.arrayToPoint(l[0]);break;case"multipoint":u.full=c>0?(0,U.eq)(l,p):null;break;case"polyline":case"polygon":c>0&&(u.full="polygon"===y?(0,U.N6)([l],p,h,!0):(0,U.LZ)([l],p,h),u.cursorEdge=null!=d&&n&&!(0,T.CI)(o,n)?(0,U.LZ)([[d,e.pointToArray(n)]],p,h):null,u.outline=c>1?u.full:null);break;case"circle":case"rectangle":{if(u.committedVertices=u.cursorVertex=null,!c)break;const e=(0,G.ZP)(i,l[0]),o=l[0],n=e.makeMapPoint(o[0]+bt*i.resolution,o[1]);"circle"===y?1===c&&t.operationComplete?u.circle=(0,U.zV)([o,n],e,!0):2===c&&(this.forceUniformSize?u.circle=(0,U.zV)(l,e,this.centered):u.rectangle=(0,U.zd)(l,e,this.centered)):1===c&&t.operationComplete?u.rectangle=(0,U.GF)([o,n],e,!0):2===c&&(u.rectangle=this.forceUniformSize?(0,U.GF)(l,e,this.centered):(0,U._T)(l,e,this.centered)),u.full=null!=u.circle?u.circle.geometry:u.rectangle?.geometry,u.outline="polygon"===u.full?.type?u.full:null;break}default:return null}return u}initializeGraphic(t){return(0,x.hA)()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const t=this._getCreateOperationGeometry({operationComplete:!0});null!=t&&(e=this._createOrUpdateGraphic(t.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return(0,x.hA)()}onCursorEdgeChanged(t){return(0,x.hA)()}onVertexAdd(t){rt(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||nt(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){rt(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,null!=t?(null!=t.cursorEdge?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),Mt.activeEdge):this.removeHandles(Mt.activeEdge),null!=t.outline?this.addHandles(this.onOutlineChanged(t.outline),Mt.outline):this.removeHandles(Mt.outline),null!=t.committedVertices?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),Mt.regularVertices):this.removeHandles(Mt.regularVertices),null!=t.cursorVertex?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),Mt.activeVertex):this.removeHandles(Mt.activeVertex),null!=t.full?this._createOrUpdateGraphic(t.full):this.removeHandles(xt)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?st(this._tooltipsContext):null}};(0,r._)([(0,d.MZ)()],kt.prototype,"_coordinateFormatterLoadTask",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"_createOperationGeometry",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"_tooltipsContext",null),(0,r._)([(0,d.MZ)({value:!0})],kt.prototype,"centered",null),(0,r._)([(0,d.MZ)()],kt.prototype,"cursor",null),(0,r._)([(0,d.MZ)({nonNullable:!0})],kt.prototype,"defaultZ",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],kt.prototype,"directionOptions",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"drawOperation",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"elevationLockOnVertexAddDisabled",void 0),(0,r._)([(0,d.MZ)({value:!0})],kt.prototype,"enabled",null),(0,r._)([(0,d.MZ)({value:!0})],kt.prototype,"forceUniformSize",null),(0,r._)([(0,d.MZ)({constructOnly:!0})],kt.prototype,"geometryType",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"graphic",null),(0,r._)([(0,d.MZ)({constructOnly:!0})],kt.prototype,"graphicProperties",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"graphicSymbol",null),(0,r._)([(0,d.MZ)({constructOnly:!0})],kt.prototype,"hasZ",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],kt.prototype,"geometryToPlace",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"mode",null),(0,r._)([(0,d.MZ)()],kt.prototype,"snappingManager",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"snapToScene",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"tooltip",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"tooltipInfos",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0,type:wt.A})],kt.prototype,"sketchOptions",void 0),(0,r._)([(0,d.MZ)()],kt.prototype,"updating",null),(0,r._)([(0,d.MZ)({constructOnly:!0,nonNullable:!0})],kt.prototype,"view",void 0),(0,r._)([(0,d.MZ)({constructOnly:!0})],kt.prototype,"undoRedo",null),(0,r._)([(0,d.MZ)()],kt.prototype,"activeTooltipInfo",null),kt=(0,r._)([(0,p.$)("esri.views.draw.DrawGraphicTool")],kt);const xt=Symbol("create-operation-graphic"),Mt={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Zt(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const bt=48},30120:(t,e,i)=>{i.d(e,{Bb:()=>h,G3:()=>g,fJ:()=>u});var o=i(19555),n=i(20664),r=i(9392),s=i(79650),a=i(75762),l=i(87823),c=i(14721),d=i(51230),p=i(86210);function h(t,e){return y(t,e,!1)}function u(t,e){return y(t,e,!0)}function y(t,e,i){if(t instanceof p.D){if(t.operation instanceof l.a)return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=i?-1:1,a=(0,r.fA)(o*t.dx,o*t.dy,o*t.dz);(0,n.g)(e.origin,e.origin,a),(0,s.u)(e)}(t.operation,e,i),!0;if(t.operation instanceof c.m)return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=i?-t.angle:t.angle;(0,n.L)(e.basis1,e.basis1,r.uY,o),(0,n.L)(e.basis2,e.basis2,r.uY,o),(0,s.u)(e)}(t.operation,e,i),!0;if(t.operation instanceof d.j)return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=i?1/t.factor1:t.factor1,a=i?1/t.factor2:t.factor2;(0,n.h)(e.basis1,e.basis1,r),(0,n.h)(e.basis2,e.basis2,a),(0,o.Vj)(e.origin,e.origin,t.origin,t.axis1,r),(0,o.Vj)(e.origin,e.origin,t.origin,t.axis2,a),(0,s.u)(e)}(t.operation,e,i),!0}return!1}function g(t,e,i,r){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];r||(r=(0,s.d)());const c=(0,o.hZ)(a.oG.get(),t[1],-t[0]),d=(0,o.hZ)(a.oG.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),p=(0,o.hZ)(a.oG.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),h=a.oG.get(),u=e.allVertices;u.forEach((e=>{let{pos:i}=e;(0,o.hZ)(h,(0,o.Om)(t,i),(0,o.Om)(c,i)),(0,o.jk)(d,d,h),(0,o.T9)(p,p,h)}));const y=1e-6,g=(0,o.hZ)(a.oG.get(),p[0]-d[0]<y?i/2:0,p[1]-d[1]<y?i/2:0);(0,o.Re)(d,d,g),(0,o.WQ)(p,p,g);const m=l?u.reduce(((t,e)=>t+(e.pos[2]??0)),0)/u.length:0;return(0,o.hs)(r.basis1,t,(p[0]-d[0])/2),(0,o.hs)(r.basis2,c,(p[1]-d[1])/2),(0,n.i)(r.origin,d[0]*t[0]+d[1]*c[0],d[0]*t[1]+d[1]*c[1],m),(0,n.g)(r.origin,r.origin,r.basis1),(0,n.g)(r.origin,r.origin,r.basis2),(0,s.u)(r),r}}}]);
//# sourceMappingURL=7668.fc661309.chunk.js.map