"use strict";(self.webpackChunkfeedback_map=self.webpackChunkfeedback_map||[]).push([[194],{194:(e,t,r)=>{r.r(t),r.d(t,{default:()=>C});var a=r(35143),s=r(3825),i=r(94643),o=r(3975),n=r(42553),l=r(53084),c=r(49304),p=r(27741),u=r(76460),d=r(30726),y=r(50346),h=r(90534),f=r(46053),m=(r(81806),r(85842)),b=r(17707),w=r(13312),g=r(65308),L=r(70652),v=r(54047),I=(r(11265),r(91967)),_=(r(47249),r(38042)),M=r(63860);let S=class extends I.A{constructor(e){super(e),this.apiKey=null,this.id=null,this.language=null,this.places=null,this.serviceUrl="https://basemapstyles-api.arcgis.com/arcgis/rest/services/styles/v2",this.worldview=null}get languageParameter(){const e=this.language;let t="local"===e||"global"===e?e:(0,M.xO)(e??(0,_.JK)())??"global";return t="no"===t?"nb":t,t}};(0,a._)([(0,f.MZ)()],S.prototype,"apiKey",void 0),(0,a._)([(0,f.MZ)()],S.prototype,"id",void 0),(0,a._)([(0,f.MZ)()],S.prototype,"language",void 0),(0,a._)([(0,f.MZ)()],S.prototype,"places",void 0),(0,a._)([(0,f.MZ)()],S.prototype,"serviceUrl",void 0),(0,a._)([(0,f.MZ)()],S.prototype,"worldview",void 0),S=(0,a._)([(0,m.$)("esri.support.BasemapStyle")],S);const A=S;var x,k=r(8837);let O=0,U=x=class extends(n.A.JSONSupportMixin(c.A)){constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.style=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+O++,this.baseLayers=new i.A,this.referenceLayers=new i.A;const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&u.A.getLogger(this).error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=e=>{e.parent=null};this.addHandles([this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>r(e.item))),this.referenceLayers.on("after-remove",(e=>r(e.item)))])}initialize(){this.when().catch((e=>{u.A.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.baseLayers.toArray();for(const r of e)r.destroy();const t=this.referenceLayers.toArray();for(const r of t)r.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),this.portalItem=(0,d.pR)(this.portalItem)}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",(0,o.V)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const a=[];e?(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=(0,k.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&a.push(t)})),this.referenceLayers.forEach((e=>{const t=(0,k.CJ)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);null!=t&&("scene"!==e.type&&(t.isReference=!0),a.push(t))})),t.baseMapLayers=a):t.baseMapLayers=a}set referenceLayers(e){this._set("referenceLayers",(0,o.V)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,p.g)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map((e=>(0,l.Nb)(e)?e.clone():e)),referenceLayers:this.referenceLayers.map((e=>(0,l.Nb)(e)?e.clone():e))};return this.loaded&&(e.loadStatus="loaded"),new x({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t?.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo?.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=(0,l.o8)(e);return t.url&&(0,h.BQ)(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&(0,h.BQ)(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r,style:a}=this;(0,y.Te)(e);const s=[];if(t){const r=t.context?t.context.url:null;if(s.push(this._loadLayersFromJSON(t.data,r,e)),t.data.id&&!t.data.title){const e=t.data.id;s.push((0,v.q)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else r?s.push(this._loadFromItem(r,e)):a&&s.push(this._loadFromStylesService(a,e));await Promise.all(s)}async _loadLayersFromJSON(e,t,a){const s=this.resourceInfo?.context,i=this.portalItem?.portal||s?.portal||null,o=Z[s?.origin||""]??"web-map",{populateOperationalLayers:n}=await Promise.all([r.e(9624),r.e(2620)]).then(r.bind(r,60239)),l=[];if((0,y.Te)(a),e.baseMapLayers&&Array.isArray(e.baseMapLayers)){const r={context:{...s,origin:o,url:t,portal:i,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},a=e=>"web-scene"===o&&"ArcGISSceneServiceLayer"===e.layerType||e.isReference,c=n(this.baseLayers,e.baseMapLayers.filter((e=>!a(e))),r);l.push(c);const p=n(this.referenceLayers,e.baseMapLayers.filter(a),r);l.push(p)}await Promise.allSettled(l)}async _loadFromItem(e,t){const r=await e.load(t),a=await r.fetchData("json",t),s=(0,h.An)(e.itemUrl??"");return this._set("resourceInfo",{data:a.baseMap??{},context:{origin:$[e.type||""]??"web-map",portal:e.portal||g.A.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:a.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||g.A.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}async _loadFromStylesService(e,t){const r=e.serviceUrl.endsWith("/webmaps")?e.serviceUrl.slice(0,-8):e.serviceUrl,a=`${r}/styles/${e.id}/self`,i=`${r}/webmaps/${e.id}`,[o,n]=await Promise.all([(await(0,s.A)(a,{query:{token:e.apiKey},signal:t?.signal})).data,(await(0,s.A)(i,{query:{language:e.languageParameter,places:e.places,worldview:e.worldview,token:e.apiKey},signal:t?.signal})).data]);this.thumbnailUrl??=o.thumbnailUrl;const l=(0,h.An)(i);if(this._set("resourceInfo",{data:n.baseMap??{},context:{origin:"web-map",url:l}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:n.spatialReference},this.resourceInfo.context),await this._loadLayersFromJSON(this.resourceInfo.data,l,t),e.apiKey)for(const s of[...this.baseLayers,...this.referenceLayers])"apiKey"in s&&(s.apiKey=e.apiKey)}static fromId(e){const t=v.H[e];return t?t.itemId?new x({portalItem:{id:t.itemId,portal:{url:"https://www.arcgis.com"}}}):x.fromJSON(t,{origin:t.is3d?"web-scene":"web-map"}):null}};(0,a._)([(0,f.MZ)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,a){this._writeBaseLayers(e,t,a)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:i.A}},writer(e,t,r,a){this._writeBaseLayers(e,t,a)}}}}}})],U.prototype,"baseLayers",null),(0,a._)([(0,f.MZ)({type:String,json:{origins:{"web-scene":{write:!0}}}})],U.prototype,"id",void 0),(0,a._)([(0,f.MZ)({type:L.default})],U.prototype,"portalItem",void 0),(0,a._)([(0,f.MZ)()],U.prototype,"referenceLayers",null),(0,a._)([(0,f.MZ)({readOnly:!0})],U.prototype,"resourceInfo",void 0),(0,a._)([(0,f.MZ)({type:w.A})],U.prototype,"spatialReference",void 0),(0,a._)([(0,f.MZ)({type:A})],U.prototype,"style",void 0),(0,a._)([(0,f.MZ)()],U.prototype,"thumbnailUrl",void 0),(0,a._)([(0,f.MZ)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],U.prototype,"title",void 0),(0,a._)([(0,b.K)("title")],U.prototype,"writeTitle",null),U=x=(0,a._)([(0,m.$)("esri.Basemap")],U);const $={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},Z={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},C=U},8837:(e,t,r)=>{r.d(t,{CJ:()=>h});var a=r(50076),s=r(53084),i=r(48611),o=r(22382),n=r(31933);const l=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wcs","wms","wmts"]),c=new Set(["catalog","csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","knowledge-graph","map-image","map-notes","media","ogc-feature","oriented-imagery","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wcs","wfs","wms","wmts"]),p=new Set([...c,"link-chart"]);function u(e,t){if(t.restrictedWebMapWriting){const r=function(e){switch(e.layerContainerType){case"basemap":return l;case"operational-layers":return"link-chart"===e.origin?p:c;default:return null}}(t);return null==r||r.has(e.type)&&!(0,n.Ov)(e)}return!0}function d(e,t){"maxScale"in e&&(t.maxScale=(0,o.B)(e.maxScale)??void 0),"minScale"in e&&(t.minScale=(0,o.B)(e.minScale)??void 0)}function y(e,t){if(function(e,t){if(t)if((0,n.Ov)(e)){const r=(0,i.wc)("featureCollection.layers",t),a=r?.[0]?.layerDefinition;a&&d(e,a)}else"group"!==e.type&&d(e,t)}(e,t),t&&(t.id=e.id,"blendMode"in e&&(t.blendMode=e.blendMode,"normal"===t.blendMode&&delete t.blendMode),t.opacity=(0,o.B)(e.opacity)??void 0,t.title=e.title||"Layer",t.visibility=e.visible,"legendEnabled"in e&&"wmts"!==e.type))if((0,n.Ov)(e)){const r=t.featureCollection;r&&(r.showLegend=e.legendEnabled)}else t.showLegend=e.legendEnabled}function h(e,t,r){if(!e.persistenceEnabled)return null;if(!("write"in e)||!e.write)return r?.messages&&r.messages.push(new a.A("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted`,{layer:e})),null;if((0,n.Ov)(e)&&!e.isTable)t=e.resourceInfo;else if(u(e,r)){const t={};return e.write(t,r)?t:null}return null!=t&&y(e,t=(0,s.o8)(t)),t}},27741:(e,t,r)=>{r.d(t,{L:()=>n,g:()=>o});var a=r(98773),s=r(94643),i=r(49304);async function o(e,t){return await e.load(),n(e,t)}async function n(e,t){const r=[],o=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];for(const n of t)null!=n&&(Array.isArray(n)?o(...n):s.A.isCollection(n)?n.forEach((e=>o(e))):i.A.isLoadable(n)&&r.push(n))};t(o);let n=null;if(await(0,a.Tj)(r,(async e=>{const t=await(0,a.Ke)(function(e){return"loadAll"in e&&"function"==typeof e.loadAll}(e)?e.loadAll():e.load());!1!==t.ok||n||(n=t)})),n)throw n.error;return e}}}]);
//# sourceMappingURL=194.3e2293d5.chunk.js.map