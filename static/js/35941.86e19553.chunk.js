"use strict";(self.webpackChunkfeedback_map=self.webpackChunkfeedback_map||[]).push([[35941],{1109:(e,t,o)=>{o.d(t,{N:()=>Me,l:()=>Ce});var i,n,r=o(35143),s=o(39356),a=o(91967),l=o(94643),c=o(68134),p=o(46053),d=(o(81806),o(76460),o(47249),o(85842)),h=o(19451);!function(e){e[e.NeverApplied=0]="NeverApplied",e[e.Applied=1]="Applied",e[e.Undone=2]="Undone"}(i||(i={})),function(e){e.UndoRedoUpdating="UndoRedoUpdating",e.UndoInvalidError="UndoInvalidError",e.RedoInvalidError="RedoInvalidError",e.ApplyInvalidError="ApplyInvalidError"}(n||(n={}));const u={[n.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[n.UndoInvalidError]:"There are no items to Undo",[n.RedoInvalidError]:"There are no items to Redo",[n.ApplyInvalidError]:"Cannot apply an item that is already applied"};class f extends Error{constructor(){super(u[n.UndoRedoUpdating]),this.type="undo-redo-updating-error"}}class y extends Error{constructor(){super(u[n.UndoInvalidError]),this.type="undo-redo-undo-error"}}class m extends Error{constructor(){super(u[n.RedoInvalidError]),this.type="undo-redo-redo-error"}}class g extends Error{constructor(){super(u[n.ApplyInvalidError]),this.type="undo-redo-apply-error"}}var v;!function(e){e[e.Apply=0]="Apply",e[e.Undo=1]="Undo",e[e.Redo=2]="Redo"}(v||(v={}));let w=class extends a.A{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=i.NeverApplied}get canUndo(){return this.status===i.Applied}get canRedo(){return this.status===i.Undone}async executeUndoRedoOperation(e){switch(e){case v.Apply:if(this.status!==i.NeverApplied)throw new g;return await this.apply(),void(this.status=i.Applied);case v.Undo:if(this.status!==i.Applied)throw new y;return await this.undo(),void(this.status=i.Undone);case v.Redo:if(this.status!==i.Undone)throw new y;return await this.redo(),void(this.status=i.Applied)}}};(0,r._)([(0,p.MZ)()],w.prototype,"name",void 0),(0,r._)([(0,p.MZ)()],w.prototype,"tag",void 0),w=(0,r._)([(0,d.$)("esri.undoredo.UndoableOperation")],w);let _=class extends a.A{constructor(){super(...arguments),this._stack=new l.A,this._stackPosition=-1,this._updatingHandles=new h.U}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach((e=>e.destroy()))}_drainStack(){this._stack.drain((e=>e.destroy())),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new y;if(this.updating)throw new f;const e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(v.Undo),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new m;if(this.updating)throw new f;const e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new m;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(v.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new f;await this._updatingHandles.addPromise((async()=>{e.status===i.NeverApplied&&await e.executeUndoRedoOperation(v.Apply),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach((e=>e.destroy())),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new f;await this._updatingHandles.addPromise((async()=>{e.status===i.NeverApplied&&await e.executeUndoRedoOperation(v.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.updating&&!t)return;await(0,c.C_)((()=>!this.updating));const o=new l.A;for(let i=0;i<this._stack.length;i++){const t=this._stack.getItemAt(i);t&&(t.tag===e?(t.destroy(),i===this._stackPosition&&(this._stackPosition=o.length-1)):o.push(t))}this._stack=o,this._stackPosition>o.length-1&&(this._stackPosition=o.length-1)}async clear(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.updating&&!e)throw new f;await(0,c.C_)((()=>!this.updating)),this._drainStack()}};(0,r._)([(0,p.MZ)()],_.prototype,"_stack",void 0),(0,r._)([(0,p.MZ)()],_.prototype,"_stackPosition",void 0),(0,r._)([(0,p.MZ)()],_.prototype,"updating",null),(0,r._)([(0,p.MZ)({readOnly:!0})],_.prototype,"canUndo",null),(0,r._)([(0,p.MZ)({readOnly:!0})],_.prototype,"hasUndo",null),(0,r._)([(0,p.MZ)({readOnly:!0})],_.prototype,"canRedo",null),(0,r._)([(0,p.MZ)({readOnly:!0})],_.prototype,"hasRedo",null),_=(0,r._)([(0,d.$)("esri.UndoRedo")],_);var k=o(98773),M=o(54099),O=o(54901),b=o(30726),C=o(58905),x=o(63733),I=o(74e3);class P{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}var Z=o(48384),T=o(42151),A=o(24648),G=o(31633),S=o(12482);function V(e,t,o){if(null==e)return"noTool";switch(e){case"point":return"point";case"multipoint":return"multipoint";case"polyline":return function(e,t){const o=null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0;return"freehand"===t?o<2?"freehandStart":"freehandEnd":o<2?"polylineZeroVertices":"polylineOneVertex"}(t,o);case"polygon":return function(e,t){const o=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;if(o<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(o<4)return"freehand"===t?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}(t,o);case"rectangle":case"circle":return function(e,t){if((null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}(t,o);default:return}}var E=o(20664),U=o(9392);const R=20,z=1,L=.1,F=(0,U.vt)();var H=o(48851),N=o(10535),Y=o(37159);let D=class extends Y.w{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=A.iT}get allFields(){return[]}};(0,r._)([(0,p.MZ)()],D.prototype,"type",void 0),(0,r._)([(0,p.MZ)()],D.prototype,"radius",void 0),(0,r._)([(0,p.MZ)()],D.prototype,"xSize",void 0),(0,r._)([(0,p.MZ)()],D.prototype,"ySize",void 0),(0,r._)([(0,p.MZ)()],D.prototype,"area",void 0),(0,r._)([(0,p.MZ)()],D.prototype,"helpMessage",void 0),(0,r._)([(0,p.MZ)()],D.prototype,"allFields",null),D=(0,r._)([(0,d.$)("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],D);var X=o(5512),W=o(65240);let $=class extends((0,W.B)(Y.w)){constructor(e){super(e),this.type="draw-mesh",this.orientation=(0,X.LJ)({lockable:!1}),this.scale=(0,X.dy)({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};(0,r._)([(0,p.MZ)()],$.prototype,"helpMessage",void 0),(0,r._)([(0,p.MZ)()],$.prototype,"allFields",null),$=(0,r._)([(0,d.$)("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],$);let j=class extends((0,W.B)(Y.w)){constructor(e){super(e),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,r._)([(0,p.MZ)()],j.prototype,"helpMessage",void 0),(0,r._)([(0,p.MZ)()],j.prototype,"allFields",null),j=(0,r._)([(0,d.$)("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],j);let B=class extends((0,W.B)(Y.w)){constructor(e){super(e),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};(0,r._)([(0,p.MZ)()],B.prototype,"helpMessage",void 0),(0,r._)([(0,p.MZ)()],B.prototype,"allFields",null),B=(0,r._)([(0,d.$)("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],B);let K=class extends((0,W.B)(Y.w)){constructor(e){super(e),this.type="draw-polygon",this.direction=(0,X.Gk)(),this.distance=(0,X.Ku)(),this.area=(0,X.Am)(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};(0,r._)([(0,p.MZ)()],K.prototype,"xyMode",void 0),(0,r._)([(0,p.MZ)()],K.prototype,"helpMessage",void 0),(0,r._)([(0,p.MZ)()],K.prototype,"allFields",null),K=(0,r._)([(0,d.$)("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],K);let J=class extends((0,W.B)(Y.w)){constructor(e){super(e),this.type="draw-polyline",this.direction=(0,X.Gk)(),this.distance=(0,X.Ku)(),this.totalLength=(0,X.fr)(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};(0,r._)([(0,p.MZ)()],J.prototype,"helpMessage",void 0),(0,r._)([(0,p.MZ)()],J.prototype,"xyMode",void 0),(0,r._)([(0,p.MZ)()],J.prototype,"allFields",null),J=(0,r._)([(0,d.$)("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],J);let Q=class extends Y.w{constructor(e){super(e),this.type="draw-rectangle",this.xSize=A.r7,this.ySize=A.r7,this.area=A.iT}get allFields(){return[]}};(0,r._)([(0,p.MZ)()],Q.prototype,"type",void 0),(0,r._)([(0,p.MZ)()],Q.prototype,"xSize",void 0),(0,r._)([(0,p.MZ)()],Q.prototype,"ySize",void 0),(0,r._)([(0,p.MZ)()],Q.prototype,"area",void 0),(0,r._)([(0,p.MZ)()],Q.prototype,"helpMessage",void 0),(0,r._)([(0,p.MZ)()],Q.prototype,"allFields",null),Q=(0,r._)([(0,d.$)("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],Q);var q=o(89646),ee=o(50621),te=o(68655),oe=o(29772);function ie(e){const{directionOptions:t,geometryType:o,sketchOptions:i,tooltipInfos:n}=e,r=t=>{const o=ye(e).mode,i=n[t].elevation;"relative-to-ground"===o||"relative-to-scene"===o||"on-the-ground"===o?i.lock(ge(e)):i.unlock()};switch(o){case"polygon":case"polyline":r(o),(e=>{if(t){const o=n[e].direction;o.committed=t.angle,o.unlockOnVertexPlacement=!1,i.values.directionMode=t.mode}})(o);break;case"point":case"mesh":r(o)}}function ne(e,t){const{drawOperation:o,view:i}=t,n=se(t),r=ye(t);if("2d"===i.type||!e||"absolute-height"!==r.mode||1!==o?.numCommittedVertices||!n||"draw-polyline"!==n.type&&"draw-polygon"!==n.type||n.elevation.locked)return;const[s,a,l]=e,c=function(e,t,o,i,n){const{view:r,drawOperation:s}=n;if("3d"!==r.type||!s)return;o??=0;const a=me(n),l=ye(n),c=(0,S.Fo)(r,e,t,o,a,l,i);return(0,oe.Qc)(c,a)??ge(n)}(s,a,l,r,t);null!=c&&n.elevation.lock(c)}function re(e){se(e)?.allFields.forEach((e=>{e.unlockOnVertexPlacement&&e.unlock()}))}function se(e){let{geometryType:t,graphic:o,tooltipInfos:i}=e;return o?.geometry?.type!==ae[t]?"circle"===t||"rectangle"===t?i[t]:null:i[t]}const ae={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function le(e,t){switch(e?.type){case"draw-point":!function(e,t){const o=t.graphic?.geometry;"point"===o?.type&&(ce(e,o,t),e.helpMessage=V("point",o,t.drawOperation.drawingMode))}(e,t);break;case"draw-multipoint":!function(e,t){const o=t.graphic?.geometry;"multipoint"===o?.type&&(ce(e,o,t),e.helpMessage=V("multipoint",o,t.drawOperation.drawingMode))}(e,t);break;case"draw-polyline":!function(e,t){const{createOperationGeometry:o,drawOperation:i}=t,n=null!=o?o.full:null;n&&"polyline"!==n.type||(pe(e,t),e.totalLength.actual=i.lastVertex?(n?(0,te.ob)(n):null)??A.r7:null,e.helpMessage=V("polyline",n,t.drawOperation.drawingMode))}(e,t);break;case"draw-polygon":!function(e,t){const{createOperationGeometry:o,drawOperation:i}=t,n=null!=o?o.full:null;n&&"polygon"!==n.type||(pe(e,t),e.area.actual=i.lastVertex?(n?(0,ee.n)(n):null)??A.iT:null,e.helpMessage=V("polygon",n,t.drawOperation.drawingMode))}(e,t);break;case"draw-rectangle":!function(e,t){e.sketchOptions=t.sketchOptions,e.xSize=ue(t),e.ySize=fe(t),e.area=he(t),e.helpMessage=V("rectangle",t.graphic?.geometry,t.drawOperation.drawingMode)}(e,t);break;case"draw-circle":!function(e,t){const{forceUniformSize:o,sketchOptions:i}=t;e.sketchOptions=i,e.radius=o?function(e){let{createOperationGeometry:t}=e;return(null!=t?.circle?.center&&null!=t.circle.edge?(0,te.Kt)(t.circle.center,t.circle.edge):null)??A.r7}(t):null,e.xSize=o?null:ue(t),e.ySize=o?null:fe(t),e.area=he(t),e.helpMessage=V("circle",t.graphic?.geometry,t.drawOperation.drawingMode)}(e,t);break;case"draw-mesh":!function(e,t){const{graphic:o,view:i}=t,n=o?.geometry;"3d"!==i.type||n&&"mesh"!==n.type||(ce(e,n?.origin,t),n&&(0,N.Ue)(e,n),e.helpMessage=function(e,t){const o=e?.geometry;if(!e||"mesh"!==o?.type||!t)return;const{renderCoordsHelper:i,elevationProvider:n}=t,{camera:r}=t.state,{extent:s}=o,{center:a,spatialReference:l}=s,c=(0,G.GA)(l),p=(0,G.G9)(l),d=(0,G.GA)(i.spatialReference),h=s.width*c,u=s.height*p,f=(s.zmax??0)*p,y=f-(s.zmin??0)*p,m=Math.max(h,u,y)/d,{x:g,y:v}=a,w=a.z??0;(0,E.i)(F,g,v,w),i.toRenderCoords(F,l,F);const _=m/r.computeScreenPixelSizeAt(F);if(_>r.width*z)return"meshTooClose";if(_<R)return"meshTooFar";const k=(0,S.bh)(e),{absoluteZ:M}=(0,S.Q5)(g,v,f,l,t,k);return M<(n.getElevation(g,v,w,l,"ground")??0)*p+y*L?"meshUnderground":"mesh"}(o,i))}(e,t)}}function ce(e,t,o){const{drawOperation:i,view:n,sketchOptions:r}=o,{cursorVertex:s}=i;e.sketchOptions=r,e.viewType=n.type;const a="multipoint"===t?.type?t.getPoint(t.points.length-1):t;if(e.setLocationFromPoint(a,me(o)),de(e.elevation,o),!s)return void(i.constraints=void 0);const l=s;i.constraints={context:ve(l,o),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}function pe(e,t){const{drawOperation:o,sketchOptions:i,view:n}=t,{cursorVertex:r,lastVertex:s,secondToLastVertex:a}=o,l=i.values.effectiveDirectionMode;e.sketchOptions=i,e.viewType=n.type;const c=s&&r?(0,te.Kt)(s,r)??A.r7:null;if(e.distance.actual=c,e.distance.readOnly=null==s,e.direction.actual=null,e.direction.readOnly=!0,s&&r&&("absolute"===l||a)){const t=(0,q.uR)(a,s,r,l);e.direction.actual=t??A.n0,e.direction.readOnly=!1}e.setLocationFromPoint(r,me(t)),de(e.elevation,t);const p=function(e,t){let{sketchOptions:o}=t;const i=o.tooltips.xyMode;return"auto"===i?e?"direction-distance":"coordinates":i}(s,t);e.xyMode=p,e.direction.visible="direction-distance"===p,e.distance.visible="direction-distance"===p,e.effectiveX.visible="coordinates"===p,e.effectiveY.visible="coordinates"===p;const d=r??s;o.constraints=d?{context:ve(d,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function de(e,t){const{drawOperation:o}=t,i=o?.cursorVertex??o?.lastVertex;e.actual=(0,oe.Of)(i)??ge(t),e.visible=o.hasZ,e.readOnly=!1,e.showAsZ=!0}function he(e){const t=e.createOperationGeometry?.full;return"polygon"!==t?.type?A.iT:(0,ee.n)(t)??A.iT}function ue(e){const t=e.createOperationGeometry?.rectangle?.midpoints;return(null!=t?(0,te.Kt)(t.left,t.right):null)??A.r7}function fe(e){const t=e.createOperationGeometry?.rectangle?.midpoints;return(null!=t?(0,te.Kt)(t.top,t.bottom):null)??A.r7}function ye(e){return e.drawOperation.elevationInfo??S.qt}function me(e){return e.drawOperation.coordinateHelper.spatialReference}function ge(e){const t=(0,G.G9)(me(e));return(0,A.d_)(e.defaultZ*t,"meters")}function ve(e,t){return(0,H.hj)(e,t.view,me(t),ye(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var we=o(46975),_e=o(97513),ke=o(49281);let Me=class extends(M.A.EventedMixin(we.g)){constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new _e.A}initialize(){const{view:e}=this;this.internalGraphicsLayer=new x.default({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=function(e,t){return{point:new B({sketchOptions:t,viewType:e}),multipoint:new j({sketchOptions:t,viewType:e}),polyline:new J({sketchOptions:t,viewType:e}),polygon:new K({sketchOptions:t,viewType:e}),mesh:new $({sketchOptions:t,viewType:e}),rectangle:new Q({sketchOptions:t}),circle:new D({sketchOptions:t})}}(e.type,this.sketchOptions);const o=(0,N.A)((()=>({view:e,options:this.sketchOptions.tooltips})));this.tooltip=o,ie(this._tooltipsContext),this._coordinateFormatterLoadTask=(0,k.UT)((()=>(0,C.Hh)())),this.addHandles([t.on("vertex-add",(e=>this.onVertexAdd(e))),t.on("vertex-remove",(e=>this.onVertexRemove(e))),t.on("vertex-update",(e=>this.onVertexUpdate(e))),t.on("cursor-update",(e=>this.onCursorUpdate(e))),t.on("cursor-remove",(()=>this._updateGraphic())),t.on("complete",(e=>this.onComplete(e))),this._coordinateFormatterLoadTask,o.on("paste",(e=>(0,N.HA)(e,this.activeTooltipInfo))),(0,c.wB)((()=>this.cursor),(e=>{t.cursor=e}),c.pc),(0,ke.fm)((()=>{const{activeTooltipInfo:e,sketchOptions:t}=this;le(e,this._tooltipsContext),o.info=t.tooltips.effectiveEnabled?e:null})),(0,ke.fm)((()=>{t.constraintZ=function(e){const{geometryType:t,tooltipInfos:o}=e;switch(t){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const i=o[t].elevation.committed;if(!i)return;return(0,A.l3)(i,"meters")/(0,G.G9)(me(e))}default:return}}(this._tooltipsContext)}),c.OH)]),this.finishToolCreation()}destroy(){this.drawOperation=(0,b.pR)(this.drawOperation),this.tooltip=(0,b.pR)(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,b.pR)(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),null!=this._graphic&&(this._graphic.symbol=e)}set mode(e){const t=this.drawOperation;t&&(t.drawingMode=e),this._set("mode",e)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:e,map:t}}=this;return"2d"===e&&t&&"undoRedo"in t&&t.undoRedo instanceof _?t.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||(0,N.wG)(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),0===this.drawOperation.numCommittedVertices&&ie(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(be.outline),this.removeHandles(be.regularVertices),this.removeHandles(be.activeVertex),this.removeHandles(be.activeEdge),this.removeHandles(Oe)}_createOrUpdateGraphic(e){if(null!=this._graphic)return this.updateGraphicGeometry(e),this._graphic;const t=new s.A({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles((0,O.hA)((()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)})),Oe),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{operationComplete:!1};if(null==this.drawOperation)return;const{coordinateHelper:t,view:o,visualizationCursorVertex:i,lastVertex:n,committedVertices:r,geometryIncludingUncommittedVertices:s,numCommittedVertices:a}=this.drawOperation;if(!(a>0||null!=i))return;const l=e.operationComplete?r:s,c=l.length,p=null!=i?t.pointToArray(i):null,d=this._drawSpatialReference,h="3d"===o.type&&"global"===o.viewingMode,u=new P;u.committedVertices=r,u.cursorVertex=p;const{geometryType:f}=this;switch(f){case"point":case"mesh":u.full=t.arrayToPoint(l[0]);break;case"multipoint":u.full=c>0?(0,Z.eq)(l,d):null;break;case"polyline":case"polygon":c>0&&(u.full="polygon"===f?(0,Z.N6)([l],d,h,!0):(0,Z.LZ)([l],d,h),u.cursorEdge=null!=p&&n&&!(0,I.CI)(i,n)?(0,Z.LZ)([[p,t.pointToArray(n)]],d,h):null,u.outline=c>1?u.full:null);break;case"circle":case"rectangle":{if(u.committedVertices=u.cursorVertex=null,!c)break;const t=(0,T.ZP)(o,l[0]),i=l[0],n=t.makeMapPoint(i[0]+xe*o.resolution,i[1]);"circle"===f?1===c&&e.operationComplete?u.circle=(0,Z.zV)([i,n],t,!0):2===c&&(this.forceUniformSize?u.circle=(0,Z.zV)(l,t,this.centered):u.rectangle=(0,Z.zd)(l,t,this.centered)):1===c&&e.operationComplete?u.rectangle=(0,Z.GF)([i,n],t,!0):2===c&&(u.rectangle=this.forceUniformSize?(0,Z.GF)(l,t,this.centered):(0,Z._T)(l,t,this.centered)),u.full=null!=u.circle?u.circle.geometry:u.rectangle?.geometry,u.outline="polygon"===u.full?.type?u.full:null;break}default:return null}return u}initializeGraphic(e){return(0,O.hA)()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const e=this._getCreateOperationGeometry({operationComplete:!0});null!=e&&(t=this._createOrUpdateGraphic(e.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return(0,O.hA)()}onCursorEdgeChanged(e){return(0,O.hA)()}onVertexAdd(e){re(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||ne(e.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){re(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,null!=e?(null!=e.cursorEdge?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),be.activeEdge):this.removeHandles(be.activeEdge),null!=e.outline?this.addHandles(this.onOutlineChanged(e.outline),be.outline):this.removeHandles(be.outline),null!=e.committedVertices?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),be.regularVertices):this.removeHandles(be.regularVertices),null!=e.cursorVertex?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),be.activeVertex):this.removeHandles(be.activeVertex),null!=e.full?this._createOrUpdateGraphic(e.full):this.removeHandles(Oe)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?se(this._tooltipsContext):null}};(0,r._)([(0,p.MZ)()],Me.prototype,"_coordinateFormatterLoadTask",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"_createOperationGeometry",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"_tooltipsContext",null),(0,r._)([(0,p.MZ)({value:!0})],Me.prototype,"centered",null),(0,r._)([(0,p.MZ)()],Me.prototype,"cursor",null),(0,r._)([(0,p.MZ)({nonNullable:!0})],Me.prototype,"defaultZ",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],Me.prototype,"directionOptions",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"drawOperation",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"elevationLockOnVertexAddDisabled",void 0),(0,r._)([(0,p.MZ)({value:!0})],Me.prototype,"enabled",null),(0,r._)([(0,p.MZ)({value:!0})],Me.prototype,"forceUniformSize",null),(0,r._)([(0,p.MZ)({constructOnly:!0})],Me.prototype,"geometryType",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"graphic",null),(0,r._)([(0,p.MZ)({constructOnly:!0})],Me.prototype,"graphicProperties",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"graphicSymbol",null),(0,r._)([(0,p.MZ)({constructOnly:!0})],Me.prototype,"hasZ",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],Me.prototype,"geometryToPlace",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"mode",null),(0,r._)([(0,p.MZ)()],Me.prototype,"snappingManager",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"snapToScene",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"tooltip",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"tooltipInfos",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0,type:_e.A})],Me.prototype,"sketchOptions",void 0),(0,r._)([(0,p.MZ)()],Me.prototype,"updating",null),(0,r._)([(0,p.MZ)({constructOnly:!0,nonNullable:!0})],Me.prototype,"view",void 0),(0,r._)([(0,p.MZ)({constructOnly:!0})],Me.prototype,"undoRedo",null),(0,r._)([(0,p.MZ)()],Me.prototype,"activeTooltipInfo",null),Me=(0,r._)([(0,d.$)("esri.views.draw.DrawGraphicTool")],Me);const Oe=Symbol("create-operation-graphic"),be={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Ce(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const xe=48},29632:(e,t,o)=>{o.d(t,{Fe:()=>d,Km:()=>r,Nk:()=>l});var i=o(69539),n=o(97763);function r(e,t,o,i){if(e)if("CIMTextSymbol"!==e.type){if(o&&e.effects)for(const o of e.effects)a(o,t);if(e.symbolLayers)for(const o of e.symbolLayers){switch(o.type){case"CIMPictureMarker":case"CIMVectorMarker":s(o,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!i?.preserveOutlineWidth&&o.width&&(o.width*=t);break;case"CIMPictureFill":o.height&&(o.height*=t),o.offsetX&&(o.offsetX*=t),o.offsetY&&(o.offsetY*=t);break;case"CIMHatchFill":r(o.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),o.offsetX&&(o.offsetX*=t),o.offsetY&&(o.offsetY*=t),o.separation&&(o.separation*=t)}if(o.effects)for(const e of o.effects)a(e,t)}}else null!=e.height&&(e.height*=t)}function s(e,t,o){if(e&&(e.markerPlacement&&function(e,t){switch((0,n.zr)(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const o=e.placementTemplate.map((e=>e*t));e.placementTemplate=o}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const o=e.placementTemplate.map((e=>e*t));e.placementTemplate=o}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const i of e.markerGraphics)e.scaleSymbolsProportionally||r(i.symbol,t,!0,o)}function a(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const o=e.dashTemplate.map((e=>e*t));e.dashTemplate=o}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function l(e){const t=[];return c((0,n.lW)(e),t),t.length?new i.A((0,n.e6)(t[0])):null}function c(e,t){if(!e)return;let o;o="CIMTextSymbol"===e.type?e.symbol:e;const i="CIMPolygonSymbol"===e.type;if(o?.symbolLayers)for(const r of o.symbolLayers)if(!(r.colorLocked||i&&((0,n.mA)(r)||(0,n.MM)(r)&&r.markerPlacement&&(0,n.zr)(r.markerPlacement))))switch(r.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":r.tintColor&&p(t,r.tintColor);break;case"CIMVectorMarker":r.markerGraphics?.forEach((e=>{c(e.symbol,t)}));break;case"CIMSolidStroke":case"CIMSolidFill":p(t,r.color);break;case"CIMHatchFill":c(r.lineSymbol,t)}}function p(e,t){for(const o of e)if(o.join(".")===t.join("."))return;e.push(t)}function d(e,t,o){t instanceof i.A||(t=new i.A(t));const r=(0,n.lW)(e);r&&h(r,t,o)}function h(e,t,o){if(!e)return;let i;i="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===i?.type;if(i?.symbolLayers)for(const s of i.symbolLayers){if(s.colorLocked)continue;if(r)if(o){const{layersToColor:e}=o;if(((0,n.mA)(s)||(0,n.MM)(s)&&s.markerPlacement&&(0,n.zr)(s.markerPlacement))&&"fill"===e||(0,n.jn)(s)&&"outline"===e)continue}else if((0,n.mA)(s)||(0,n.MM)(s)&&s.markerPlacement&&(0,n.zr)(s.markerPlacement))continue;const e=t.toArray();switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor=e;break;case"CIMVectorMarker":s.markerGraphics?.forEach((e=>{h(e.symbol,t,o)}));break;case"CIMSolidStroke":case"CIMSolidFill":s.color=e;break;case"CIMHatchFill":h(s.lineSymbol,t,o)}}}},30120:(e,t,o)=>{o.d(t,{Bb:()=>h,G3:()=>y,fJ:()=>u});var i=o(19555),n=o(20664),r=o(9392),s=o(79650),a=o(75762),l=o(87823),c=o(14721),p=o(51230),d=o(86210);function h(e,t){return f(e,t,!1)}function u(e,t){return f(e,t,!0)}function f(e,t,o){if(e instanceof d.D){if(e.operation instanceof l.a)return function(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=o?-1:1,a=(0,r.fA)(i*e.dx,i*e.dy,i*e.dz);(0,n.g)(t.origin,t.origin,a),(0,s.u)(t)}(e.operation,t,o),!0;if(e.operation instanceof c.m)return function(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=o?-e.angle:e.angle;(0,n.L)(t.basis1,t.basis1,r.uY,i),(0,n.L)(t.basis2,t.basis2,r.uY,i),(0,s.u)(t)}(e.operation,t,o),!0;if(e.operation instanceof p.j)return function(e,t){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=o?1/e.factor1:e.factor1,a=o?1/e.factor2:e.factor2;(0,n.h)(t.basis1,t.basis1,r),(0,n.h)(t.basis2,t.basis2,a),(0,i.Vj)(t.origin,t.origin,e.origin,e.axis1,r),(0,i.Vj)(t.origin,t.origin,e.origin,e.axis2,a),(0,s.u)(t)}(e.operation,t,o),!0}return!1}function y(e,t,o,r){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];r||(r=(0,s.d)());const c=(0,i.hZ)(a.oG.get(),e[1],-e[0]),p=(0,i.hZ)(a.oG.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),d=(0,i.hZ)(a.oG.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),h=a.oG.get(),u=t.allVertices;u.forEach((t=>{let{pos:o}=t;(0,i.hZ)(h,(0,i.Om)(e,o),(0,i.Om)(c,o)),(0,i.jk)(p,p,h),(0,i.T9)(d,d,h)}));const f=1e-6,y=(0,i.hZ)(a.oG.get(),d[0]-p[0]<f?o/2:0,d[1]-p[1]<f?o/2:0);(0,i.Re)(p,p,y),(0,i.WQ)(d,d,y);const m=l?u.reduce(((e,t)=>e+(t.pos[2]??0)),0)/u.length:0;return(0,i.hs)(r.basis1,e,(d[0]-p[0])/2),(0,i.hs)(r.basis2,c,(d[1]-p[1])/2),(0,n.i)(r.origin,p[0]*e[0]+p[1]*c[0],p[0]*e[1]+p[1]*c[1],m),(0,n.g)(r.origin,r.origin,r.basis1),(0,n.g)(r.origin,r.origin,r.basis2),(0,s.u)(r),r}}}]);
//# sourceMappingURL=35941.86e19553.chunk.js.map